<!DOCTYPE html>
<html>


    <head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>构造自己的python模块</title>
<meta name="description" content="A blog about programming and network security">

<link rel="profile" href="https://gmpg.org/xfn/11" />
<! -- link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bbbbootstrap.min.css"-- >
<link rel="stylesheet" href="/css/my_code.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/css/highlightjs.piperita.css">

<!-- Favicons generated at https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">





</head>


    <body>

    <nav id="my-menu">
  <div>
    <p>quanyechavshuo</p>

    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <!--https://fontawesome.io/icons/ -->
    <br>
    <center>
    <font color="red" align="center"><i class="fa fa-link" aria-hidden="true"></i><a href="../../../../../bookmarks.html"><font color="red"> link</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-key" aria-hidden="true"></i><a href="../../../../../book.html" target="_top"><font color="red"> book</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-music" aria-hidden="true"></i><a href="../../../../../jquery-jplayer/index.html" target="_top"><font color="red"> music</font></a></font>
    <br>
    <br>
    <font color="red" align="center"><i class="fa fa-caret-square-o-right" aria-hidden="true"></i><a href="../../../../../mv.html" target="_top"><font color="red"> movie</font></a></font>
    </center>
    <p class="links">
  <a href="https://www.twitter.com/quanyechavshuo" target="_new"><i class="fa fa-twitter"></i></a>
  <a href="https://github.com/3xp10it" target="_new"><i class="fa fa-github-alt"></i></a>
  <a href="/feed.xml" target="_new"><i class="fa fa-rss"></i></a>
</p>

  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>



    <div class="page-content">
      <div class="wrap">
      

<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="https://schema.org/Article" class="col-md-12 article">
      

      <h1 class="header" itemprop="name">构造自己的python模块</h1>

      <div class="author">
        <small><i>
          
          on <span itemprop="datePublished" content="2014-08-28">August 3, 2016</span>
           under python
        </i></small>
      </div>

      <div class="read-time">
        <small>
          6 minute read
        </small>
      </div>

      <div class="content-panel content">

        

        <span itemprop="articleBody"><h3 id="x00-about">0x00 about</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>目的:便于关键常用代码的可重用性
用法:
    pip install exp10it
    from exp10it import *
说明:最新模块见如下链接
</code></pre>
</div>
<p><a href="https://github.com/3xp10it/mytools/blob/master/exp10it.py">最新代码</a></p>

<h3 id="x01-api">0x01 api</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>def figlet2file(logo_str,file_abs_path,print_or_not):
    #输出随机的logo文字到文件或屏幕,第二个参数为任意非文件的参数时(eg.0,1,2),只输出到屏幕
    #apt-get install figlet
    #man figlet
    #figure out which is the figlet's font directory
    #my figlet font directory is:
    #figlet -I 2,output:/usr/share/figlet

def oneline2nline(oneline,nline,file_abs_path):
    #将文件中的一行字符串用多行字符串替换,调用时要将"多行字符串的参数(第二个参数)"中的换行符设置为\n

def lin2win(file_abs_path):
    #将linux下的文件中的\n换行符换成win下的\n\n换行符

def get_all_file_name(folder,ext_list):
    #得到文件夹下的所有文件名的绝对路经,第二个参数为要求的后缀列表

def save2github(file_abs_path,repo_name,comment):
    #将文件上传到github
    #arg1:文件绝对路经
    #arg2:远程仓库名
    #提交的commit注释

增加了raw_input()支持自动补全文件路径代码,用法:from exp10it import *

def get_title_from_uri(uri):
    #得到uri对应的title```

def get_uris_from_file(file):
    #从文件中获取所有uri### 0x02 module

def get_title_from_file(file):
    #等到文件中的所有uri对应的title
</code></pre>
</div>
<p>#############################################################
### <em>__ /           _ |  _ \ _) |
###   _ \ \  / __ \  | |   | | <strong>|
###    ) |`  &lt;  |   | | |   | | |
### __</strong>/ _/_\ .<strong>/ _|_</strong>/ _|_</em>|
###            _|
###
### name: exp10it.py
### function: my module
### date: 2016-08-05
### author: quanyechavshuo
### blog: https://3xp10it.github.io
#############################################################
# -<em>- coding: utf-8 -</em>-
import sys
reload(sys)
sys.setdefaultencoding(‘utf-8’)
#upon 4 lines for chinese support</p>

<p>import os
import re
import random</p>

<p>def figlet2file(logo_str,file_abs_path,print_or_not):
    #输出随机的logo文字到文件或屏幕,第二个参数为任意非文件的参数时(eg.0,1,2),只输出到屏幕
    #apt-get install figlet
    #man figlet
    #figure out which is the figlet’s font directory
    #my figlet font directory is:
    #figlet -I 2,output:/usr/share/figlet</p>

<div class="highlighter-rouge"><pre class="highlight"><code>try:
    f=os.popen("figlet -I 2")
    all=f.readlines()
    f.close()
    figlet_font_dir=all[0][:-1]
except:
    os.system("apt-get install figlet")
    f=os.popen("figlet -I 2")
    all=f.readlines()
    f.close()
    figlet_font_dir=all[0][:-1]

all_font_name_list=get_all_file_name(figlet_font_dir,['tlf','flf'])
random_font=random.choice(all_font_name_list)
unsucceed=os.system("figlet -t -f %s %s &gt; /tmp/3" % (random_font,logo_str))
if(unsucceed==1):
    print "something wrong with figlet,check the command in python source file"
try:
    os.system("cat /tmp/3 &gt;&gt; %s" % file_abs_path)
except:
    pass
if(print_or_not==True):
    os.system("cat /tmp/3")
os.system("rm /tmp/3")
</code></pre>
</div>

<p>def oneline2nline(oneline,nline,file_abs_path):
    #将文件中的一行字符串用多行字符串替换，调用时要将”多行字符串的参数(第二个参数)”中的换行符设置为\n
    tmpstr=nline.replace(‘\n’,’\\n’)
    os.system(“sed ‘/%s/c\\n%s’ %s &gt; /tmp/1” % (oneline,tmpstr,file_abs_path))
    os.system(“cat /tmp/1 &gt; %s &amp;&amp; rm /tmp/1” % file_abs_path)
    pass</p>

<p>def lin2win(file_abs_path):
    #将linux下的文件中的\n换行符换成win下的\n\n换行符
    import sys
    input_file=file_abs_path
    f=open(input_file,”r+”)
    urls=f.readlines()
    f.close()
    os.system(“rm %s” % file_abs_path)
    f1=open(file_abs_path,”a+”)
    for url in urls:
    	print url[0:-1]
    	#print url is different with print url[0:-1]
    	#print url[0:-1] can get the pure string
    	#while print url will get the “unseen \n”
    	#this script can turn a file with strings
    	#end with \n into a file with strings end
    	#with \r\n to make it comfortable move the
    	#txt file from *nix to win,coz the file with
    	#strings end with \n in *nix is ok for human
    	#to see “different lines”,but this kind of file
    	#will turn “unsee different lines” in win
    	f1.write(url[0:-1]+”\r\n”)
    f1.close()</p>

<p>#attention:
#由于此处tmp_get_file_name_value和tmp_all_file_name_list在函数外面,so
#在其他代码中调用get_all_file_name()时要用from name import *,不用import name,否则不能调用到get_all_file_name的功能
tmp_get_file_name_value=0
tmp_all_file_name_list=[]
def get_all_file_name(folder,ext_list):
    #exp_list为空时，得到目录下的所有文件名,不返回空文件夹名
    #返回结果为文件名列表，不是完全绝对路径名
    #eg.folder=”/root”时，当/root目录下有一个文件夹a，一个文件2.txt,a中有一个文件1.txt
    #得到的函数返回值为[‘a/1.txt’,’2.txt’]
    global tmp_get_file_name_value
    global root_dir
    global tmp_all_file_name_list
    tmp_get_file_name_value+=1
    if tmp_get_file_name_value==1:
        if folder[-1]==’/’:
            root_dir=folder[:-1]
        else:
            root_dir=folder</p>

<div class="highlighter-rouge"><pre class="highlight"><code>allfile=os.listdir(folder)
for each in allfile:
    each_abspath=os.path.join(folder,each)
    if os.path.isdir(each_abspath):
        get_all_file_name(each_abspath,ext_list)
    else:
        #print each_abspath
        if len(each_abspath)&gt;len(root_dir)+1+len(os.path.basename(each)):
            filename=each_abspath[len(root_dir)+1:]
            #print filename
            if len(ext_list)==0:
                tmp_all_file_name_list.append(filename)
            else:
                for each_ext in ext_list:
                    if(filename.split('.')[-1]==each_ext):
                        #print filename
                        tmp_all_file_name_list.append(filename)
        else:
            #print each
            if len(ext_list)==0:
                tmp_all_file_name_list.append(each)
            else:
                for each_ext in ext_list:
                    if(each.split('.')[-1]==each_ext):
                        #print each
                        tmp_all_file_name_list.append(each)

return tmp_all_file_name_list
</code></pre>
</div>

<p>def save2github(file_abs_path,repo_name,comment):
    #将文件上传到github
    #arg1:文件绝对路经
    #arg2:远程仓库名
    #提交的commit注释
    local_resp_path=”/root/”+repo_name
    filename=os.path.basename(file_abs_path)
    remote_resp_uri=”https://github.com/3xp10it/%s.git” % repo_name
    if os.path.exists(local_resp_path) is False:
        os.system(“mkdir %s &amp;&amp; cd %s &amp;&amp; git init &amp;&amp; git pull %s &amp;&amp; git remote add origin %s &amp;&amp; git status” % (local_resp_path,local_resp_path,remote_resp_uri,remote_resp_uri))
        if os.path.exists(local_resp_path+”/”+filename) is True:
            print “warning!warning!warning! I will exit! There exists a same name script in local_resp_path(»%s),and this script is downloaded from remote github repo,you should rename your script if you want to upload it to git:)” % local_resp_path+”/”+filename
            return False
        os.system(“cp %s %s” % (file_abs_path,local_resp_path))
        succeed=os.system(“cd %s &amp;&amp; git add . &amp;&amp; git status &amp;&amp; git commit -a -m ‘%s’ &amp;&amp; git push -u origin master” % (local_resp_path,comment))
        if(succeed==0):
            print “push succeed!!!”
            return True
        else:
            print “push to git wrong,wrong,wrong,check it!!!”
            return False</p>

<div class="highlighter-rouge"><pre class="highlight"><code>if os.path.exists(local_resp_path) is True and os.path.exists(local_resp_path+"/.git") is False:
    if os.path.exists(local_resp_path+"/"+filename) is True:
        print "warning!warning!warning! I will exit! There exists a same name script in local_resp_path(&gt;&gt;%s),you should rename your script if you want to upload it to git:)" % local_resp_path+"/"+filename
        return False
    os.system("mkdir /tmp/codetmp")
    os.system("cd %s &amp;&amp; cp -r * /tmp/codetmp/ &amp;&amp; rm -r * &amp;&amp;  git init &amp;&amp; git pull %s" % (local_resp_path,remote_resp_uri))
    os.system("cp -r /tmp/codetmp/* %s &amp;&amp; rm -r /tmp/codetmp" % local_resp_path)
    os.system("cp %s %s" % (file_abs_path,local_resp_path))
    succeed=os.system("cd %s &amp;&amp; git add . &amp;&amp; git status &amp;&amp; git commit -a -m '%s' &amp;&amp; git remote add origin %s &amp;&amp; git push -u origin master" % (local_resp_path,comment,remote_resp_uri))
    if(succeed==0):
        print "push succeed!!!"
        return True
    else:
        print "push to git wrong,wrong,wrong,check it!!!"
        return False

if os.path.exists(local_resp_path) is True and os.path.exists(local_resp_path+"/.git") is True:
    #如果本地local_resp_path存在，且文件夹中有.git,当local_resp_path文件夹中的文件与远程github仓库中的文件不一致时，
    #且远程仓库有本地仓库没有的文件，选择合并本地和远程仓库并入远程仓库,所以这里采用一并重新合并的处理方法，
    #(与上一个if中的情况相比，多了一个合并前先删除本地仓库中的.git文件夹的动作),
    #虽然当远程仓库中不含本地仓库没有的文件时，不用这么做，但是这样做也可以处理那种情况
    if os.path.exists(local_resp_path+"/"+filename) is True:
        print "warning!warning!warning! I will exit! There exists a same name script in local_resp_path(&gt;&gt;%s),you should rename your script if you want to upload it to git:)" % local_resp_path+"/"+filename
        return False
    os.system("cd %s &amp;&amp; rm -r .git" % local_resp_path)
    os.system("mkdir /tmp/codetmp")
    os.system("cd %s &amp;&amp; cp -r * /tmp/codetmp/ &amp;&amp; rm -r * &amp;&amp; git init &amp;&amp; git pull %s" % (local_resp_path,remote_resp_uri))
    os.system("cp -r /tmp/codetmp/* %s &amp;&amp; rm -r /tmp/codetmp" % local_resp_path)
    os.system("cp %s %s" % (file_abs_path,local_resp_path))
    succeed=os.system("cd %s &amp;&amp; git add . &amp;&amp; git status &amp;&amp; git commit -a -m '%s' &amp;&amp; git remote add origin %s &amp;&amp; git push -u origin master" % (local_resp_path,comment,remote_resp_uri))
    if(succeed==0):
        print "push succeed!!!"
        return True
    else:
        print "push to git wrong,wrong,wrong,check it!!!"
        return False
</code></pre>
</div>

<p>#below code are the function about tab key complete with file path
#————————start-of-key-complete-with-file-path——————————–
import os
import sys
import readline
import glob
class tabCompleter(object):
        “””
        A tab completer that can either complete from
        the filesystem or from a list.
        Partially taken from:
        http://stackoverflow.com/questions/5637124/tab-completion-in-pythons-raw-input
        source code:https://gist.github.com/iamatypeofwalrus/5637895
        “””</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    def pathCompleter(self,text,state):
        """
        This is the tab completer for systems paths.
        Only tested on *nix systems
        """
        line   = readline.get_line_buffer().split()
        return [x for x in glob.glob(text+'*')][state]

    def createListCompleter(self,ll):
        """
        This is a closure that creates a method that autocompletes from
        the given list.
        Since the autocomplete function can't be given a list to complete from
        a closure is used to create the listCompleter function with a list to complete
        from.
        """
        def listCompleter(text,state):
            line   = readline.get_line_buffer()
            if not line:
                return [c + " " for c in ll][state]
            else:
                return [c + " " for c in ll if c.startswith(line)][state]
        self.listCompleter = listCompleter t = tabCompleter() t.createListCompleter(["ab","aa","bcd","bdf"])
</code></pre>
</div>

<p>readline.set_completer_delims(‘\t’)
readline.parse_and_bind(“tab: complete”)
#readline.set_completer(t.listCompleter)
#ans = raw_input(“Complete from list “)
#print ans
readline.set_completer(t.pathCompleter)
#————————–end-of-key-complete-with-file-path——————————–</p>

<p>def get_title_from_uri(uri):
    #得到uri对应的title
    import mechanize
    import cookielib
    br = mechanize.Browser()
    br.set_cookiejar(cookielib.LWPCookieJar()) # Cookie jar
    br.set_handle_equiv(True) # Browser Option
    br.set_handle_gzip(True)
    br.set_handle_redirect(True)
    br.set_handle_referer(True)
    br.set_handle_robots(False)
    br.set_handle_refresh(mechanize._http.HTTPRefreshProcessor(), max_time=1)
    br.addheaders = [(‘User-agent’, ‘Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.1) Gecko/2008071615 Fedora/3.0.1-1.fc9 Firefox/3.0.1’)]
    br.open(uri)
    #print br.title()
    return br.title()</p>

<p>def get_uris_from_file(file):
    #从文件中获取所有uri
    f=open(file,”r+”)
    content=f.read()
    #print content
    f.close()
    allurls=[]
    all=re.findall(‘(http(\S)+)’,content,re.I)
    for each in all:
        allurls.append(each[0])
    #print allurls
    return allurls</p>

<p>def get_title_from_file(file):
    #等到文件中的所有uri对应的title
    target_allurls=get_uris_from_file(file)
    print “a output file:/tmp/result.txt”
    writed_urls=[]
    for each in target_allurls:
        f=open(“/tmp/result.txt”,”a+”)
        tmp=urlparse(each)
        http_domain=tmp.scheme+’://’+tmp.hostname
        title=get_title_from_uri(http_domain)
        time.sleep(1)
        try:
            if http_domain not in writed_urls:
                each_line_to_write=http_domain+’\r\n’+’upon uri is:’+title+’\r\n’
                print each_line_to_write
                f.write(each_line_to_write)
                writed_urls.append(http_domain)
        except:
            pass
    f.close()
```</p>

<h3 id="x03-">0x03 模块发布</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>1&gt;pypi register
2&gt;eg.
mkdir /root/mypypi
cd /root/mypypi
python setup.py register
vi exp10it.py
vi setup.py
--------------setup.py-------------
from distutils.core import setup
setup(
    name='exp10it',
    version='1.0.11',
    packages=[''],
    url='https://3xp10it.github.io',
    license='',
    author='quanyechavshuo',
    author_email='quanyechavshuo@gmail.com',
    description='My pipy module'
)
----------------end----------------
python setup.py sdist upload
(upload时会有warning提示没有找到__init__.py文件等,经测试通过pip install exp10it可完美利用,也即此warning可忽略)

update时只需:
cd /root/mypypi
vi exp10it.py
vi setup.py
    set version to a higher one
python setup.py sdist upload
</code></pre>
</div>
</span>

        


        
        <div class="tags">
          <small>
          <i class="fa fa-tags"></i>
            script, python, module
          </small>
        </div>
        

      </div>

      
      <div class="content-panel feedback">
        I <i class="fa fa-heart"></i> feedback.<br />
        Let me know what you think of this article on twitter <a href="https://www.twitter.com/quanyechavshuo">@quanyechavshuo</a> or leave a comment below!
      </div>
      

      
      <div class="content-panel comments">
        <div id="disqus_thread">
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      </div>
      

      

    </div>

  </div>

</div>


<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
function disqus_config() { this.experiment.enable_scroll_container = true; }
var disqus_shortname = "quanyechavshuo"; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>


      </div>
    </div>

    <div class="footer clearfix">
  <div class="col-md-12">
    for better experience please install font 文泉驿等宽正黑
  </div>
</div>

<div class="my-home"><i class="fa fa-home" aria-hidden="true"></i><a href="/index2.html"> <font color="white">home</font></a></div>
<div class="my-papers"><i class="fa fa-github" aria-hidden="true"></i><a href="https://github.com/3xp10it" target="_top"> <font color="white">papers</font></a></div>
<div class="my-search"><i class="fa fa-search" aria-hidden="true"></i><a href="/search/"> <font color="white">search</font></a></div>
<div class="my-archive"><i class="fa fa-apple" aria-hidden="true"></i><a href="/my-archive/"> <font color="white">archive</font></a></div>
<div class="my-categories"><i class="fa fa-tags" aria-hidden="true"></i><a href="/my-categories/"> <font color="white">categories</font></a></div>


<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="/js/jquery.mmenu.min.all.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>






    </body>
</html>
